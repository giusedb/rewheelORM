!function(t,e,n){"use strict";function i(){this.handlers=[],this.strHandlers={}}function r(){var t={},n={},i=0;this.on=function(e,r){e in t||(t[e]=new Array);var o=i++;return t[e].push(r),n[o]=r,o},this.emit=function(e){if(e in t){var n=Array.prototype.slice.call(arguments,1);t[e].forEach(function(t){t.apply(null,n)})}},this.unbind=function(i){var r=0;if(i in n){var o=n[i+""];e(t).each(function(t,e){var n=[];for(var i in t)t[i]===o&&(n.push(i),r++);n.reverse().forEach(function(e){t.splice(e,1)})})}return delete n[i],r},this.once=function(t,e){var n=this,i=this.on(t,function(){e.apply(this,arguments),n.unbind(i)})}}function o(){return new Proxy({},{get:function(t,e){return"string"==typeof e?"toString"===e?y:v.mock:t[e]}})}function s(t,e){var i=new n(t);i.onopen=function(t){console.log("open : "+t),i.tenant(),e.emit("realtime-connection-open",t)},i.onmessage=function(t){if("message"==t.type)try{e.emit("realtime-message-json",JSON.parse(t.data))}catch(n){e.emit("realtime-message-text",JSON.parse(t.data))}else console.log("from realtime ",t)},i.onclose=function(){setTimeout(v.wsConnect,1e3),e.emit("realtime-connection-closed")},i.tenant=function(){i.send("TENANT:"+e.cachedStatus.application+":"+e.cachedStatus.token)},this.close=function(){i.close()}}function a(t,e){var n=new r;this.getLogin=e,this.endPoint=t.endsWith("/")?t:t+"/",this.on=n.on,this.unbind=n.unbind,this.emit=n.emit,this.once=n.once,this.cachedStatus={},this.isConnected=!1,this.isLoggedIn=!1}function c(){var t=!1;this.touch=function(){t=!0},this.touched=function(){var e=t;return t=!1,e}}function u(t,n,i,r){if(!n)var n=[];var o=[];this.ask=function(i,s){r&&i in r.source||e(n).contains(i)||(o.push(i),s||n.push(i),t.touch())},this.getAskedIndex=function(){return n},this.missings=function(){return e(o.splice(0,o.length)).unique().toArray()}}function l(t,n,i,r){var o=new c,s={},a={},l={},f={},h={};this.mainIndex=s,this.foreignKeys=a,this.m2m=l,this.m2mIndex=f,this.permissions=h,i.on("model-definition",function(t,n){var i=r.getIndexFor(t.name,"id");s[t.name]=new u(o,i,"mainIndex."+t.name,n),h[t.name]=new u(o,null,"permissions."+t.name),e(t.references).each(function(e){var n=t.name+"_"+e.id;a[n]=new u(o,r.getIndexFor(e.to,"id"),e.to+".id foreignKeys."+n)}),e(t.referencedBy).each(function(t){var e=t.by+"."+t.id;a[e]=new u(o,r.getIndexFor(t.by,t.id),t.by+"."+t.id+" foreignKeys."+e)}),e(t.manyToMany).each(function(t){t.indexName in l||(l[t.indexName]=[new u(o,null,"m2m."+t.indexName+"[0]"),new u(o,null,"m2m."+t.indexName+"[1]")]),t.indexName in f||(f[t.indexName]=new d(t,l[t.indexName]))})});var p=function(e,n,r,o){i.$post((n?v.reverse("/",e):e)+"s/list",{collection:r},function(n){i.gotData(n,o),delete t[e]})},m=function(n,i,r,o){e(i).each(l[n][r].ask.bind(l[n][r])),i=l[n][r].missings(),i.length?(t[n]=1,p(n,r,i,o)):o&&o()};this.getM2M=m;var g=function(){if(o.touched()){if(e(t).values().sum())return void o.touch();var r=!1;e(l).each(function(t,n){e(t).each(function(t,o){var a=t.missings();if(a=e(a).filter(Boolean).map(function(t){return parseInt(t)}).toArray(),a.length){var c=f[n],u=c["get"+(1-o)].bind(c);r=!0,p(n,o,a,function(t){var r=a.map(u);if(r.length){var c=n.split("/")[1-o];i.describe(c,function(){e(r).flatten().unique().each(function(t){s[c].ask(t,!0)})})}})}})}),e(s).each(function(t,o){var s=t.missings();if(s.length){r=!0;o in n?n[o].keys():e();i.fetch(o,{id:s},null,v.noop)}}),e(a).map(function(t,e){return[e,t.missings()]}).filter(function(t){return t[1].length}).each(function(t){r=!0;var e=t[1],n=t[0],o=n.split("."),s=o[0],a=o[1],c={};c[a]=e,i.fetch(s,c)}),e(e(h).map(function(t,e){return[e,t.missings()]}).filter(function(t){return t[1].length}).toObject()).each(function(n,o){r=!0,n.length&&(t[o]=1,i.$post(o+"/my_perms",{ids:e(n).unique().toArray()},function(e){i.gotPermissions(e.PERMISSIONS),delete t[o]}))})}};setInterval(g,50)}function f(){var t={},n={},i={},r=function(t,n,i){var r=[];if(i)for(var o in t)for(var s in n)r.push(e([t[o],n[s]]).flatten().toArray());else for(var o in t)for(var s in n)r.push([t[o],n[s]]);return r},o=function(t){for(var e=!1,n=t[0],i=1;i<t.length;++i)n=r(n,t[i],e),e=!0;return n},s=function(t){var n=o(e(t).values().toArray()),i=e(t).keys().toArray();return n.map(function(t){var e={};return i.forEach(function(n,i){e[n]=t[i]}),e})},a=function(t,n,i){var r=t.modelName,o=this.getIndexFor,s=(e(n).map(function(t,e){return[e,r+"."+e]}).toObject(),e(n).keys().map(function(t){return[t,o(r,t)]}).toObject());for(var a in n){var c=e(n[a]).difference(s[a]).toArray();if(c.length){var u=e([[a,c]]).toObject();return i||Array.prototype.push.apply(s[a],c),u}return null}},c=function(t,n){t.name in i||(i[t.name]=[]);var r=i[t.name],o=e(n).size();r.filter(v.makeFilter(t,n," && ",!0)).filter(function(t){e(t).size()>o})};this.filter=function(r,o){var u=r.modelName,l=e(o).size();switch(l){case 0:var f=t[u];return t[u]=!0,u in n&&delete n[u],u in i&&delete i[u],f?null:{};case 1:var d=a.call(this,r,o);return c.call(this,r,o),d}var h=this,p=e(o).keys().some(function(t){var e={};return e[t]=o[t],null==a.call(h,r,e,!0)});if(p)return null;u in i||(i[u]=[]);var m=s(o),g=i[u].filter(v.makeFilter(r,o," || ",!0));if(g.length){var y=[];for(var w in g)y.push.apply(y,m.filter(v.makeFilter(r,g[w]," && ",!0)));var b=e(m).difference(y).toArray()}else var b=m;if(b.length){i[u].push.apply(i[u],b);var b=e(o).keys().map(function(t){var n=e(b).pluck(t).unique().toArray();return[t,n.length?n:o[t]]}).toObject();return c(r,b),b}return null},this.getIndexFor=function(t,e){var i=t+"."+e;return i in n||(n[i]=[]),n[i]}}function d(t,n){var i=[];this.add=i.push.bind(i),this.add=function(t){e(i).find(t)||i.push(t)},this.get0=function(t){return n[1].ask(t),e(i).filter(function(e){return e[0]===t}).pluck("1").toArray()},this.get1=function(t){return n[0].ask(t),e(i).filter(function(e){return e[1]===t}).pluck("0").toArray()},this["get"+v.capitalize(t.indexName.split("/")[1])]=this.get1,this["get"+v.capitalize(t.indexName.split("/")[0])]=this.get0,this.del=function(t){for(var e=i.length,n=null,r=0;r<e;r++)if(i[r][0]===t[0]&&i[r][1]===t[1]){n=r;break}n&&i.splice(r,1),console.log("deleting ",t)}}function h(t,n,i,r){var o=Array.prototype.slice.call(arguments,4),s={};e(o).each(function(e){t.orm.on(e,function(){s={}})});var a={get:function(){return this.id in s||(s[this.id]=i.call(this)),s[this.id]}};r&&(a.set=function(t){isFinite(t)?(r.call(this,t),this.id in s&&delete s[this.id]):this.id in s&&delete s[this.id]}),Object.defineProperty(t,n,a)}function p(t){this.resource=t._resource,this.formIdx=t.formIdx,this.fields=t.errors}function m(t,e){this.$orm=new b(new v.reWheelConnection(t,e),this),this.on=this.$orm.on.bind(this.$orm),this.emit=this.$orm.emit.bind(this.$orm),this.unbind=this.$orm.unbind.bind(this.$orm),this.once=this.$orm.once,this.addModelHandler=this.$orm.addModelHandler.bind(this.$orm),this.addPersistentAttributes=this.$orm.addPersistentAttributes.bind(this.$orm),this.utils=v,this.logout=this.$orm.connection.logout.bind(this.$orm.connection)}i.prototype.addHandler=function(t){var e=v.hash(t.toString());e in this.strHandlers||(this.strHandlers[e]=t,this.handlers.push(t))},i.prototype.handle=function(){var t=Array.prototype.slice.call(arguments,0);this.handlers.forEach(function(e){e.apply(null,t)})},i.prototype.handleBy=function(){var t=Array.prototype.slice.call(arguments,1),e=arguments[0];this.handlers.forEach(function(n){n.apply(e,t)})};var g=0,y=function(){return""},v={renameFunction:function(t,e){return new Function("return function (call) { return function "+t+" () { return call(this, arguments) }; };")()(Function.apply.bind(e))},cached:function(t,e){function n(){return this[e]||(this[e]=t.call(this,[arguments])),this[e]}return e||(e="_"+g++),n},log:function(){console.log(arguments)},xdr:function(t,n,i,r,o){return new Promise(function(i,s){var a;n||(n={}),XMLHttpRequest?(a=new XMLHttpRequest,a.onreadystatechange=function(){if(4===a.readyState){try{var t=JSON.parse(a.responseText)}catch(t){var t=null}var e={responseData:t,responseText:a.responseText,status:a.status,request:a};a.status>=200&&a.status<400?i(e):s(e)}}):XDomainRequest?(a=new XDomainRequest,a.onload=function(){i(a.responseText,a.statusText,a)}):s(new Error("CORS not supported")),a.open("POST",t,!0),a.onerror=s,a.setRequestHeader("Accept","application/json"),r&&(n.__token__=r),o?(a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n=e(n).map(function(t,e){return e+"="+encodeURI(t.toString())}).toArray().join("&")):(a.setRequestHeader("Content-Type","text/plain"),n=e(n).size()?JSON.stringify(n):""),a.send(n)})},capitalize:function(t){return t[0].toUpperCase()+t.slice(1).toLowerCase()},hash:function(t){t=t.toString();for(var e=1,n=0;n<t.length;n++)e*=1+t.charCodeAt(n);return(e%34958374957).toString()},makeFilter:function(t,n,i,r){if(i||(i=" && "),0===e(n).size())return function(t){return!0};var o=e(n).map(function(n,i){return n||(n=[null]),Array.isArray(n)||(n=[n]),r||"reference"!==t.fields[i].type?"string"===t.fields[i].type&&(n=n.map(JSON.stringify)):(i="_"+i,n=e(n).map(function(t){return t&&t.constructor!==Number?t.id:t}).toArray()),"("+e(n).map(function(t){return t?t===orm.utils.mock&&console.error("makeFilter with Mock Object"):console.error("makeFilter x is null"),"(x."+i+" === "+t+")"}).join(" || ")+")"}).toArray().join(i);return new Function("x","return "+o)},sameAs:function(t,e){for(var n in t)if(e[n]!=t[n])return!1;return!0},pluralize:function(t,e){return t+"s"},beforeCall:function(t,e){var n=function(){e().then(t)};return n},cleanStorage:function(){e(localStorage).keys().each(function(t){delete localStorage[t]})},cleanDescription:function(){e(localStorage).filter(function(t,n){return e(n).startsWith("description:")}).keys().each(function(t){delete localStorage[t]})},reverse:function(t,e){return e.split(t).reverse().join(t)},permutations:function(t){for(var e=[],n=t.length-1;n>=0;n--)for(var i=t.length-1;i>=0;i--)n!==i&&e.push([t[n],t[i]]);return e},waitFor:function(t,e){var n=function(){t()?e():setTimeout(n,500)};setTimeout(n,500)},bool:Boolean,noop:function(){},tzOffset:6e4*(new Date).getTimezoneOffset(),transFieldType:{date:function(t){return new Date(1e3*t+v.tzOffset)},datetime:function(t){return new Date(1e3*t+v.tzOffset)},string:function(t){return t.toString()},text:function(t){return t.toString()},integer:function(t){return parseInt(t)},float:function(t){return parseFloat(t)}},mock:o()},w="lastRWTConnectionStatus";a.prototype.$post=function(t,e,n){var i=this,r=new Promise(function(r,o){v.xdr(i.endPoint+t,e,i.cachedStatus.application,i.cachedStatus.token).then(function(o){i.emit("http-response",o.responseText,o.status,t,e),i.emit("http-response-"+o.status,o.responseText,t,e),o.responseData&&i.emit("http-response-"+o.status+"-json",o.responseData,t,e),n&&n(o.responseData||o.responseText),r(o.responseData||o.responseText)},function(n){n.responseData?(i.emit("error-json",n.responseData,n.status,t,e,n),i.emit("error-json-"+n.status,n.responseData,t,e,n)):(i.emit("error-http",n.responseText,n.status,t,e,n),i.emit("error-http-"+n.status,n.responseText,t,e,n)),o(n.responseData||n.responseText)})});return r},a.prototype.status=function(t,n){var i="token:"+this.endPoint,r=this;if(n&&(this.cachedStatus={},delete localStorage[i]),this.statusWaiting)return void v.waitFor(function(){return!r.statusWaiting},function(){r.status(t,n)});if(!e(this.cachedStatus).size()){var o={};return i in localStorage&&(o.__token__=localStorage[i]),this.statusWaiting=!0,void this.$post("api/status",o,function(e){r.updateStatus(e),localStorage[i]=e.token,t(e),r.statusWaiting=!1})}t(this.cachedStatus),t(this.cachedStatus)},a.prototype.updateStatus=function(t){var e=parseFloat(localStorage.lastBuild)||1;e<t.last_build&&(v.cleanDescription(),localStorage.lastBuild=t.last_build),this.isConnected=Boolean(t.token),this.isLoggedIn=Boolean(t.user_id);var n=this.cachedStatus;if(this.cachedStatus=t,!n.user_id&&t.user_id)this.emit("logged-in",t.user_id);else if(n.user_id&&!t.user_id)this.emit("logged-out");else if(this.isConnected&&!this.isLoggedIn&&(this.emit("login-required"),this.getLogin)){var i=this.getLogin();i.constructor===Object?this.login(i.username,i.password,i.callBack):i.constructor===Promise&&i.then(function(t){this.login(t.username,t.password,t.callBack)})}!n.realtimeEndPoint&&t.realtimeEndPoint?this.wsConnection=new s(t.realtimeEndPoint,this):n.realtimeEndPoint&&!t.realtimeEndPoint&&(this.wsConnection.close(),delete this.wsConnection),this.emit("update-connection-status",t,n),localStorage[w]=JSON.stringify(t)},a.prototype.login=function(t,e){var n=this;return new Promise(function(i,r){v.xdr(n.endPoint+"api/login",{username:t||"",password:e||""},null,n.cachedStatus.token,!0).then(function(t){n.updateStatus(t.responseData),i({status:"success",userid:n.cachedStatus.user_id})},function(t){i({error:t.responseData.error,status:"error"})})})},a.prototype.logout=function(){var t=this;return new Promise(function(e,n){t.$post("api/logout").then(function(n){t.updateStatus({}),delete localStorage[w],e()},n)})},a.prototype.connect=function(t){this.isLoggedIn?t(this.cachedStatus.user_id):(this.once("logged-in",function(e){t(e)}),this.status(t||v.noop))},v.reWheelConnection=a;var b=function(t,n){function r(t,e,n){this.klass=e,this.permissions=[],this.id=t;for(var i in n)this.push.apply(this,[i,n[i]])}if(t.constructor===String)var o=new a(t);else if(t.constructor===v.reWheelConnection)var o=t;this.connection=o,o.on("connected",function(){this.connected=!0}),this.on=o.on,this.emit=o.emit,this.unbind=o.unbind,this.once=o.once,this.$post=o.$post.bind(o),this.on("ws-connected",function(t){console.info("Websocket connected"),t.onMessageJson(s.gotData.bind(s)),t.onMessageText(function(t){console.info("WS message : "+t)})}),this.on("ws-disconnected",function(t){console.error("Websocket disconnected")}),this.on("error-json-404",function(t,e,n,i){console.error("JSON error ",JSON.stringify(t)),delete b[e.split("/")[0]]}),this.on("realtime-message-json",function(t){s.gotData(t)});var s=this,c={auth_group:e({})},u={},d={},m={},g={},y={},w={},b={},S=new f(e),A=new l(b,c,this,S);window.IDB=c,this.validationEvent=this.on("error-json-513",function(t,e,n,i){currentContext.savingErrorHanlder&&currentContext.savingErrorHanlder(new p(t))});var k=function(t){return t in c?c[t]:(c[t]=e({}),c[t])};r.prototype.save=function(t){var n={permissions:e(this.permissions).map(function(t){return[t[0].id,t[1]]}).toObject()};n.id=this.id;this.klass.modelName;s.$post(this.klass.modelName+"/set_permissions",n,function(e,n,i,r){t(e)})},r.prototype.push=function(t,n){var i=e(n),r=e(this.klass.allPermissions).map(function(t){return[t,i.contains(t)]}).toObject(),o=e(this.permissions).map(function(t){return t[0].id});o.contains(t)?this.permissions[o.indexOf(t)][1]=r:this.permissions.push([c.auth_group.get(t),r])};var N=function(t){t.fields.id.readable=!1,t.fields.id.writable=!1;var i=e(t.fields);t.privateArgs&&(i=i.merge(t.privateArgs)),s.emit("model-definition",t,k(t.name));var o="if (!row) { row = {}};\n";o+=t.references.map(function(t){return"this._"+t.id+" = row."+t.id+";"}).join(";\n"),o+=i.map(function(t,e){return"date"==t.type||"datetime"==t.type?"this."+e+" = row."+e+"?new Date(row."+e+" * 1000 - "+v.tzOffset+"):null;\n":"boolean"==t.type?"this."+e+" = (row."+e+' === "T") || (row.'+e+" === true);\n":"this."+e+" = row."+e+";\n"}).toString("\n"),o+="if (permissions) {this._permissions = permissions && Lazy(permissions).map(function (x) { return [x, true] }).toObject();}";var a=new Function("row","permissions",o);a.prototype.orm=n,a.ref_translations={},a.modelName=t.name,a.references=e(t.references).pluck("id").toArray(),a.inverse_references=t.referencedBy.map(function(t){return t.by+"_"+t.id+"_set"}),a.referents=t.referencedBy.map(function(t){return[t.by,t.id]}),a.fieldsOrder=t.fieldOrder,a.allPermissions=t.permissions,e(t.representation).size()&&(a.prototype.toString=new Function("return this."+e(t.representation).toString(' + " " + this.'))),a.prototype.toUpperCase=function(){return this.toString().toUpperCase()},a.prototype.toLowerCase=function(){return this.toString().toLowerCase()},a.prototype.delete=function(){return n.delete(this.constructor.modelName,[this.id])},Object.defineProperty(a.prototype,"permissions",{get:function(){return this._permissions?this._permissions:void A.permissions[this.constructor.modelName].ask(this.id)}}),a.prototype.all_perms=function(t){var n=this.id;s.$post(this.constructor.modelName+"/all_perms",{id:this.id},function(i){var o=i,u={},l=e(o).pluck("group_id").unique().map(function(t){return""+t}).difference(c.auth_group.keys()).toArray();e(o).groupBy(function(t){return t.group_id}).each(function(t,n){u[n]=e(t).pluck("name").toArray()});var f=function(e){t(new r(n,a,u))};l.length?s.get("auth_group",l,f):f()})},a.prototype.save=function(t){var n=this.asRaw(),i=a.fields,r=this.id,o=this.constructor.modelName;if(t)for(var c in t)n[c]=t[c];e(a.fieldsOrder).filter(function(t){return!i[t].writable}).each(function(t){t in n&&delete n[t]}),r&&(n.id=r);var u=s.$post(o+(r?"/post":"/put"),n);return t&&t.constructor===Function&&(u.context.savingErrorHanlder=t),u},a.prototype.copy=function(){var t=new this.constructor(this.asRaw());return t._permissions=this._permissions,t};var l="return {\n"+e(t.references).map(function(t){return t.id+" : this._"+t.id}).concat(i.map(function(t,e){return"date"==t.type||"datetime"==t.type?e+" : (this."+e+"?(Math.round(this."+e+".getTime() - this."+e+".getTimezoneOffset() * 60000) / 1000):null)":"boolean"==t.type?e+" : this."+e+'?"T":"F"':e+" : this."+e})).toString(",\n")+"};";a.prototype.asRaw=new Function(l),a.saveMulti=function(t,n,i){var r=[],o=e(a.fields).filter(function(t){return!t.writable}).pluck("id").toArray();e(t).map(function(t){return t.asRaw()}).each(function(t){e(o).each(function(e){delete t[e]}),r.push(t)}),s.$post(a.modelName,"put",{multiple:r,formIdx:s.formIdx++},function(t){s.gotData(t);var i=c[a.modelName],r=e(t[a.modelName].results).pluck("id").map(function(t){return i.get(t)}).toArray();n&&n(r)},i)},"extra_verbs"in t&&e(t.extra_verbs).each(function(t){var n=t[0],i=t[1],r="data = {id : this.id";i.length&&(r+=", "+e(i).map(function(t){return t+" : "+t}).join(",")),r+="};",i.push("cb"),a.prototype[n]=new Function(i,r+'W2S.W2P_POST(this.constructor.modelName,"'+n+'", data,function(data,status,headers,x){try{\n   if (!headers("nomodel")) {window.W2S.gotData(data,cb);}\n   else {if (cb) {cb(data)}}\n} catch(e){\nif (cb) {cb(data);}\n}\n});\n')}),"privateArgs"in t&&(a.privateArgs=e(t.privateArgs).keys().map(function(t){return[t,!0]}).toObject(),a.prototype.savePA=function(t){var n=this,i={id:this.id},r=this.constructor.privateArgs,o=this.constructor.fields,a=(new this.constructor(t).asRaw(),e(r).keys().map(function(t){return[t,o[t]]}).toObject());e(t).each(function(t,e){e in r&&a[e].writable&&(i[e]=t)}),s.$post(this.constructor.modelName+"/savePA",i,function(){e(i).each(function(t,e){n[e]=t})})}),y[a.modelName]=a;for(var f in t.fields)t.fields[f].id=f;return a.fields=e(t.fields).concat(e(t.privateArgs)).concat(e(t.references).tap(function(t){t.type=t.type||"reference"})).indexBy("id").toObject(),e(a.fields).each(function(t){t.widget||("reference"===t.type?t.widget="choices":t.widget=t.type)}),e(t.references).each(function(t){var e=t.to,i="_"+t.id;h(a.prototype,t.id,function(){if(!this[i])return null;if(!(e in c)){var t=this;s.describe(e,function(n){A.mainIndex[e].ask(t[i],!0)})}var n=e in c&&this[i]&&c[e].get(this[i]);return!n&&e in A.mainIndex?("number"==typeof this[i]?A.mainIndex[e].ask(this[i],!0):console.warn("null reference for "+i+"("+this.id+") resource "+a.modelName),v.mock):n},function(n){if(n){if(n.constructor!==v.mock&&n.constructor.modelName!==e)throw new TypeError("You can assign only "+e+" to "+t.id);this[i]=n.id}else this[i]=null},"new-"+e,"deleted-"+e,"updated-"+e,"new-model-"+e),a.prototype["get"+v.capitalize(t.id)]=function(){return n.get(e,this[i])}}),e(t.referencedBy).each(function(t){var e=t.by+"."+t.id,i=t.by+"_"+v.pluralize(t.id),r=t.by;a.prototype.hasOwnProperty(i)?console.error("Tryed to redefine property "+i+"s for "+a.modelName):h(a.prototype,i,function(){var t=r in c?u[e].get(this.id+""):null;return A.foreignKeys[e].ask(this.id,!0),t},null,"new-"+r,"updated-"+r,"deleted-"+r),a.prototype["get"+v.capitalize(v.pluralize(t.by))]=function(){var e={};return e[t.id]=[this.id],n.get(t.by,e)}}),t.manyToMany&&(e(t.manyToMany).each(function(t){var n=t.indexName,i=t.first?0:1,r=t.model,o=A.m2mIndex[n]["get"+(1-i)];h(a.prototype,t.model+"s",function(){var t=this,n=[],i=o(t.id),s=null;return i.length&&(s=k(r).get.bind(c[r])),i&&s&&(n=e(i).map(s).filter(v.bool).toArray()),n},null,"received-m2m-"+n,"received-"+r),a.prototype["get"+v.capitalize(v.pluralize(r))]=function(){var t=this;return new Promise(function(a,u){try{A.getM2M(n,[t.id],i,function(n){var i=o(t.id);i.length?s.fetch(r,{id:i},null,function(){var t=c[r].get.bind(c[r]);a(e(i).map(t).filter(v.bool).toArray())}):a([])})}catch(t){console.error(t),u(t)}})},a.fields[v.capitalize(r)]={id:v.capitalize(r),name:v.capitalize(r),writable:!0,readable:!0,type:"M2M",validators:[]}}),a.prototype.unlinkReference=function(t){var n=!1,i=this.id,r=[];"Array"==t.constructor.name&&(n=!0,r=t,t=r[0]);var o=t.constructor.modelName;if(n)var c=e(r).pluck("id").map(function(t){return[i,t]}).toArray();else var c=[[i,t.id]];s.$post(a.modelName+"/"+o+"s/delete",{collection:c})},a.prototype.linkReference=function(t){var n=!1,i=this.id,r=[];"Array"==t.constructor.name&&(n=!0,r=t,t=r[0]);var o=t.constructor.modelName,c=a.modelName+"/"+o;if(n){var u=[];if(c in INDEX_M2M&&(u=e(r).pluck("id").difference(e(INDEX_M2M[c][0].get(this.id))).toArray()),c=o+"/"+a.modelName,c in INDEX_M2M&&(u=e(r).pluck("id").difference(e(INDEX_M2M[c][0].get(this.id))).toArray()),u.length){var l=e(u).map(function(t){return[i,t]}).toArray();W2P_POST(a.modelName,o+"s/put",{collection:l},function(t){})}}else{if(c in A.m2mIndex&&e(A.m2mIndex[c]["get"+v.capitalize(o)](t.id)).find(this))return;s.$post(a.modelName+"/"+o+"s/put",{collection:[[this.id,t.id]]})}}),s.emit("new-model",a),s.emit("new-model-"+a.modelName),a};this.gotData=function(t,n){if(console.info("gotData"),"string"!=typeof t){"_extra"in t&&delete t._extra;var i=(t.TOONE,t.TOMANY,t.MANYTOMANY,t.PERMISSIONS),r=t.PA;if(delete t.TOONE,delete t.TOMANY,delete t.MANYTOMANY,delete t.PERMISSIONS,delete t.PA,r||(r={}),t=e(t).filter(function(t,e){return!("deleted"in t)||e in y}).toObject(),"m2m"in t){var o=t.m2m;delete t.m2m}e(t).each(function(t,n){s.describe(n,function(i){var o=i;t.results&&t.results.length>0&&t.results[0].constructor==Array&&(t.results=e(t.results).map(function(t){return e(o.fieldsOrder).zip(t).toObject()}).toArray());var a=e(t.results),l=t.deleted;if(n in r){var f=r[n];e(a).each(function(t){t.id in f&&e(f[t.id]).each(function(e,n){t[n]=e})})}var d=k(n),h=d.source;l&&l.forEach(function(t){delete h[t]});var p=a.indexBy("id"),m=p.keys(),g=m.difference(d.keys().map(function(t){return parseInt(t)})),w=m.difference(g);w=w.filter(function(t){return!v.sameAs(p.get(t),d.get(t).asRaw())}).toArray();var b=e(t.permissions?t.permissions:{}),S=g.map(function(t){return new o(p.get(t),b.get(t))}),A=[];e(i.references).map(function(t){return[t,1]}).toObject();w.forEach(function(t){var n=h[t],r=n.copy(),o=p.get(t);e(i.fields).each(function(t,e){switch(t.type){case"reference":n["_"+e]=o[e],n[e]=NaN;break;case"date":n[e]=new Date(1e3*o[e]);break;case"datetime":n[e]=new Date(1e3*o[e]);break;case"boolean":switch(o[e]){case null:n[e]=null;break;case"T":n[e]=!0;break;case"F":n[e]=!1;break;case!0:n[e]=!0;break;case!1:n[e]=!1}break;default:n[e]=o[e]}}),A.push([o,r])}),A.length&&s.emit("updated-"+n,A);var N=S.toArray();e(N).each(function(t){h[t.id]=t}),e(y[n].references).each(function(t){u[n+"."+t]=c[n].groupBy("_"+t)}),N.length&&s.emit("new-"+n,e(N),t.totalResults),l&&s.emit("deleted-"+n,l),s.emit("received-"+n)})}),o&&s.gotM2M(o),i&&s.gotPermissions(i),n&&n(t),s.emit("got-data")}else if(console.log("data "+t+" refused from gotData()"),n)return n(t)},this.gotPermissions=function(t){e(t).each(function(t,n){e(t[0]).each(function(t,i){n in c&&i in c[n].source&&(c[n].get(i)._permissions=e(t).map(function(t){return[t,!0]}).toObject())}),e(t[0]).size()&&s.emit("update-permissions-"+n,e(t[0]).keys().toArray())}),this.emit("update-permissions")},this.gotM2M=function(t){e(t).each(function(t,n){var i=A.m2mIndex[n];e(t).each(function(t){e(t).each(function(t,e){i[e](t)})}),s.emit("received-m2m"),s.emit("received-m2m-"+n)})},this.fetch=function(t,e,n,i){t in b?setTimeout(function(){s.fetch(t,e,n,i)},500):s.describe(t,function(n){return s.connection.cachedStatus.realtimeEndPoint?(e=S.filter(n,e),e?(b[t]=!0,s.$post(t+"/list",{filter:e}).then(function(e){s.gotData(e,i),delete b[t]},function(e){delete b[t]})):i&&i(),e):void this.$post(t+"/list",sendData,function(n){e||GOT_ALL.source.push(t),s.gotData(n,i)})}.bind(this))},this.get=function(t,e,n){e.constructor!==Array&&(e=[e]),s.fetch(t,{id:e},null,function(){var i=[],r=c[t];for(var o in e)i.push(r.source[e[o]]);n(i)})},this.gotModel=function(t){for(var n in t){var i=t[n];localStorage["description:"+n]=JSON.stringify(t),y[n]=N(i),n in c||(c[n]=e({}))}},this.describe=function(t,e){var n=y[t];if(n)e&&e(n);else if(t in b)setTimeout(function(){s.describe(t,e)},500);else{if(t in w)return;var i="description:"+t;i in localStorage?(this.gotModel(JSON.parse(localStorage[i])),e&&e(y[t])):(b[t]=!0,this.$post(t+"/describe",null,function(n){s.gotModel(n),e&&e(y[t]),delete b[t]},function(e){this.modelNotFound.handle(t),w[t]=!0}))}},this.addModelHandler=function(t,e){var n=v.hash(e);t in d||(d[t]=new i),t in m||(m[t]={}),n in m[t]||(m[t][n]=!0,t in y?e(y[t]):d[t].addHandler(e))},this.addPersistentAttributes=function(t,n){var i=function(t,e){e.forEach(function(e){var n="pA:"+t.modelName+":"+e,i="__"+e;Object.defineProperty(t.prototype,e,{get:function(){if(!(i in this)){var t=localStorage[n+this.id];this[i]=t?JSON.parse(t):null}return this[i]},set:function(t){this[i]=t,localStorage[n+this.id]=JSON.stringify(t)}})})};t in g||(g[t]=[]);var r=g[t];if(n)var o=e(n).difference(r).toArray();else var o=r;o.length&&(t in y&&i(y[t],o),n&&Array.prototype.push.apply(r,o))},this.on("new-model",function(t){t.modelName in d&&d[t.modelName].handle(y[t.modelName]),t.modelName in g&&s.addPersistentAttributes(t.modelName)}),this.query=function(t,n,i,r){var o=this;this.describe(t,function(s){n=e(n).map(function(t,e){return[e,Array.isArray(t)?t:[t]]}).toObject();var a=v.makeFilter(s,n),c=k(t);o.fetch(t,n,i,function(t){r(c.filter(a).values().toArray())})})},this.delete=function(t,e,n){return this.$post(t+"/delete",{id:e},n)},this.connect=function(t){this.connection.isLoggedIn?t():this.connection.connect(t)}};m.prototype.connect=function(){var t=this.$orm.connection;return new Promise(function(e,n){t.connect(e)})},m.prototype.login=function(t,e){return new Promise(function(n,i){this.$orm.connection.login(t,e,n)}.bind(this))},m.prototype.logout=function(t){return this.$orm.connection.logout()},m.prototype.getModel=function(t){var e=this;return new Promise(function(n,i){try{e.$orm.connect(function(){e.$orm.describe(t,n)})}catch(t){i(t)}})},m.prototype.get=function(t,e){var n,i=this,r=!1;return"number"==typeof e?(r=!0,n={id:[e]}):Array.isArray(e)?n={id:e}:"object"==typeof e?n=e:null===e&&(n={}),new Promise(function(e,o){try{i.$orm.connect(function(){i.$orm.query(t,n,null,function(t){e(r?t.length?t[0]:null:t)})})}catch(t){o(t)}})},m.prototype.delete=function(t,e){var n=this;return new Promise(function(i,r){try{n.$orm.connect(function(){n.$orm.delete(t,e,i)})}catch(t){r(t)}})},m.prototype.getLoggedUser=function(){var t=this;return this.$orm.connection.cachedStatus.user_id?this.get("auth_user",this.$orm.connection.cachedStatus.user_id):new Promise(function(e,n){t.once("logged-in",function(n){t.get("auth_user",n).then(e)})})},m.prototype.$sendToEndpoint=function(t,e){return this.$orm.$post(t,e)},m.prototype.login=function(t,e){return this.$orm.connection.login(t,e)},t.rwt=m}(window,Lazy,SockJS);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhhbmRsZXJzLmpzIiwidXRpbHMuanMiLCJjb25uZWN0aW9uLmpzIiwidG91Y2hlci5qcyIsInZhY3V1bWNhY2hlci5qcyIsImF1dG9saW5rZXIuanMiLCJsaXN0Y2FjaGVyLmpzIiwibWFueXRvbWFueS5qcyIsImNhY2hlci5qcyIsIm9ybS5qcyJdLCJuYW1lcyI6WyJIYW5kbGVyIiwidGhpcyIsImhhbmRsZXJzIiwic3RySGFuZGxlcnMiLCJOYW1lZEV2ZW50TWFuYWdlciIsImV2ZW50cyIsImhhbmRsZXJJZCIsImlkeElkIiwib24iLCJuYW1lIiwiZnVuYyIsIkFycmF5IiwiaWQiLCJwdXNoIiwiZW1pdCIsImFyZ3MiLCJwcm90b3R5cGUiLCJzbGljZSIsImNhbGwiLCJhcmd1bWVudHMiLCJmb3JFYWNoIiwiZXZlbnQiLCJhcHBseSIsInVuYmluZCIsImhhbmRsZXIiLCJjb3VudCIsIkxhenkiLCJlYWNoIiwidiIsImsiLCJpZHgiLCJuIiwicmV2ZXJzZSIsIngiLCJzcGxpY2UiLCJvbmNlIiwiZXZlbnROYW1lIiwiaGFuZGxlckZ1bmN0aW9uIiwic2VsZiIsIm1vY2tPYmplY3QiLCJQcm94eSIsImdldCIsInRhcmdldCIsIm51bGxTdHJpbmciLCJ1dGlscyIsIm1vY2siLCJSZWFsdGltZUNvbm5lY3Rpb24iLCJlbmRQb2ludCIsInJ3dENvbm5lY3Rpb24iLCJjb25uZWN0aW9uIiwiU29ja0pTIiwib25vcGVuIiwiY29uc29sZSIsImxvZyIsInRlbmFudCIsIm9ubWVzc2FnZSIsInR5cGUiLCJKU09OIiwicGFyc2UiLCJkYXRhIiwiZSIsIm9uY2xvc2UiLCJzZXRUaW1lb3V0Iiwid3NDb25uZWN0Iiwic2VuZCIsImNhY2hlZFN0YXR1cyIsImFwcGxpY2F0aW9uIiwidG9rZW4iLCJjbG9zZSIsInJlV2hlZWxDb25uZWN0aW9uIiwiZ2V0TG9naW4iLCJlbmRzV2l0aCIsImlzQ29ubmVjdGVkIiwiaXNMb2dnZWRJbiIsIlRvdWNoZXIiLCJ0b3VjaGVkIiwidG91Y2giLCJ0IiwiVmFjdXVtQ2FjaGVyIiwiYXNrZWQiLCJwa0luZGV4IiwibWlzc2luZyIsImFzayIsImxhenkiLCJzb3VyY2UiLCJjb250YWlucyIsImdldEFza2VkSW5kZXgiLCJtaXNzaW5ncyIsImxlbmd0aCIsInVuaXF1ZSIsInRvQXJyYXkiLCJBdXRvTGlua2VyIiwiYWN0aXZlcyIsIklEQiIsIlcyUFJFU09VUkNFIiwibGlzdENhY2hlIiwibWFpbkluZGV4IiwiZm9yZWlnbktleXMiLCJtMm0iLCJtMm1JbmRleCIsInBlcm1pc3Npb25zIiwibW9kZWwiLCJpbmRleCIsImdldEluZGV4Rm9yIiwicmVmZXJlbmNlcyIsInJlZmVyZW5jZSIsImluZGV4TmFtZSIsInRvIiwicmVmZXJlbmNlZEJ5IiwiZmllbGQiLCJieSIsIm1hbnlUb01hbnkiLCJyZWxhdGlvbiIsIk1hbnlUb01hbnlSZWxhdGlvbiIsIm0ybUdldCIsImNvbGxlY3Rpb24iLCJjYWxsQmFjayIsIiRwb3N0IiwiZ290RGF0YSIsImdldE0yTSIsImJpbmQiLCJsaW5rVW5saW5rZWQiLCJ2YWx1ZXMiLCJzdW0iLCJjaGFuZ2VkIiwiaW5kZXhlcyIsImZpbHRlciIsIkJvb2xlYW4iLCJtYXAiLCJwYXJzZUludCIsIklOREVYIiwiZ2V0dGVyIiwiaWRzIiwib3RoZXJJbmRleCIsInNwbGl0IiwiZGVzY3JpYmUiLCJmbGF0dGVuIiwibW9kZWxOYW1lIiwia2V5cyIsImZldGNoIiwibm9vcCIsIm1haW5SZXNvdXJjZSIsImZpZWxkTmFtZSIsInRvT2JqZWN0IiwicmVzb3VyY2VOYW1lIiwiZ290UGVybWlzc2lvbnMiLCJQRVJNSVNTSU9OUyIsInNldEludGVydmFsIiwiTGlzdENhY2hlciIsImdvdEFsbCIsImNvbXBvc2l0ZUFza2VkIiwiY2FydGVzaWFuUHJvZHVjdDEiLCJ5IiwiaXNBcnJheSIsInJldCIsImEiLCJiIiwiY2FydGVzaWFuUHJvZHVjdCIsImFyciIsImV4cGxvZGVGaWx0ZXIiLCJwcm9kdWN0IiwiciIsImZpbHRlclNpbmdsZSIsInRlc3RPbmx5Iiwia2V5IiwiZGlmZmVyZW5jZSIsImNsZWFuQ29tcG9zaXRlcyIsImZpbHRlckxlbiIsInNpemUiLCJtYWtlRmlsdGVyIiwiaXRlbSIsImdvdCIsInRocyIsInNpbmdsZSIsInNvbWUiLCJmIiwiZXhwbG9kZWQiLCJwYXJ0aWFscyIsImJhZCIsInBsdWNrIiwiaXRlbXMiLCJhZGQiLCJmaW5kIiwiZ2V0MCIsImdldDEiLCJjYXBpdGFsaXplIiwiZGVsIiwibCIsImNhY2hlZFByb3BlcnR5QnlFdmVudHMiLCJwcm90byIsInByb3BlcnR5TmFtZSIsInNldHRlciIsInJlc3VsdCIsIm9ybSIsInByb3BlcnR5RGVmIiwidmFsdWUiLCJpc0Zpbml0ZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiVmFsaWRhdGlvbkVycm9yIiwicmVzb3VyY2UiLCJfcmVzb3VyY2UiLCJmb3JtSWR4IiwiZmllbGRzIiwiZXJyb3JzIiwicmVXaGVlbE9STSIsImxvZ2luRnVuYyIsIiRvcm0iLCJiYXNlT1JNIiwiYWRkTW9kZWxIYW5kbGVyIiwiYWRkUGVyc2lzdGVudEF0dHJpYnV0ZXMiLCJsb2dvdXQiLCJhZGRIYW5kbGVyIiwic3RySGFuZGxlciIsImhhc2giLCJ0b1N0cmluZyIsImhhbmRsZSIsImhhbmRsZUJ5IiwiY2FjaGVkS2V5SWR4IiwicmVuYW1lRnVuY3Rpb24iLCJmbiIsIkZ1bmN0aW9uIiwiY2FjaGVkIiwid3JhcHBlciIsInhkciIsInVybCIsImZvcm1FbmNvZGUiLCJQcm9taXNlIiwiYWNjZXB0IiwicmVqZWN0IiwicmVxIiwiWE1MSHR0cFJlcXVlc3QiLCJvbnJlYWR5c3RhdGVjaGFuZ2UiLCJyZWFkeVN0YXRlIiwicmVzcG9uc2VEYXRhIiwicmVzcG9uc2VUZXh0IiwicmVzcG9uc2UiLCJzdGF0dXMiLCJyZXF1ZXN0IiwiWERvbWFpblJlcXVlc3QiLCJvbmxvYWQiLCJzdGF0dXNUZXh0IiwiRXJyb3IiLCJvcGVuIiwib25lcnJvciIsInNldFJlcXVlc3RIZWFkZXIiLCJfX3Rva2VuX18iLCJlbmNvZGVVUkkiLCJqb2luIiwic3RyaW5naWZ5IiwicyIsInRvVXBwZXJDYXNlIiwidG9Mb3dlckNhc2UiLCJzdHIiLCJjaGFyQ29kZUF0IiwidW5pZmllciIsImRvbnRUcmFuc2xhdGVGaWx0ZXIiLCJ2YWxzIiwiY29uc3RydWN0b3IiLCJOdW1iZXIiLCJlcnJvciIsInNhbWVBcyIsInBsdXJhbGl6ZSIsImJlZm9yZUNhbGwiLCJiZWZvcmUiLCJkZWNvcmF0b3IiLCJ0aGVuIiwiY2xlYW5TdG9yYWdlIiwibG9jYWxTdG9yYWdlIiwiY2xlYW5EZXNjcmlwdGlvbiIsInN0YXJ0c1dpdGgiLCJjaHIiLCJwZXJtdXRhdGlvbnMiLCJ3YWl0Rm9yIiwid2FpdGVyIiwiYm9vbCIsInR6T2Zmc2V0IiwiRGF0ZSIsImdldFRpbWV6b25lT2Zmc2V0IiwidHJhbnNGaWVsZFR5cGUiLCJkYXRlIiwiZGF0ZXRpbWUiLCJzdHJpbmciLCJ0ZXh0IiwiaW50ZWdlciIsImZsb2F0IiwicGFyc2VGbG9hdCIsIlNUQVRVU0tFWSIsInByb21pc2UiLCJ4aHIiLCJmb3JjZSIsInN0YXR1c1dhaXRpbmciLCJ1cGRhdGVTdGF0dXMiLCJsYXN0QnVpbGQiLCJsYXN0X2J1aWxkIiwidXNlcl9pZCIsIm9sZFN0YXR1cyIsImxvZ2luSW5mbyIsImxvZ2luIiwidXNlcm5hbWUiLCJwYXNzd29yZCIsIm9iaiIsInJlYWx0aW1lRW5kUG9pbnQiLCJ3c0Nvbm5lY3Rpb24iLCJ1c2VyaWQiLCJvayIsImNvbm5lY3QiLCJvcHRpb25zIiwiZXh0T1JNIiwiUGVybWlzc2lvblRhYmxlIiwia2xhc3MiLCJTdHJpbmciLCJjb25uZWN0ZWQiLCJ3cyIsImluZm8iLCJvbk1lc3NhZ2VKc29uIiwib25NZXNzYWdlVGV4dCIsIm1lc3NhZ2UiLCJzZW50RGF0YSIsIndhaXRpbmdDb25uZWN0aW9ucyIsImF1dGhfZ3JvdXAiLCJSRVZJRFgiLCJidWlsZGVySGFuZGxlcnMiLCJidWlsZGVySGFuZGxlclVzZWQiLCJwZXJzaXN0ZW50QXR0cmlidXRlcyIsIm1vZGVsQ2FjaGUiLCJmYWlsZWRNb2RlbHMiLCJsaW5rZXIiLCJ3aW5kb3ciLCJ2YWxpZGF0aW9uRXZlbnQiLCJjdXJyZW50Q29udGV4dCIsInNhdmluZ0Vycm9ySGFubGRlciIsImdldEluZGV4Iiwic2F2ZSIsImNiIiwibXlQZXJtcyIsImdyb3VwX2lkIiwicGVybWlzc2lvbkxpc3QiLCJwIiwicGVybXMiLCJhbGxQZXJtaXNzaW9ucyIsImluZGV4T2YiLCJtYWtlTW9kZWxDbGFzcyIsInJlYWRhYmxlIiwid3JpdGFibGUiLCJwcml2YXRlQXJncyIsIm1lcmdlIiwiZnVuY1N0cmluZyIsIktsYXNzIiwicmVmX3RyYW5zbGF0aW9ucyIsImludmVyc2VfcmVmZXJlbmNlcyIsInJlZmVyZW50cyIsImZpZWxkc09yZGVyIiwiZmllbGRPcmRlciIsInJlcHJlc2VudGF0aW9uIiwiZGVsZXRlIiwiX3Blcm1pc3Npb25zIiwiYWxsX3Blcm1zIiwib2JqZWN0X2lkIiwiZ3JvdXBlZCIsInVua25vd25fZ3JvdXBzIiwiZ3JvdXBCeSIsIm8iLCJhc1JhdyIsIklEIiwiYXJnIiwiY29udGV4dCIsImNvcHkiLCJhc3IiLCJjb25jYXQiLCJzYXZlTXVsdGkiLCJvYmplY3RzIiwic2NvcGUiLCJyYXciLCJkZWxldGFibGUiLCJtdWx0aXBsZSIsImVsZW1zIiwidGFiIiwib2JqcyIsInJlc3VsdHMiLCJleHRyYV92ZXJicyIsImZ1bmNOYW1lIiwiZGRhdGEiLCJzYXZlUEEiLCJUIiwib28iLCJQQSIsIkZzIiwiZmllbGRJZHgiLCJ0YXAiLCJpbmRleEJ5Iiwid2lkZ2V0IiwicmVmIiwiZXh0X3JlZiIsImxvY2FsX3JlZiIsIndhcm4iLCJUeXBlRXJyb3IiLCJyZXZJbmRleCIsImhhc093blByb3BlcnR5Iiwib3B0cyIsImZpcnN0Iiwib21vZGVsTmFtZSIsInZhbGlkYXRvcnMiLCJ1bmxpbmtSZWZlcmVuY2UiLCJpbnN0YW5jZSIsImluc3RhbmNlcyIsIm9tb2RlbCIsImxpbmtSZWZlcmVuY2UiLCJyZWZzIiwiSU5ERVhfTTJNIiwiVzJQX1BPU1QiLCJfZXh0cmEiLCJUT09ORSIsIlRPTUFOWSIsIk1BTllUT01BTlkiLCJtb2RlbENsYXNzIiwiemlwIiwiZGVsZXRlZCIsIk1QQSIsInJlY29yZCIsIml0YWIiLCJ0YWJsZSIsImlrIiwibm5ldyIsInVwZGF0ZWQiLCJuZXdPYmplY3RzIiwib2xkSXRlbSIsIm9sZENvcHkiLCJuZXdJdGVtIiwiTmFOIiwibm8iLCJ0b3RhbFJlc3VsdHMiLCJnb3RNMk0iLCJyb3ciLCJtIiwidmVyYiIsInRvZ2V0aGVyIiwic2VuZERhdGEiLCJHT1RfQUxMIiwiZ290TW9kZWwiLCJjYWNoZUtleSIsIm1vZGVsTm90Rm91bmQiLCJhdHRyaWJ1dGVzIiwiYWRkUHJvcGVydHkiLCJ2YWwiLCJrYXR0ciIsInNldCIsImF0dHJzIiwibmV3QXR0cnMiLCJxdWVyeSIsImZpbHRlckZ1bmN0aW9uIiwiZ2V0TW9kZWwiLCJnZXRMb2dnZWRVc2VyIiwidXNlciIsIiRzZW5kVG9FbmRwb2ludCJdLCJtYXBwaW5ncyI6IjZCQUVBLFNBQUFBLEtBQ0FDLEtBQUFDLFlBQ0FELEtBQUFFLGVBeUJBLFFBQUFDLEtBQ0EsR0FBQUMsTUFDQUMsS0FDQUMsRUFBQSxDQUNBTixNQUFBTyxHQUFBLFNBQUFDLEVBQUFDLEdBQ0FELElBQUFKLEtBQ0FBLEVBQUFJLEdBQUEsR0FBQUUsT0FFQSxJQUFBQyxHQUFBTCxHQUdBLE9BRkFGLEdBQUFJLEdBQUFJLEtBQUFILEdBQ0FKLEVBQUFNLEdBQUFGLEVBQ0FFLEdBRUFYLEtBQUFhLEtBQUEsU0FBQUwsR0FDQSxHQUFBQSxJQUFBSixHQUFBLENBQ0EsR0FBQVUsR0FBQUosTUFBQUssVUFBQUMsTUFBQUMsS0FBQUMsVUFBQSxFQUNBZCxHQUFBSSxHQUFBVyxRQUFBLFNBQUFDLEdBQ0FBLEVBQUFDLE1BQUEsS0FBQVAsT0FJQWQsS0FBQXNCLE9BQUEsU0FBQUMsR0FDQSxHQUFBQyxHQUFBLENBQ0EsSUFBQUQsSUFBQWxCLEdBQUEsQ0FDQSxHQUFBSSxHQUFB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QUFBbUcsUUFBQSxXQUNBNVEsRUFBQXlLLEtBQUFvSixPQUFBMU4sRUFBQUwsRUFBQWdHLEtBRUEsTUFBQXhLLEdBQ0F5SyxFQUFBekssT0FLQWlKLEVBQUE3TCxVQUFBb2IsY0FBQSxXQUNBLEdBQUE5WixHQUFBckMsSUFDQSxPQUFBQSxNQUFBOE0sS0FBQTlKLFdBQUFnQixhQUFBc08sUUFDQXRTLEtBQUF3QyxJQUFBLFlBQUF4QyxLQUFBOE0sS0FBQTlKLFdBQUFnQixhQUFBc08sU0FFQSxHQUFBcEUsU0FBQSxTQUFBQyxFQUFBQyxHQUNBL0wsRUFBQUgsS0FBQSxZQUFBLFNBQUFrYSxHQUNBL1osRUFBQUcsSUFBQSxZQUFBNFosR0FBQTNMLEtBQUF0QyxRQU1BdkIsRUFBQTdMLFVBQUFzYixnQkFBQSxTQUFBck8sRUFBQXRLLEdBQ0EsTUFBQTFELE1BQUE4TSxLQUFBMUYsTUFBQTRHLEVBQUF0SyxJQUdBa0osRUFBQTdMLFVBQUEwUixNQUFBLFNBQUFDLEVBQUFDLEdBQ0EsTUFBQTNTLE1BQUE4TSxLQUFBOUosV0FBQXlQLE1BQUFDLEVBQUFDIiwiZmlsZSI6InJ3dC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmZ1bmN0aW9uIEhhbmRsZXIoKXtcbiAgICB0aGlzLmhhbmRsZXJzID0gW107XG4gICAgdGhpcy5zdHJIYW5kbGVycyA9IHt9O1xufTtcblxuSGFuZGxlci5wcm90b3R5cGUuYWRkSGFuZGxlciA9IGZ1bmN0aW9uIChoYW5kbGVyKXtcbiAgICB2YXIgc3RySGFuZGxlciA9IHV0aWxzLmhhc2goaGFuZGxlci50b1N0cmluZygpKTtcbiAgICBpZiAoIShzdHJIYW5kbGVyIGluIHRoaXMuc3RySGFuZGxlcnMpKXtcbiAgICAgICAgdGhpcy5zdHJIYW5kbGVyc1tzdHJIYW5kbGVyXSA9IGhhbmRsZXI7XG4gICAgICAgIHRoaXMuaGFuZGxlcnMucHVzaChoYW5kbGVyKTtcbiAgICB9XG59O1xuSGFuZGxlci5wcm90b3R5cGUuaGFuZGxlID0gZnVuY3Rpb24oKXtcbiAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywwKTtcbiAgICB0aGlzLmhhbmRsZXJzLmZvckVhY2goZnVuY3Rpb24oZnVuYyl7XG4gICAgICAgIGZ1bmMuYXBwbHkobnVsbCxhcmdzKTtcbiAgICB9KVxufTtcbkhhbmRsZXIucHJvdG90eXBlLmhhbmRsZUJ5ID0gZnVuY3Rpb24oKXtcbiAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywxKTtcbiAgICB2YXIgdGhzID0gYXJndW1lbnRzWzBdO1xuICAgIHRoaXMuaGFuZGxlcnMuZm9yRWFjaChmdW5jdGlvbihmdW5jKXtcbiAgICAgICAgZnVuYy5hcHBseSh0aHMsYXJncyk7XG4gICAgfSlcbn07XG5cblxuZnVuY3Rpb24gTmFtZWRFdmVudE1hbmFnZXIgKCl7XG4gICAgdmFyIGV2ZW50cyA9IHt9O1xuICAgIHZhciBoYW5kbGVySWQgPSB7fTtcbiAgICB2YXIgaWR4SWQgPSAwO1xuICAgIHRoaXMub24gPSBmdW5jdGlvbihuYW1lLCBmdW5jKXtcbiAgICAgICAgaWYgKCEobmFtZSBpbiBldmVudHMpKXtcbiAgICAgICAgICAgIGV2ZW50c1tuYW1lXSA9IG5ldyBBcnJheSgpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBpZCA9IGlkeElkICsrO1xuICAgICAgICBldmVudHNbbmFtZV0ucHVzaChmdW5jKTtcbiAgICAgICAgaGFuZGxlcklkW2lkXSA9IGZ1bmM7XG4gICAgICAgIHJldHVybiBpZDtcbiAgICB9O1xuICAgIHRoaXMuZW1pdCA9IGZ1bmN0aW9uKG5hbWUpe1xuICAgICAgICBpZiAobmFtZSBpbiBldmVudHMpe1xuICAgICAgICAgICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMSk7XG4gICAgICAgICAgICBldmVudHNbbmFtZV0uZm9yRWFjaChmdW5jdGlvbihldmVudCl7XG4gICAgICAgICAgICAgICAgZXZlbnQuYXBwbHkobnVsbCxhcmdzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICB0aGlzLnVuYmluZCA9IGZ1bmN0aW9uKGhhbmRsZXIpe1xuICAgICAgICB2YXIgY291bnQgPSAwO1xuICAgICAgICBpZiAoaGFuZGxlciBpbiBoYW5kbGVySWQpe1xuICAgICAgICAgICAgdmFyIGZ1bmMgPSBoYW5kbGVySWRbaGFuZGxlciArICcnXTtcbiAgICAgICAgICAgIExhenkoZXZlbnRzKS5lYWNoKGZ1bmN0aW9uKHYsayl7XG4gICAgICAgICAgICAgICAgdmFyIGlkeCA9IFtdO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIG4gaW4gdil7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2W25dID09PSBmdW5jKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkeC5wdXNoKG4pO1xuICAgICAgICAgICAgICAgICAgICAgICAgY291bnQrKztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZHgucmV2ZXJzZSgpLmZvckVhY2goZnVuY3Rpb24oeCl7XG4gICAgICAgICAgICAgICAgICAgIHYuc3BsaWNlKHgsMSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBkZWxldGUgaGFuZGxlcklkW2hhbmRsZXJdO1xuICAgICAgICByZXR1cm4gY291bnQ7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBDYWxsIGV2ZW50IG9uY2VcbiAgICAgKi9cbiAgICB0aGlzLm9uY2UgPSBmdW5jdGlvbihldmVudE5hbWUsIGhhbmRsZXJGdW5jdGlvbikge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIHZhciBoYW5kbGVyID0gdGhpcy5vbihldmVudE5hbWUsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBoYW5kbGVyRnVuY3Rpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgIHNlbGYudW5iaW5kKGhhbmRsZXIpO1xuICAgICAgICB9KVxuICAgIH1cbn1cbiIsIid1c2Ugc3RyaWN0JztcblxudmFyIGNhY2hlZEtleUlkeCA9IDA7XG5cbnZhciBudWxsU3RyaW5nID0gZnVuY3Rpb24oKSB7IHJldHVybiAnJ307XG5cbmZ1bmN0aW9uIG1vY2tPYmplY3QoKXtcbiAgICByZXR1cm4gbmV3IFByb3h5KHt9LCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24odGFyZ2V0LCBuYW1lKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIG5hbWUgID09PSAnc3RyaW5nJyl7XG4gICAgICAgICAgICAgICAgaWYgKG5hbWUgPT09ICd0b1N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGxTdHJpbmc7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHV0aWxzLm1vY2s7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGFyZ2V0W25hbWVdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSlcbn1cblxuLypcbnZhciAkUE9TVCA9IGZ1bmN0aW9uKHVybCwgZGF0YSwgY2FsbEJhY2ssIGVycm9yQmFjayxoZWFkZXJzKXtcbiAgICB2YXIgb3B0cyA9IHtcbiAgICAgICAgYWNjZXB0cyA6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgdXJsIDogdXJsLFxuICAgICAgICBkYXRhIDogSlNPTi5zdHJpbmdpZnkoZGF0YSksXG4gICAgICAgIGRhdGFUeXBlIDogJ2pzb24nLFxuICAgICAgICBzdWNjZXNzIDogY2FsbEJhY2ssXG4gICAgICAgIGVycm9yIDogZXJyb3JCYWNrLFxuICAgICAgICBtZXRob2QgOiAnUE9TVCcsXG4gICAgICAgIGNvbnRlbnRUeXBlIDogJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgfTtcbiAgICBpZiAoaGVhZGVycyl7XG4gICAgICAgIG9wdHMuaGVhZGVycyA9IGhlYWRlcnM7XG4gICAgICAgIG9wdHMuY3Jvc3NEb21haW4gPSB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gJC5hamF4KG9wdHMpO1xufVxuXG5cbmZ1bmN0aW9uIHJlV2hlZWxDb25uZWN0aW9uKGVuZFBvaW50LCBnZXRMb2dpbil7XG4gICAgLy8gbWFpbiBcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdGhpcy5nZXRMb2dpbiA9IGdldExvZ2luO1xuICAgIHRoaXMuZXZlbnRzID0gbmV3IE5hbWVkRXZlbnRNYW5hZ2VyKClcbiAgICB0aGlzLiRQT1NUID0gJFBPU1QuYmluZCh0aGlzKTtcbiAgICB0aGlzLm9wdGlvbnMgPSB7ZW5kUG9pbnQgOiBlbmRQb2ludH07XG4gICAgdGhpcy5vbiA9IHRoaXMuZXZlbnRzLm9uLmJpbmQodGhpcyk7XG59O1xuXG5yZVdoZWVsQ29ubmVjdGlvbi5wcm90b3R5cGUudXBkYXRlU3RhdHVzID0gZnVuY3Rpb24oc3RhdHVzLCBjYWxsQmFjaywgZXJyb3IpIHtcbiAgICBpZiAoc3RhdHVzKSB7XG4gICAgICAgIHZhciBpc0xvZ2dlZCA9IChzdGF0dXMudXNlcl9pZCAmJiAhdGhpcy5vcHRpb25zLnVzZXJfaWQgKTtcbiAgICAgICAgZm9yICh2YXIgeCBpbiBzdGF0dXMpeyB0aGlzLm9wdGlvbnNbeF0gPSBzdGF0dXNbeF07IH1cbiAgICAgICAgbG9jYWxTdG9yYWdlLmxhc3RSV1RTdGF0dXMgPSBKU09OLnN0cmluZ2lmeShzdGF0dXMpO1xuICAgICAgICBpZiAoaXNMb2dnZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZXZlbnRzLmVtaXQoJ2xvZ2luJywgdGhpcy5vcHRpb25zLnVzZXJfaWQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmICghdGhpcy5vcHRpb25zLnVzZXJfaWQgJiYgdGhpcy5nZXRMb2dpbil7XG4gICAgICAgIHZhciBsb2dJbmZvID0gdGhpcy5nZXRMb2dpbihlcnJvcik7XG4gICAgICAgIGlmIChsb2dJbmZvLmNvbnN0cnVjdG9yID09PSBPYmplY3Qpe1xuICAgICAgICAgICAgdGhpcy5sb2dpbihsb2dJbmZvLnVzZXJuYW1lLCBsb2dJbmZvLnBhc3N3b3JkKVxuICAgICAgICAgICAgLnRoZW4oKGZ1bmN0aW9uKHN0YXR1cyl7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVTdGF0dXMoc3RhdHVzLCBjYWxsQmFjayk7XG4gICAgICAgICAgICB9KS5iaW5kKHRoaXMpKTtcbiAgICAgICAgfSBlbHNlIGlmIChsb2dJbmZvLmNvbnN0cnVjdG9yID09PSBQcm9taXNlKSB7XG4gICAgICAgICAgICBsb2dJbmZvLnRoZW4oKGZ1bmN0aW9uKG9iail7XG4gICAgICAgICAgICAgICAgdmFyIHggPSB0aGlzLmxvZ2luKG9iai51c2VybmFtZSxvYmoucGFzc3dvcmQpO1xuICAgICAgICAgICAgICAgIHZhciBtYW5hZ2VFcnJvciA9IChmdW5jdGlvbihiYWQpe1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXR1cyhudWxsLGNhbGxCYWNrLGJhZC5lcnJvcik7XG4gICAgICAgICAgICAgICAgfSkuYmluZCh0aGlzKTtcbiAgICAgICAgICAgICAgICBpZiAoY2FsbEJhY2spe1xuICAgICAgICAgICAgICAgICAgICB4LnRoZW4oY2FsbEJhY2ssbWFuYWdlRXJyb3IpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHgudGhlbihudWxsLCBtYW5hZ2VFcnJvcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuYmluZCh0aGlzKSk7XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICBjYWxsQmFjayAmJiBjYWxsQmFjayh0aGlzLm9wdGlvbnMpO1xuICAgIH0gICAgXG59XG5cbnJlV2hlZWxDb25uZWN0aW9uLnByb3RvdHlwZS5zdGF0dXMgPSBmdW5jdGlvbihjYWxsQmFjaywgZm9yY2Upe1xuICAgIGlmICgoJ2xhc3RSV1RTdGF0dXMnIGluIGxvY2FsU3RvcmFnZSkgJiYgIWZvcmNlKSB7XG4gICAgICAgIHRyeXtcbiAgICAgICAgICAgIHZhciBzdGF0dXMgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5sYXN0UldUU3RhdHVzKTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdHVzKHN0YXR1cyxjYWxsQmFjayk7XG4gICAgICAgIH0gY2F0Y2ggKGUpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RhdHVzKGNhbGxCYWNrLCB0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY2FsbEJhY2sgJiYgY2FsbEJhY2soc3RhdHVzKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuX3N0YXR1c19jYWxsaW5nKXtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICByZXR1cm4gc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgc2VsZi5zdGF0dXMoY2FsbEJhY2spO1xuICAgICAgICB9LDUwKTtcbiAgICB9XG4gICAgaWYgKHRoaXMub3B0aW9ucyAmJiB0aGlzLm9wdGlvbnMudGltZXN0YW1wKXtcbiAgICAgICAgY2FsbEJhY2sgJiYgY2FsbEJhY2sodGhpcy5vcHRpb25zKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLl9zdGF0dXNfY2FsbGluZyA9IHRydWU7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgcmV0dXJuIHRoaXMuJHBvc3QoJ2FwaS9zdGF0dXMnLG51bGwsZnVuY3Rpb24oc3RhdHVzKXtcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5sYXN0UldUU3RhdHVzID0gSlNPTi5zdHJpbmdpZnkoc3RhdHVzKTtcbiAgICAgICAgICAgIHNlbGYuX3N0YXR1c19jYWxsaW5nID0gZmFsc2U7XG4gICAgICAgICAgICBzZWxmLnVwZGF0ZVN0YXR1cyhzdGF0dXMsY2FsbEJhY2spO1xuICAgICAgICB9KTsgICAgICAgIFxuICAgIH1cbn07XG5cbnJlV2hlZWxDb25uZWN0aW9uLnByb3RvdHlwZS4kcG9zdCA9IGZ1bmN0aW9uKHVybCwgZGF0YSxjYWxsQmFjayl7XG4gICAgdmFyIHRocyA9IHRoaXM7XG4gICAgaWYgKHRoaXMub3B0aW9ucyAmJiB0aGlzLm9wdGlvbnMudG9rZW4pe1xuICAgICAgICBpZiAoIWRhdGEpe1xuICAgICAgICAgICAgZGF0YSA9IHt9O1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmICh0aGlzLm9wdGlvbnMudG9rZW4pe1xuICAgICAgICB2YXIgaGVhZGVycyA9IHsgXG4gICAgICAgICAgICB0b2tlbiA6IHRoaXMub3B0aW9ucy50b2tlbixcbiAgICAgICAgICAgIGFwcGxpY2F0aW9uIDogdGhpcy5vcHRpb25zLmFwcGxpY2F0aW9uXG4gICAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIGhlYWRlcnMgPSBudWxsO1xuICAgIH1cblxuICAgIHZhciBwcm9taXNlID0gbmV3IFByb21pc2UoZnVuY3Rpb24oYWNjZXB0LHJlamVjdCl7XG4gICAgICAgIHV0aWxzLnhkcih0aHMub3B0aW9ucy5lbmRQb2ludCArIHVybCwgZGF0YSwgdGhzLm9wdGlvbnMuYXBwbGljYXRpb24sIHRocy5vcHRpb25zLnRva2VuKVxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oeGhyKXtcbiAgICAgICAgICAgICAgICB0aHMuZXZlbnRzLmVtaXQoJ2h0dHAtcmVzcG9uc2UnLCB4aHIucmVzcG9uc2VUZXh0LCB4aHIuc3RhdHVzLCB1cmwsIGRhdGEpO1xuICAgICAgICAgICAgICAgIHRocy5ldmVudHMuZW1pdCgnaHR0cC1yZXNwb25zZS0nICsgeGhyLnN0YXR1cywgeGhyLnJlc3BvbnNlVGV4dCwgdXJsLCBkYXRhKTtcbiAgICAgICAgICAgICAgICBpZiAoeGhyLnJlc3BvbnNlRGF0YSl7XG4gICAgICAgICAgICAgICAgICAgIHRocy5ldmVudHMuZW1pdCgnaHR0cC1yZXNwb25zZS0nICsgeGhyLnN0YXR1cyArICctanNvbicsIHhoci5yZXNwb25zZURhdGEsIHVybCwgZGF0YSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChjYWxsQmFjaykgeyBjYWxsQmFjayggeGhyLnJlc3BvbnNlRGF0YSB8fCB4aHIucmVzcG9uc2VUZXh0ICl9O1xuICAgICAgICAgICAgICAgIGFjY2VwdCh4aHIucmVzcG9uc2VEYXRhIHx8IHhoci5yZXNwb25zZVRleHQpO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24oeGhyKSB7XG4gICAgICAgICAgICAgICAgaWYgKHhoci5yZXNwb25zZURhdGEpe1xuICAgICAgICAgICAgICAgICAgICB0aHMuZXZlbnRzLmVtaXQoJ2Vycm9yLWpzb24nLCB4aHIucmVzcG9uc2VEYXRhLCB4aHIuc3RhdHVzLCB1cmwsIGRhdGEsIHhocik7XG4gICAgICAgICAgICAgICAgICAgIHRocy5ldmVudHMuZW1pdCgnZXJyb3ItanNvbi0nICsgeGhyLnN0YXR1cywgeGhyLnJlc3BvbnNlRGF0YSx1cmwsIGRhdGEsIHhocik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHsgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIHRocy5ldmVudHMuZW1pdCgnZXJyb3ItaHR0cCcseGhyLnJlc3BvbnNlVGV4dCwgeGhyLnN0YXR1cyx1cmwsZGF0YSx4aHIpO1xuICAgICAgICAgICAgICAgICAgICB0aHMuZXZlbnRzLmVtaXQoJ2Vycm9yLWh0dHAtJyArIHhoci5zdGF0dXMsIHhoci5yZXNwb25zZVRleHQsdXJsLGRhdGEseGhyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmVqZWN0KHhoci5yZXNwb25zZURhdGEgfHwgeGhyLnJlc3BvbnNlVGV4dCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgcmV0dXJuIHByb21pc2U7XG59O1xuXG5yZVdoZWVsQ29ubmVjdGlvbi5wcm90b3R5cGUubG9naW4gPSBmdW5jdGlvbih1c2VybmFtZSwgcGFzc3dvcmQpe1xuICAgIHZhciB1cmwgPSB0aGlzLm9wdGlvbnMuZW5kUG9pbnQgKyAnYXBpL2xvZ2luJztcbiAgICB2YXIgY29ubmVjdGlvbiA9IHRoaXM7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKGFjY2VwdCxyZWplY3Qpe1xuICAgICAgICB1dGlscy54ZHIodXJsLHsgdXNlcm5hbWU6IHVzZXJuYW1lLCBwYXNzd29yZCA6IHBhc3N3b3JkfSwgbnVsbCxjb25uZWN0aW9uLm9wdGlvbnMudG9rZW4sIHRydWUpXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbih4aHIpe1xuICAgICAgICAgICAgICAgIGNvbm5lY3Rpb24udXBkYXRlU3RhdHVzKHhoci5yZXNwb25zZURhdGEpO1xuICAgICAgICAgICAgICAgIGFjY2VwdChzdGF0dXMpO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24oeGhyKXtcbiAgICAgICAgICAgICAgICByZWplY3QoeGhyLnJlc3BvbnNlRGF0YSB8fCB4aHIucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICAgIH0pO1xuICAgIH0pO1xufTtcblxucmVXaGVlbENvbm5lY3Rpb24ucHJvdG90eXBlLmNvbm5lY3QgPSBmdW5jdGlvbihjYWxsQmFjayl7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHZhciB3c2Nvbm5lY3QgPSBmdW5jdGlvbihzZWxmKXtcbiAgICAgICAgc2VsZi53c0Nvbm5lY3Rpb24gPSBuZXcgdXRpbHMud3NDb25uZWN0KHNlbGYub3B0aW9ucyk7XG4gICAgICAgIHNlbGYud3NDb25uZWN0aW9uLm9uQ29ubmVjdChmdW5jdGlvbigpe1xuICAgICAgICAgICAgc2VsZi5ldmVudHMuZW1pdCgnd3MtY29ubmVjdGVkJywgc2VsZi53c0Nvbm5lY3Rpb24pO1xuICAgICAgICB9KTtcbiAgICAgICAgc2VsZi53c0Nvbm5lY3Rpb24ub25EaXNjb25uZWN0KGZ1bmN0aW9uKCl7IFxuICAgICAgICAgICAgaWYgKHNlbGYub3B0aW9ucyAmJiBzZWxmLm9wdGlvbnMucmVhbHRpbWVFbmRQb2ludCl7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICB3c2Nvbm5lY3Qoc2VsZik7ICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIH0sMTAwMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gdGhpcy5zdGF0dXMoKGZ1bmN0aW9uKHN0YXR1cyl7XG4gICAgICAgIGlmICgndG9rZW4nIGluIHNlbGYub3B0aW9ucyl7XG4gICAgICAgICAgICBjYWxsQmFjayAmJiBjYWxsQmFjayhzdGF0dXMpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2Nvbm5lY3RpbmcgdG8gJyArIHNlbGYub3B0aW9ucy5lbmRQb2ludCk7XG4gICAgICAgICAgICBpZiAoc2VsZi5vcHRpb25zLnVzZXJuYW1lICYmIHNlbGYub3B0aW9ucy5wYXNzd29yZCl7XG4gICAgICAgICAgICAgICAgc2VsZi5sb2dpbihcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5vcHRpb25zLnVzZXJuYW1lLFxuICAgICAgICAgICAgICAgICAgICBzZWxmLm9wdGlvbnMucGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbEJhY2sgJiYgY2FsbEJhY2soZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncmVuZXdpbmcgY29ubmVjdGlvbicpXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNlbGYub3B0aW9ucy50b2tlbiAmJiBzZWxmLm9wdGlvbnMucmVhbHRpbWVFbmRQb2ludCAmJiAoIXNlbGYud3NDb25uZWN0aW9uKSl7XG4gICAgICAgICAgICB3c2Nvbm5lY3Qoc2VsZik7XG4gICAgICAgIH1cbiAgICB9KS5iaW5kKHRoaXMpKTtcbn07XG5cbnJlV2hlZWxDb25uZWN0aW9uLnByb3RvdHlwZS5sb2dPdXQgPSBmdW5jdGlvbih1cmwsIGNhbGxCYWNrKXtcbiAgICByZXR1cm4gdGhpcy4kcG9zdCgnYXBpL2xvZ291dCcse30sKGZ1bmN0aW9uKHN0YXR1cykge1xuICAgICAgICBpZiAoJ2xhc3RSV1RTdGF0dXMnIGluIGxvY2FsU3RvcmFnZSkge1xuICAgICAgICAgICAgZGVsZXRlIGxvY2FsU3RvcmFnZS5sYXN0UldUU3RhdHVzO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IHtlbmRQb2ludDogdGhpcy5vcHRpb25zLmVuZFBvaW50fTtcbiAgICAgICAgaWYgKHRoaXMud3NDb25uZWN0aW9uKSB7IFxuICAgICAgICAgICAgdGhpcy53c0Nvbm5lY3Rpb24uY2xvc2UoKTtcbiAgICAgICAgICAgIHRoaXMud3NDb25uZWN0aW9uID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodXJsKSB7IGxvY2F0aW9uID0gdXJsOyB9XG4gICAgICAgIGNhbGxCYWNrICYmIGNhbGxCYWNrKCk7XG4gICAgfSkuYmluZCh0aGlzKSk7XG59XG4qL1xudmFyIHV0aWxzID0ge1xuICAgIHJlbmFtZUZ1bmN0aW9uIDogZnVuY3Rpb24gKG5hbWUsIGZuKSB7XG4gICAgICAgIHJldHVybiAobmV3IEZ1bmN0aW9uKFwicmV0dXJuIGZ1bmN0aW9uIChjYWxsKSB7IHJldHVybiBmdW5jdGlvbiBcIiArIG5hbWUgK1xuICAgICAgICAgICAgXCIgKCkgeyByZXR1cm4gY2FsbCh0aGlzLCBhcmd1bWVudHMpIH07IH07XCIpKCkpKEZ1bmN0aW9uLmFwcGx5LmJpbmQoZm4pKTtcbiAgICB9LFxuICAgIGNhY2hlZCA6IGZ1bmN0aW9uKGZ1bmMsIGtleSl7XG4gICAgICAgIGlmICgha2V5KXsgICAgXG4gICAgICAgICAgICBrZXkgPSAnXycgKyBjYWNoZWRLZXlJZHgrKztcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiB3cmFwcGVyKCl7XG4gICAgICAgICAgICBpZiAoIXRoaXNba2V5XSl7XG4gICAgICAgICAgICAgICAgdGhpc1trZXldID0gZnVuYy5jYWxsKHRoaXMsW2FyZ3VtZW50c10pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXNba2V5XTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHdyYXBwZXI7XG4gICAgfSxcbi8vICAgICRQT1NUIDogJFBPU1QsXG4vLyAgICByZVdoZWVsQ29ubmVjdGlvbjogcmVXaGVlbENvbm5lY3Rpb24sXG4gICAgbG9nOiBmdW5jdGlvbigpeyBcbiAgICAgICAgY29uc29sZS5sb2coYXJndW1lbnRzKTtcbiAgICB9LFxuXG4gICAgeGRyOiBmdW5jdGlvbiAodXJsLCBkYXRhLCBhcHBsaWNhdGlvbix0b2tlbiwgZm9ybUVuY29kZSkge1xuICAgICAgICAvKipcbiAgICAgICAgICogTWFrZSBhbiBIVFRQIFJlcXVlc3QgYW5kIHJldHVybiBpdHMgcHJvbWlzZS5cbiAgICAgICAgICovXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihhY2NlcHQsIHJlamVjdCkge1xuICAgICAgICAgICAgdmFyIHJlcTtcbiAgICAgICAgICAgIGlmICghZGF0YSkgeyBkYXRhID0ge307fVxuXG4gICAgICAgICAgICBpZihYTUxIdHRwUmVxdWVzdCkge1xuICAgICAgICAgICAgICAgIHJlcSA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgICAgICAgICAgIHJlcS5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcS5yZWFkeVN0YXRlID09PSA0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0cnl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlRGF0YSA9IEpTT04ucGFyc2UocmVxLnJlc3BvbnNlVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChhKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2VEYXRhID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IHtyZXNwb25zZURhdGE6IHJlc3BvbnNlRGF0YSwgcmVzcG9uc2VUZXh0OiByZXEucmVzcG9uc2VUZXh0LHN0YXR1czogcmVxLnN0YXR1cywgcmVxdWVzdDogcmVxfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXEuc3RhdHVzID49IDIwMCAmJiByZXEuc3RhdHVzIDwgNDAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjZXB0KHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9IGVsc2UgaWYoWERvbWFpblJlcXVlc3Qpe1xuICAgICAgICAgICAgICAgIHJlcSA9IG5ldyBYRG9tYWluUmVxdWVzdCgpO1xuICAgICAgICAgICAgICAgIHJlcS5vbmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgYWNjZXB0KHJlcS5yZXNwb25zZVRleHQscmVxLnN0YXR1c1RleHQsIHJlcSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcignQ09SUyBub3Qgc3VwcG9ydGVkJykpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXEub3BlbignUE9TVCcsIHVybCwgdHJ1ZSk7XG4gICAgICAgICAgICByZXEub25lcnJvciA9IHJlamVjdDtcbiAgICAgICAgICAgIHJlcS5zZXRSZXF1ZXN0SGVhZGVyKCdBY2NlcHQnLCdhcHBsaWNhdGlvbi9qc29uJyk7XG4gICAgICAgICAgICBpZiAodG9rZW4pIHsgZGF0YS5fX3Rva2VuX18gPSB0b2tlbiB9XG4gICAgICAgICAgICBpZiAoIWZvcm1FbmNvZGUpe1xuICAgICAgICAgICAgICAgIHJlcS5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCd0ZXh0L3BsYWluJyk7XG4gICAgICAgICAgICAgICAgZGF0YSA9IExhenkoZGF0YSkuc2l6ZSgpP0pTT04uc3RyaW5naWZ5KGRhdGEpOicnO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXEuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJyk7XG4gICAgICAgICAgICAgICAgZGF0YSA9IExhenkoZGF0YSkubWFwKGZ1bmN0aW9uKHYsayl7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gayArICc9JyArIGVuY29kZVVSSSh2LnRvU3RyaW5nKCkpOyAgXG4gICAgICAgICAgICAgICAgfSkudG9BcnJheSgpLmpvaW4oJyYnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlcS5zZW5kKGRhdGEpO1xuICAgIC8vICAgICAgICByZXEuc2VuZChudWxsKTtcbiAgICAgICAgfSlcbiAgICB9LFxuICAgIFxuICAgIGNhcGl0YWxpemUgOiBmdW5jdGlvbiAocykge1xuICAgICAgICByZXR1cm4gc1swXS50b1VwcGVyQ2FzZSgpICsgcy5zbGljZSgxKS50b0xvd2VyQ2FzZSgpO1xuICAgIH0sXG5cbiAgICBoYXNoIDogZnVuY3Rpb24oc3RyKXtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhhc2hlZCBmdW5jdGlvblxuICAgICAgICAgKi9cbiAgICAgICAgc3RyID0gc3RyLnRvU3RyaW5nKCk7XG4gICAgICAgIHZhciByZXQgPSAxO1xuICAgICAgICBmb3IgKHZhciB4ID0gMDt4PHN0ci5sZW5ndGg7eCsrKXtcbiAgICAgICAgICAgIHJldCAqPSAoMSArIHN0ci5jaGFyQ29kZUF0KHgpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKHJldCAlIDM0OTU4Mzc0OTU3KS50b1N0cmluZygpO1xuICAgIH0sXG5cbiAgICBtYWtlRmlsdGVyIDogZnVuY3Rpb24gKG1vZGVsLCBmaWx0ZXIsIHVuaWZpZXIsIGRvbnRUcmFuc2xhdGVGaWx0ZXIpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE1ha2UgZmlsdGVyIGZvciBBcnJheS5maWx0ZXIgZnVuY3Rpb24gYXMgYW4gYW5kIG9mIG9yXG4gICAgICAgICAqL1xuICAgICAgICBpZiAoIXVuaWZpZXIpIHsgdW5pZmllciA9ICcgJiYgJzt9XG4gICAgICAgIGlmIChMYXp5KGZpbHRlcikuc2l6ZSgpID09PSAwKXtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbih4KXsgcmV0dXJuIHRydWUgfTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgc291cmNlID0gTGF6eShmaWx0ZXIpLm1hcChmdW5jdGlvbih2YWxzLCBmaWVsZCl7XG4gICAgICAgICAgICBpZiAoIXZhbHMpIHsgdmFscyA9IFtudWxsXX1cbiAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheSh2YWxzKSl7XG4gICAgICAgICAgICAgICAgdmFscyA9IFt2YWxzXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghZG9udFRyYW5zbGF0ZUZpbHRlciAmJiAobW9kZWwuZmllbGRzW2ZpZWxkXS50eXBlID09PSAncmVmZXJlbmNlJykpIHtcbiAgICAgICAgICAgICAgICBmaWVsZCA9ICdfJyArIGZpZWxkO1xuICAgICAgICAgICAgICAgIHZhbHMgPSBMYXp5KHZhbHMpLm1hcChmdW5jdGlvbih4KXtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHggJiYgKHguY29uc3RydWN0b3IgIT09IE51bWJlcikpe1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHguaWQ7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB4O1xuICAgICAgICAgICAgICAgIH0pLnRvQXJyYXkoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobW9kZWwuZmllbGRzW2ZpZWxkXS50eXBlID09PSAnc3RyaW5nJyl7XG4gICAgICAgICAgICAgICAgdmFscyA9IHZhbHMubWFwKEpTT04uc3RyaW5naWZ5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAnKCcgKyAgTGF6eSh2YWxzKS5tYXAoZnVuY3Rpb24oeCl7XG4gICAgICAgICAgICAgICAgaWYgKCF4KSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ21ha2VGaWx0ZXIgeCBpcyBudWxsJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmKHggPT09IG9ybS51dGlscy5tb2NrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ21ha2VGaWx0ZXIgd2l0aCBNb2NrIE9iamVjdCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gJyh4LicgKyBmaWVsZCArICcgPT09ICcgKyB4ICsgJyknO1xuICAgICAgICAgICAgfSkuam9pbignIHx8ICcpICArJyknO1xuICAgICAgICB9KS50b0FycmF5KCkuam9pbih1bmlmaWVyKTtcbiAgICAgICAgcmV0dXJuIG5ldyBGdW5jdGlvbihcInhcIiwgXCJyZXR1cm4gXCIgKyBzb3VyY2UpO1xuICAgIH0sXG5cbiAgICBzYW1lQXMgOiBmdW5jdGlvbiAoeCwgeSkge1xuICAgICAgICAvKipcbiAgICAgICAgICogRGVlcCBlcXVhbFxuICAgICAgICAgKi9cbiAgICAgICAgZm9yICh2YXIgayBpbiB4KSB7XG4gICAgICAgICAgICBpZiAoeVtrXSAhPSB4W2tdKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG4gICAgXG4gICAgcGx1cmFsaXplIDogZnVuY3Rpb24oc3RyLCBtb2RlbCl7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBMZXhpY2FsbHkgcmV0dXJucyBlbmdsaXNoIHBsdXJhbCBmb3JtXG4gICAgICAgICAqL1xuICAgICAgICByZXR1cm4gc3RyICsgJ3MnO1xuICAgIH0sXG5cbiAgICBiZWZvcmVDYWxsIDogZnVuY3Rpb24oZnVuYywgYmVmb3JlKXtcbiAgICAgICAgdmFyIGRlY29yYXRvciA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBiZWZvcmUoKS50aGVuKGZ1bmMpXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBkZWNvcmF0b3I7XG4gICAgfSxcblxuICAgIGNsZWFuU3RvcmFnZSA6IGZ1bmN0aW9uKCl7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDbGVhbiBsb2NhbFN0b3JhZ2Ugb2JqZWN0XG4gICAgICAgICAqL1xuICAgICAgICBMYXp5KGxvY2FsU3RvcmFnZSkua2V5cygpLmVhY2goZnVuY3Rpb24oayl7XG4gICAgICAgICAgICBkZWxldGUgbG9jYWxTdG9yYWdlW2tdO1xuICAgICAgICB9KVxuICAgIH0sXG5cbiAgICBjbGVhbkRlc2NyaXB0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgTGF6eShsb2NhbFN0b3JhZ2UpXG4gICAgICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uKHYsIG4pIHsgcmV0dXJuIExhenkobikuc3RhcnRzV2l0aCgnZGVzY3JpcHRpb246Jyl9KVxuICAgICAgICAgICAgLmtleXMoKVxuICAgICAgICAgICAgLmVhY2goZnVuY3Rpb24obikgeyBkZWxldGUgbG9jYWxTdG9yYWdlW25dIH0pO1xuICAgIH0sXG4gICAgXG4gICAgcmV2ZXJzZSA6IGZ1bmN0aW9uIChjaHIsIHN0cikge1xuICAgICAgICByZXR1cm4gc3RyLnNwbGl0KGNocikucmV2ZXJzZSgpLmpvaW4oY2hyKTtcbiAgICB9LFxuICAgIHBlcm11dGF0aW9uczogZnVuY3Rpb24oYXJyKXtcbiAgICAgICAgdmFyIHJldCA9IFtdO1xuICAgICAgICBmb3IgKHZhciB4ID0gYXJyLmxlbmd0aC0xOyB4ID49IDA7eC0tKXtcbiAgICAgICAgICAgIGZvciAodmFyIHkgPSBhcnIubGVuZ3RoLTE7IHkgPj0gMDsgeS0tKXtcbiAgICAgICAgICAgICAgICBpZiAoeCAhPT0geSlcbiAgICAgICAgICAgICAgICAgICAgcmV0LnB1c2goW2Fyclt4XSwgYXJyW3ldXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICB9LFxuXG4gICAgd2FpdEZvcjogZnVuY3Rpb24oZnVuYywgY2FsbEJhY2spIHtcbiAgICAgICAgdmFyIHdhaXRlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKGZ1bmMoKSkge1xuICAgICAgICAgICAgICAgIGNhbGxCYWNrKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQod2FpdGVyLDUwMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgc2V0VGltZW91dCh3YWl0ZXIsIDUwMCk7XG4gICAgfSxcblxuICAgIGJvb2w6IEJvb2xlYW4sXG5cbiAgICBub29wIDogZnVuY3Rpb24oKXt9LFxuXG4gICAgdHpPZmZzZXQ6IG5ldyBEYXRlKCkuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwLFxuXG4gICAgdHJhbnNGaWVsZFR5cGU6IHtcbiAgICAgICAgZGF0ZTogZnVuY3Rpb24oeCkgeyByZXR1cm4gbmV3IERhdGUoeCAqIDEwMDAgKyB1dGlscy50ek9mZnNldCApIH0sXG4gICAgICAgIGRhdGV0aW1lOiBmdW5jdGlvbih4KSB7IHJldHVybiBuZXcgRGF0ZSh4ICogMTAwMCArIHV0aWxzLnR6T2Zmc2V0ICkgfSxcbiAgICAgICAgc3RyaW5nOiBmdW5jdGlvbih4KSB7IHJldHVybiB4LnRvU3RyaW5nKCk7IH0sXG4gICAgICAgIHRleHQ6IGZ1bmN0aW9uKHgpIHsgcmV0dXJuIHgudG9TdHJpbmcoKTsgfSxcbiAgICAgICAgaW50ZWdlcjogZnVuY3Rpb24oeCkgeyByZXR1cm4gcGFyc2VJbnQoeCk7IH0sXG4gICAgICAgIGZsb2F0OiBmdW5jdGlvbih4KSB7IHJldHVybiBwYXJzZUZsb2F0KHgpOyB9XG4gICAgfSwgXG4gICAgbW9jayA6IG1vY2tPYmplY3QoKVxufTtcblxuXG4iLCIndXNlIHN0cmljdCc7XG5cbnZhciBTVEFUVVNLRVkgPSAnbGFzdFJXVENvbm5lY3Rpb25TdGF0dXMnO1xuXG5mdW5jdGlvbiBSZWFsdGltZUNvbm5lY3Rpb24oZW5kUG9pbnQsIHJ3dENvbm5lY3Rpb24pe1xuICAgIC8qKlxuICAgICAqIENvbm5lY3RzIGEgd2Vic29ja2V0IHdpdGggcmVXaGVlbCBjb25uZWN0aW9uXG4gICAgICovXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgdmFyIGNvbm5lY3Rpb24gPSBuZXcgU29ja0pTKGVuZFBvaW50KTtcbiAgICBjb25uZWN0aW9uLm9ub3BlbiA9IGZ1bmN0aW9uICh4KSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdvcGVuIDogJyArIHgpO1xuICAgICAgICBjb25uZWN0aW9uLnRlbmFudCgpO1xuICAgICAgICByd3RDb25uZWN0aW9uLmVtaXQoJ3JlYWx0aW1lLWNvbm5lY3Rpb24tb3BlbicseCk7XG4gICAgfTtcbiAgICBjb25uZWN0aW9uLm9ubWVzc2FnZSA9IGZ1bmN0aW9uICh4KSB7XG4gICAgICAgIGlmICh4LnR5cGUgPT0gJ21lc3NhZ2UnKSB7XG4gICAgICAgICAgICAvLyQubm90aWZ5KHguZGF0YSk7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIC8vVE9ETyBzZXQgZnJvbVJlYWx0aW1lXG4gICAgICAgICAgICAgICAgcnd0Q29ubmVjdGlvbi5lbWl0KCdyZWFsdGltZS1tZXNzYWdlLWpzb24nLCBKU09OLnBhcnNlKHguZGF0YSkpO1xuICAgICAgICAgICAgICAgIC8vVE9ETyB1bnNldCBmcm9tUmVhbHRpbWVcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpe1xuICAgICAgICAgICAgICAgIHJ3dENvbm5lY3Rpb24uZW1pdCgncmVhbHRpbWUtbWVzc2FnZS10ZXh0JywgSlNPTi5wYXJzZSh4LmRhdGEpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdmcm9tIHJlYWx0aW1lICcseCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGNvbm5lY3Rpb24ub25jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2V0VGltZW91dCh1dGlscy53c0Nvbm5lY3QsMTAwMCk7XG4gICAgICAgIHJ3dENvbm5lY3Rpb24uZW1pdCgncmVhbHRpbWUtY29ubmVjdGlvbi1jbG9zZWQnKTtcbiAgICB9O1xuICAgIGNvbm5lY3Rpb24udGVuYW50ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBjb25uZWN0aW9uLnNlbmQoJ1RFTkFOVDonICsgcnd0Q29ubmVjdGlvbi5jYWNoZWRTdGF0dXMuYXBwbGljYXRpb24gKyAnOicgKyByd3RDb25uZWN0aW9uLmNhY2hlZFN0YXR1cy50b2tlbik7XG4gICAgfVxuICAgIHRoaXMuY2xvc2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgY29ubmVjdGlvbi5jbG9zZSgpO1xuICAgIH1cbn0gICAgXG5cbmZ1bmN0aW9uIHJlV2hlZWxDb25uZWN0aW9uKGVuZFBvaW50LCBnZXRMb2dpbil7XG4gICAgLyoqXG4gICAgICogQ29ubmVjdGlvbiBiYXNpYyBmb3IgcmVXaGVlbFxuICAgICAqIEBwYXJhbSBlbmRQb2ludDogc3RyaW5nIGJhc2UgdXJsIGZvciBhbGwgY29tdW5pY2F0aW9uXG4gICAgICogQHBhcmFtIGdldExvZ2luOiBmdW5jdGlvbiB0byBiZSBjYWxsZWQgaW4gY2FzZSBvZiBtaXNzaW5nIGxvZ2luLlxuICAgICAqICB0aGlzIGZ1bmN0aW9uIGNvdWxkIHJldHVybiA6XG4gICAgICogIC0gICBhIHsgdXNlcm5hbWUgOiA8dXNlcm5hbWU+ICwgcGFzc3dvcmQ6IDxwYXNzd29yZD59IG9yXG4gICAgICogIC0gICBiIFByb21pc2UgLT4geyB1c2VybmFtZSA6IDx1c2VybmFtZT4gLCBwYXNzd29yZDogPHBhc3N3b3JkPn1cbiAgICAgKi9cbiAgICAvLyBtYWluIGluaXRpYWxpemF0aW9uXG4gICAgdmFyIGV2ZW50cyA9IG5ldyBOYW1lZEV2ZW50TWFuYWdlcigpO1xuICAgIHRoaXMuZ2V0TG9naW4gPSBnZXRMb2dpbjtcbiAgICB0aGlzLmVuZFBvaW50ID0gZW5kUG9pbnQuZW5kc1dpdGgoJy8nKT8gZW5kUG9pbnQ6IChlbmRQb2ludCArICcvJyk7XG4gICAgdGhpcy5vbiA9IGV2ZW50cy5vbjtcbiAgICB0aGlzLnVuYmluZCA9IGV2ZW50cy51bmJpbmQ7XG4gICAgdGhpcy5lbWl0ID0gZXZlbnRzLmVtaXQ7XG4gICAgdGhpcy5vbmNlID0gZXZlbnRzLm9uY2U7XG4gICAgdGhpcy5jYWNoZWRTdGF0dXMgPSB7fTtcbiAgICB0aGlzLmlzQ29ubmVjdGVkID0gZmFsc2U7XG4gICAgdGhpcy5pc0xvZ2dlZEluID0gZmFsc2U7XG4gICAgLy8gcmVnaXN0ZXJpbmcgdXBkYXRlIHN0YXR1c1xuICAgIHZhciB0aHMgPSB0aGlzO1xufTtcblxucmVXaGVlbENvbm5lY3Rpb24ucHJvdG90eXBlLiRwb3N0ID0gZnVuY3Rpb24odXJsLCBkYXRhLGNhbGxCYWNrKXtcbiAgICAvKipcbiAgICAgKiBBSkFYIGNhbGwgZm9yIGZldGNoIGFsbCBkYXRhIGZyb20gc2VydmVyXG4gICAgICogQHBhcmFtIHVybDogbGFzdCB1cmwgcGFydCBmb3IgYWpheCBjYWxsXG4gICAgICogQHBhcmFtIGRhdGE6IGRhdGEgb2JqZWN0IHRvIGJlIHNlbnRcbiAgICAgKiBAcGFyYW0gY2FsbEJhY2s6IGZ1bmN0aW9uKHhocikgd2lsbCBiZSBjYWxsZWQgd2hlbiBkYXRhIGFycml2ZXNcbiAgICAgKiBAcmV0dXJucyBQcm9taXNlPHhocj4gc2FtZSBvZiBjYWxsQmFja1xuICAgICAqL1xuICAgIC8vIGluaXRpYWxpemF0aW9uXG4gICAgdmFyIHRocyA9IHRoaXM7XG4gICAgdmFyIHByb21pc2UgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihhY2NlcHQscmVqZWN0KXtcbiAgICAgICAgdXRpbHMueGRyKHRocy5lbmRQb2ludCArIHVybCwgZGF0YSwgdGhzLmNhY2hlZFN0YXR1cy5hcHBsaWNhdGlvbiwgdGhzLmNhY2hlZFN0YXR1cy50b2tlbilcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHhocil7XG4gICAgICAgICAgICAgICAgdGhzLmVtaXQoJ2h0dHAtcmVzcG9uc2UnLCB4aHIucmVzcG9uc2VUZXh0LCB4aHIuc3RhdHVzLCB1cmwsIGRhdGEpO1xuICAgICAgICAgICAgICAgIHRocy5lbWl0KCdodHRwLXJlc3BvbnNlLScgKyB4aHIuc3RhdHVzLCB4aHIucmVzcG9uc2VUZXh0LCB1cmwsIGRhdGEpO1xuICAgICAgICAgICAgICAgIGlmICh4aHIucmVzcG9uc2VEYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgdGhzLmVtaXQoJ2h0dHAtcmVzcG9uc2UtJyArIHhoci5zdGF0dXMgKyAnLWpzb24nLCB4aHIucmVzcG9uc2VEYXRhLCB1cmwsIGRhdGEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoY2FsbEJhY2spIHsgY2FsbEJhY2soIHhoci5yZXNwb25zZURhdGEgfHwgeGhyLnJlc3BvbnNlVGV4dCApfTtcbiAgICAgICAgICAgICAgICBhY2NlcHQoeGhyLnJlc3BvbnNlRGF0YSB8fCB4aHIucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKHhocikge1xuICAgICAgICAgICAgICAgIGlmICh4aHIucmVzcG9uc2VEYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgdGhzLmVtaXQoJ2Vycm9yLWpzb24nLCB4aHIucmVzcG9uc2VEYXRhLCB4aHIuc3RhdHVzLCB1cmwsIGRhdGEsIHhocik7XG4gICAgICAgICAgICAgICAgICAgIHRocy5lbWl0KCdlcnJvci1qc29uLScgKyB4aHIuc3RhdHVzLCB4aHIucmVzcG9uc2VEYXRhLHVybCwgZGF0YSwgeGhyKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgeyAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgdGhzLmVtaXQoJ2Vycm9yLWh0dHAnLHhoci5yZXNwb25zZVRleHQsIHhoci5zdGF0dXMsdXJsLGRhdGEseGhyKTtcbiAgICAgICAgICAgICAgICAgICAgdGhzLmVtaXQoJ2Vycm9yLWh0dHAtJyArIHhoci5zdGF0dXMsIHhoci5yZXNwb25zZVRleHQsdXJsLGRhdGEseGhyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmVqZWN0KHhoci5yZXNwb25zZURhdGEgfHwgeGhyLnJlc3BvbnNlVGV4dCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgcmV0dXJuIHByb21pc2U7XG59O1xuXG4vKipcbiAqIENoZWNrIGN1cnJlbnQgc3RhdHVzIGFuZCBjYWxsYmFjayBmb3IgcmVzdWx0cy5cbiAqIEl0IGNhY2hlcyByZXN1bHRzIGZvciBmdXJ0aGVyLlxuICogQHBhcmFtIGNhbGxiYWNrOiAoc3RhdHVzIG9iamVjdClcbiAqIEBwYXJhbSBmb3JjZTogYm9vbGVhbiBpZiB0cnVlIGVtcHRpZXMgY2FjaGUgIFxuICogQHJldHVybiB2b2lkXG4gKi9cbnJlV2hlZWxDb25uZWN0aW9uLnByb3RvdHlwZS5zdGF0dXMgPSBmdW5jdGlvbihjYWxsQmFjaywgZm9yY2UpIHtcbiAgICAvLyBpZiBmb3JjZSwgY2xlYXIgYWxsIGNhY2hlZCB2YWx1ZXNcbiAgICB2YXIga2V5ID0gJ3Rva2VuOicgKyB0aGlzLmVuZFBvaW50O1xuICAgIHZhciB0aHMgPSB0aGlzO1xuICAgIGlmIChmb3JjZSkge1xuICAgICAgICB0aGlzLmNhY2hlZFN0YXR1cyA9IHt9O1xuICAgICAgICBkZWxldGUgbG9jYWxTdG9yYWdlW2tleV07XG4gICAgfVxuICAgIGlmICh0aGlzLnN0YXR1c1dhaXRpbmcpIHtcbiAgICAgICAgLy8gd2FpdCBmb3Igc3RhdHVzXG4gICAgICAgIHV0aWxzLndhaXRGb3IoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gIXRocy5zdGF0dXNXYWl0aW5nO1xuICAgICAgICB9LCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhzLnN0YXR1cyhjYWxsQmFjayxmb3JjZSk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIHRyeSBmb3IgdmFsdWUgcmVzb2x1dGlvblxuICAgIC8vIGZpcnN0IG9uIG1lbW9yeVxuICAgIGlmIChMYXp5KHRoaXMuY2FjaGVkU3RhdHVzKS5zaXplKCkpe1xuICAgICAgICBjYWxsQmFjayh0aGlzLmNhY2hlZFN0YXR1cylcbiAgICAvLyB0aGVuIGluIGxvY2FsU3RvcmFnZVxuICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBkYXRhID0ge307XG4gICAgICAgIGlmIChrZXkgaW4gbG9jYWxTdG9yYWdlKSB7XG4gICAgICAgICAgICBkYXRhLl9fdG9rZW5fXyA9IGxvY2FsU3RvcmFnZVtrZXldO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc3RhdHVzV2FpdGluZyA9IHRydWU7XG4gICAgICAgIHRoaXMuJHBvc3QoJ2FwaS9zdGF0dXMnLGRhdGEsIGZ1bmN0aW9uKHN0YXR1cyl7XG4gICAgICAgICAgICB0aHMudXBkYXRlU3RhdHVzKHN0YXR1cyk7XG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2Vba2V5XSA9IHN0YXR1cy50b2tlbjtcbiAgICAgICAgICAgIGNhbGxCYWNrKHN0YXR1cyk7XG4gICAgICAgICAgICB0aHMuc3RhdHVzV2FpdGluZyA9IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gZG9lc24ndCBjYWxsIGNhbGxiYWNrXG4gICAgICAgIHJldHVyblxuICAgIH1cbiAgICBjYWxsQmFjayh0aGlzLmNhY2hlZFN0YXR1cyk7XG59O1xuXG5yZVdoZWVsQ29ubmVjdGlvbi5wcm90b3R5cGUudXBkYXRlU3RhdHVzID0gZnVuY3Rpb24oc3RhdHVzKXtcbiAgICB2YXIgbGFzdEJ1aWxkID0gcGFyc2VGbG9hdChsb2NhbFN0b3JhZ2UubGFzdEJ1aWxkKSB8fCAxO1xuICAgIGlmIChsYXN0QnVpbGQgPCBzdGF0dXMubGFzdF9idWlsZCl7XG4gICAgICAgIHV0aWxzLmNsZWFuRGVzY3JpcHRpb24oKTtcbiAgICAgICAgbG9jYWxTdG9yYWdlLmxhc3RCdWlsZCA9IHN0YXR1cy5sYXN0X2J1aWxkO1xuICAgIH1cbiAgICB0aGlzLmlzQ29ubmVjdGVkID0gQm9vbGVhbihzdGF0dXMudG9rZW4pO1xuICAgIHRoaXMuaXNMb2dnZWRJbiA9IEJvb2xlYW4oc3RhdHVzLnVzZXJfaWQpO1xuICAgIHZhciBvbGRTdGF0dXMgPSB0aGlzLmNhY2hlZFN0YXR1cztcbiAgICB0aGlzLmNhY2hlZFN0YXR1cyA9IHN0YXR1cztcbiAgICBpZiAoIW9sZFN0YXR1cy51c2VyX2lkICYmIHN0YXR1cy51c2VyX2lkKXtcbiAgICAgICAgdGhpcy5lbWl0KCdsb2dnZWQtaW4nLHN0YXR1cy51c2VyX2lkKTtcbiAgICB9IGVsc2UgaWYgKG9sZFN0YXR1cy51c2VyX2lkICYmICFzdGF0dXMudXNlcl9pZCl7XG4gICAgICAgIHRoaXMuZW1pdCgnbG9nZ2VkLW91dCcpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5pc0Nvbm5lY3RlZCAmJiAhdGhpcy5pc0xvZ2dlZEluKXtcbiAgICAgICAgdGhpcy5lbWl0KCdsb2dpbi1yZXF1aXJlZCcpO1xuICAgICAgICBpZiAodGhpcy5nZXRMb2dpbil7XG4gICAgICAgICAgICB2YXIgbG9naW5JbmZvID0gdGhpcy5nZXRMb2dpbigpO1xuICAgICAgICAgICAgaWYgKGxvZ2luSW5mby5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0KXtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ2luKGxvZ2luSW5mby51c2VybmFtZSwgbG9naW5JbmZvLnBhc3N3b3JkLCBsb2dpbkluZm8uY2FsbEJhY2spO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChsb2dpbkluZm8uY29uc3RydWN0b3IgPT09IFByb21pc2UpIHtcbiAgICAgICAgICAgICAgICBsb2dpbkluZm8udGhlbihmdW5jdGlvbihvYmope1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2luKG9iai51c2VybmFtZSwgb2JqLnBhc3N3b3JkLCBvYmouY2FsbEJhY2spO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gcmVhbHRpbWUgY29ubmVjdGlvbiBpcyBzZXR0ZWRcbiAgICBpZiAoIW9sZFN0YXR1cy5yZWFsdGltZUVuZFBvaW50ICYmIHN0YXR1cy5yZWFsdGltZUVuZFBvaW50KSB7XG4gICAgICAgIHRoaXMud3NDb25uZWN0aW9uID0gbmV3IFJlYWx0aW1lQ29ubmVjdGlvbihzdGF0dXMucmVhbHRpbWVFbmRQb2ludCwgdGhpcyk7XG4gICAgLy8gcmVhbHRpbWUgY29ubmVjdGlvbiBpcyBjbG9zZWRcbiAgICB9IGVsc2UgaWYgKG9sZFN0YXR1cy5yZWFsdGltZUVuZFBvaW50ICYmICFzdGF0dXMucmVhbHRpbWVFbmRQb2ludCkge1xuICAgICAgICB0aGlzLndzQ29ubmVjdGlvbi5jbG9zZSgpO1xuICAgICAgICBkZWxldGUgdGhpcy53c0Nvbm5lY3Rpb247XG4gICAgfVxuICAgIHRoaXMuZW1pdCgndXBkYXRlLWNvbm5lY3Rpb24tc3RhdHVzJywgc3RhdHVzLCBvbGRTdGF0dXMpO1xuICAgIGxvY2FsU3RvcmFnZVtTVEFUVVNLRVldID0gSlNPTi5zdHJpbmdpZnkoc3RhdHVzKTtcbn1cblxucmVXaGVlbENvbm5lY3Rpb24ucHJvdG90eXBlLmxvZ2luID0gZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkKXtcbiAgICAvKipcbiAgICAgKiBtYWtlIGxvZ2luIGFuZCByZXR1cm4gYSBwcm9taXNlLiBJZiBsb2dpbiBzdWNjZWQsIHByb21pc2Ugd2lsbCBiZSBhY2NlcHRlZFxuICAgICAqIElmIGxvZ2luIGZhaWxzIHByb21pc2Ugd2lsbCBiZSByZWplY3RlZCB3aXRoIGVycm9yXG4gICAgICogQHBhcmFtIHVzZXJuYW1lOiB1c2VybmFtZVxuICAgICAqIEBwYXJhbSBwYXNzd29yZDogcGFzc3dvcmRcbiAgICAgKiBAcmV0dXJuIFByb21pc2UgKHVzZXIgb2JqZWN0KVxuICAgICAqL1xuICAgIHZhciB0aHMgPSB0aGlzO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihhY2NlcHQsIHJlamVjdCl7XG4gICAgICAgIHV0aWxzLnhkcih0aHMuZW5kUG9pbnQgKyAnYXBpL2xvZ2luJywge3VzZXJuYW1lOiB1c2VybmFtZSB8fCAnJywgcGFzc3dvcmQ6IHBhc3N3b3JkIHx8ICcnfSxudWxsLHRocy5jYWNoZWRTdGF0dXMudG9rZW4sIHRydWUpXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbih4aHIpe1xuICAgICAgICAgICAgICAgIC8vIHVwZGF0ZSBzdGF0dXNcbiAgICAgICAgICAgICAgICB0aHMudXBkYXRlU3RhdHVzKHhoci5yZXNwb25zZURhdGEpO1xuICAgICAgICAgICAgICAgIC8vIGNhbGwgd2l0aCB1c2VyIGlkXG4gICAgICAgICAgICAgICAgYWNjZXB0KHtzdGF0dXMgOiAnc3VjY2VzcycsIHVzZXJpZDogdGhzLmNhY2hlZFN0YXR1cy51c2VyX2lkfSk7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbih4aHIpIHtcbiAgICAgICAgICAgICAgICAvLyBpZiBlcnJvciBjYWxsIGVycm9yIG1hbmFnZXIgd2l0aCBlcnJvclxuICAgICAgICAgICAgICAgIGFjY2VwdCh7ZXJyb3I6IHhoci5yZXNwb25zZURhdGEuZXJyb3IsIHN0YXR1czogJ2Vycm9yJ30pO1xuICAgICAgICAgICAgfSk7XG4gICAgfSk7XG59O1xuXG5yZVdoZWVsQ29ubmVjdGlvbi5wcm90b3R5cGUubG9nb3V0ID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHRocyA9IHRoaXM7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKGFjY2VwdCxyZWplY3QpIHtcbiAgICAgICAgdGhzLiRwb3N0KCdhcGkvbG9nb3V0JylcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKG9rKXtcbiAgICAgICAgICAgICAgICB0aHMudXBkYXRlU3RhdHVzKHt9KTtcbiAgICAgICAgICAgICAgICBkZWxldGUgbG9jYWxTdG9yYWdlW1NUQVRVU0tFWV07XG4gICAgICAgICAgICAgICAgYWNjZXB0KClcbiAgICAgICAgICAgIH0sIHJlamVjdCk7XG4gICAgfSk7XG59O1xuXG5yZVdoZWVsQ29ubmVjdGlvbi5wcm90b3R5cGUuY29ubmVjdCA9IGZ1bmN0aW9uKGNhbGxCYWNrKSB7XG4gICAgaWYgKHRoaXMuaXNMb2dnZWRJbikge1xuICAgICAgICBjYWxsQmFjayh0aGlzLmNhY2hlZFN0YXR1cy51c2VyX2lkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyB3YWl0IGZvciBsb2dpblxuICAgICAgICB0aGlzLm9uY2UoJ2xvZ2dlZC1pbicsZnVuY3Rpb24odXNlcl9pZCl7XG4gICAgICAgICAgICBjYWxsQmFjayh1c2VyX2lkKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc3RhdHVzKGNhbGxCYWNrIHx8IHV0aWxzLm5vb3ApO1xuICAgIH1cbn1cblxudXRpbHMucmVXaGVlbENvbm5lY3Rpb24gPSByZVdoZWVsQ29ubmVjdGlvbjsiLCIndXNlIHN0cmljdCc7XG5cbmZ1bmN0aW9uIFRvdWNoZXIoKXtcbiAgICB2YXIgdG91Y2hlZCA9IGZhbHNlXG4gICAgdGhpcy50b3VjaCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHRvdWNoZWQgPSB0cnVlO1xuICAgIH07XG4gICAgdGhpcy50b3VjaGVkID0gZnVuY3Rpb24oKXtcbiAgICAgICAgdmFyIHQgPSB0b3VjaGVkO1xuICAgICAgICB0b3VjaGVkID0gZmFsc2U7XG4gICAgICAgIHJldHVybiB0O1xuICAgIH1cbn1cbiIsIid1c2Ugc3RyaWN0JztcblxuXG5mdW5jdGlvbiBWYWN1dW1DYWNoZXIodG91Y2gsIGFza2VkLCBuYW1lLCBwa0luZGV4KXtcbi8qXG4gICAgaWYgKG5hbWUpe1xuICAgICAgICBjb25zb2xlLmluZm8oJ2NyZWF0ZWQgVmFjdXVtQ2FjaGVyIGFzICcgKyBuYW1lKTtcbiAgICB9XG4qL1xuICAgIGlmICghYXNrZWQpe1xuICAgICAgICB2YXIgYXNrZWQgPSBbXTtcbiAgICB9XG4gICAgdmFyIG1pc3NpbmcgPSBbXTtcbiAgICBcbiAgICB0aGlzLmFzayA9IGZ1bmN0aW9uIChpZCxsYXp5KXtcbiAgICAgICAgaWYgKHBrSW5kZXggJiYgKGlkIGluIHBrSW5kZXguc291cmNlKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICghTGF6eShhc2tlZCkuY29udGFpbnMoaWQpKXtcbi8vICAgICAgICAgICAgY29uc29sZS5pbmZvKCdhc2tpbmcgKCcgKyBpZCArICcpIGZyb20gJyArIG5hbWUpO1xuICAgICAgICAgICAgbWlzc2luZy5wdXNoKGlkKTtcbiAgICAgICAgICAgIGlmICghbGF6eSlcbiAgICAgICAgICAgICAgICBhc2tlZC5wdXNoKGlkKTtcbiAgICAgICAgICAgIHRvdWNoLnRvdWNoKCk7XG4gICAgICAgIH0gXG4vLyAgICAgICAgZWxzZSBjb25zb2xlLndhcm4oJygnICsgaWQgKyAnKSB3YXMganVzdCBhc2tlZCBvbiAnICsgbmFtZSk7XG4gICAgfTtcblxuICAgIHRoaXMuZ2V0QXNrZWRJbmRleCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiBhc2tlZDtcbiAgICB9XG5cbiAgICB0aGlzLm1pc3NpbmdzID0gZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIExhenkobWlzc2luZy5zcGxpY2UoMCxtaXNzaW5nLmxlbmd0aCkpLnVuaXF1ZSgpLnRvQXJyYXkoKTtcbiAgICB9XG59XG4iLCJmdW5jdGlvbiBBdXRvTGlua2VyKGFjdGl2ZXMsIElEQiwgVzJQUkVTT1VSQ0UsIGxpc3RDYWNoZSl7XG4gICAgdmFyIHRvdWNoID0gbmV3IFRvdWNoZXIoKTtcbiAgICB2YXIgbWFpbkluZGV4ID0ge307XG4gICAgdmFyIGZvcmVpZ25LZXlzID0ge307XG4gICAgdmFyIG0ybSA9IHt9O1xuICAgIHZhciBtMm1JbmRleCA9IHt9O1xuICAgIHZhciBwZXJtaXNzaW9ucyA9IHt9O1xuICAgIHRoaXMubWFpbkluZGV4ID0gbWFpbkluZGV4O1xuICAgIHRoaXMuZm9yZWlnbktleXMgPSBmb3JlaWduS2V5cztcbiAgICB0aGlzLm0ybSA9IG0ybTtcbiAgICB0aGlzLm0ybUluZGV4ID0gbTJtSW5kZXg7XG4gICAgdGhpcy5wZXJtaXNzaW9ucyA9IHBlcm1pc3Npb25zO1xuXG4gICAgVzJQUkVTT1VSQ0Uub24oJ21vZGVsLWRlZmluaXRpb24nLGZ1bmN0aW9uKG1vZGVsLCBpbmRleCl7XG4gICAgICAgIC8vIGRlZmluaW5nIGFsbCBpbmRleGVzIGZvciBwcmltYXJ5IGtleVxuICAgICAgICB2YXIgcGtJbmRleCA9IGxpc3RDYWNoZS5nZXRJbmRleEZvcihtb2RlbC5uYW1lLCAnaWQnKTtcbiAgICAgICAgbWFpbkluZGV4W21vZGVsLm5hbWVdID0gbmV3IFZhY3V1bUNhY2hlcih0b3VjaCwgcGtJbmRleCwgJ21haW5JbmRleC4nICsgbW9kZWwubmFtZSwgaW5kZXgpO1xuICAgICAgICBcbiAgICAgICAgLy8gY3JlYXRpbmcgcGVybWlzc2lvbiBpbmRleGVzXG4gICAgICAgIHBlcm1pc3Npb25zW21vZGVsLm5hbWVdID0gbmV3IFZhY3V1bUNhY2hlcih0b3VjaCxudWxsLCAncGVybWlzc2lvbnMuJyArIG1vZGVsLm5hbWUpO1xuXG4gICAgICAgIC8vIGNyZWF0aW5nIGluZGV4ZXMgZm9yIGZvcmVpZ24ga2V5c1xuICAgICAgICBMYXp5KG1vZGVsLnJlZmVyZW5jZXMpLmVhY2goZnVuY3Rpb24ocmVmZXJlbmNlKXtcbiAgICAgICAgICAgIHZhciBpbmRleE5hbWUgPSBtb2RlbC5uYW1lICsgJ18nICsgcmVmZXJlbmNlLmlkO1xuICAgICAgICAgICAgZm9yZWlnbktleXNbaW5kZXhOYW1lXSA9IG5ldyBWYWN1dW1DYWNoZXIodG91Y2gsIGxpc3RDYWNoZS5nZXRJbmRleEZvcihyZWZlcmVuY2UudG8sICdpZCcpLCByZWZlcmVuY2UudG8gKyAnLmlkIGZvcmVpZ25LZXlzLicgKyBpbmRleE5hbWUpO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gY3JlYXRpbmcgcmV2ZXJzZSBmb3JlaWduIGtleXNcbiAgICAgICAgTGF6eShtb2RlbC5yZWZlcmVuY2VkQnkpLmVhY2goZnVuY3Rpb24oZmllbGQpe1xuICAgICAgICAgICAgdmFyIGluZGV4TmFtZSA9IGZpZWxkLmJ5ICsgJy4nICsgZmllbGQuaWQ7XG4gICAgICAgICAgICBmb3JlaWduS2V5c1tpbmRleE5hbWVdID0gbmV3IFZhY3V1bUNhY2hlcih0b3VjaCwgbGlzdENhY2hlLmdldEluZGV4Rm9yKGZpZWxkLmJ5LGZpZWxkLmlkKSwgZmllbGQuYnkgKyAnLicgKyBmaWVsZC5pZCArICcgZm9yZWlnbktleXMuJyArIGluZGV4TmFtZSk7XG4gICAgICAgIH0pO1xuICAgICAgICBMYXp5KG1vZGVsLm1hbnlUb01hbnkpLmVhY2goZnVuY3Rpb24ocmVsYXRpb24pe1xuICAgICAgICAgICAgaWYgKCEocmVsYXRpb24uaW5kZXhOYW1lIGluIG0ybSkpXG4gICAgICAgICAgICAgICAgbTJtW3JlbGF0aW9uLmluZGV4TmFtZV0gPSBbbmV3IFZhY3V1bUNhY2hlcih0b3VjaCxudWxsLCdtMm0uJyArIHJlbGF0aW9uLmluZGV4TmFtZSArICdbMF0nKSwgbmV3IFZhY3V1bUNhY2hlcih0b3VjaCxudWxsLCdtMm0uJyArIHJlbGF0aW9uLmluZGV4TmFtZSsnWzFdJyldO1xuICAgICAgICAgICAgaWYgKCEocmVsYXRpb24uaW5kZXhOYW1lIGluIG0ybUluZGV4KSlcbiAgICAgICAgICAgICAgICBtMm1JbmRleFtyZWxhdGlvbi5pbmRleE5hbWVdID0gbmV3IE1hbnlUb01hbnlSZWxhdGlvbihyZWxhdGlvbixtMm1bcmVsYXRpb24uaW5kZXhOYW1lXSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIHZhciBtMm1HZXQgPSBmdW5jdGlvbihpbmRleE5hbWUsIG4sIGNvbGxlY3Rpb24sIGNhbGxCYWNrKXtcbiAgICAgICAgVzJQUkVTT1VSQ0UuJHBvc3QoKG4gPyB1dGlscy5yZXZlcnNlKCcvJywgaW5kZXhOYW1lKSA6IGluZGV4TmFtZSkgKyAncycgKyAnL2xpc3QnLCB7Y29sbGVjdGlvbjogY29sbGVjdGlvbn0sIGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgVzJQUkVTT1VSQ0UuZ290RGF0YShkYXRhLCBjYWxsQmFjayk7XG4gICAgICAgICAgICBkZWxldGUgYWN0aXZlc1tpbmRleE5hbWVdXG4gICAgICAgIH0pOyAgICAgICAgXG4gICAgfTtcblxuICAgIHZhciBnZXRNMk0gPSBmdW5jdGlvbihpbmRleE5hbWUsIGNvbGxlY3Rpb24sIG4sIGNhbGxCYWNrKXtcbiAgICAgICAgLy8gYXNrIGFsbCBpdGVtcyBpbiBjb2xsZWN0aW9uIHRvIG0ybSBpbmRleFxuICAgICAgICBMYXp5KGNvbGxlY3Rpb24pLmVhY2gobTJtW2luZGV4TmFtZV1bbl0uYXNrLmJpbmQobTJtW2luZGV4TmFtZV1bbl0pKTtcbiAgICAgICAgLy8gcmVuZXdpbmcgY29sbGVjdGlvbiB3aXRob3V0IGFza2VkXG4gICAgICAgIGNvbGxlY3Rpb24gPSBtMm1baW5kZXhOYW1lXVtuXS5taXNzaW5ncygpO1xuICAgICAgICAvLyBjYWxsaW5nIHJlbW90ZSBmb3IgbTJtIGNvbGxlY3Rpb24gaWYgYW55XG4gICAgICAgIGlmIChjb2xsZWN0aW9uLmxlbmd0aCl7XG4gICAgICAgICAgICBhY3RpdmVzW2luZGV4TmFtZV0gPSAxO1xuICAgICAgICAgICAgbTJtR2V0KGluZGV4TmFtZSwgbiwgY29sbGVjdGlvbiwgY2FsbEJhY2spO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY2FsbEJhY2sgJiYgY2FsbEJhY2soKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgdGhpcy5nZXRNMk0gPSBnZXRNMk07XG5cbiAgICB2YXIgbGlua1VubGlua2VkID0gZnVuY3Rpb24oKXtcbiAgICAgICAgLy8gcGVyZm9ybSBhIERhdGFCYXNlIHN5bmNocm9uaXphdGlvbiB3aXRoIHNlcnZlciBsb29raW5nIGZvciB1bmtub3duIGRhdGFcbiAgICAgICAgaWYgKCF0b3VjaC50b3VjaGVkKCkpIHJldHVybjtcbiAgICAgICAgaWYgKExhenkoYWN0aXZlcykudmFsdWVzKCkuc3VtKCkpIHtcbiAgICAgICAgICAgIHRvdWNoLnRvdWNoKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGNoYW5nZWQgPSBmYWxzZTtcbiAgICAgICAgTGF6eShtMm0pLmVhY2goZnVuY3Rpb24oaW5kZXhlcywgaW5kZXhOYW1lKXtcbiAgICAgICAgICAgIExhenkoaW5kZXhlcykuZWFjaChmdW5jdGlvbiAoaW5kZXgsbikge1xuICAgICAgICAgICAgICAgIHZhciBjb2xsZWN0aW9uID0gaW5kZXgubWlzc2luZ3MoKTtcbiAgICAgICAgICAgICAgICBjb2xsZWN0aW9uID0gTGF6eShjb2xsZWN0aW9uKS5maWx0ZXIoQm9vbGVhbikubWFwKGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZUludCh4KVxuICAgICAgICAgICAgICAgIH0pLnRvQXJyYXkoKTtcbiAgICAgICAgICAgICAgICBpZiAoY29sbGVjdGlvbi5sZW5ndGgpe1xuICAgICAgICAgICAgICAgICAgICB2YXIgSU5ERVggPSBtMm1JbmRleFtpbmRleE5hbWVdO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZ2V0dGVyID0gSU5ERVhbJ2dldCcgKyAoMSAtIG4pXS5iaW5kKElOREVYKTtcbiAgICAgICAgICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIG0ybUdldChpbmRleE5hbWUsIG4sIGNvbGxlY3Rpb24sIGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlkcyA9IGNvbGxlY3Rpb24ubWFwKGdldHRlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWRzLmxlbmd0aCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG90aGVySW5kZXggPSBpbmRleE5hbWUuc3BsaXQoJy8nKVsxIC0gbl07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVzJQUkVTT1VSQ0UuZGVzY3JpYmUob3RoZXJJbmRleCxmdW5jdGlvbigpe1xuLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExhenkoaWRzKS5mbGF0dGVuKCkudW5pcXVlKCkuZWFjaChtYWluSW5kZXhbb3RoZXJJbmRleF0uYXNrKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTGF6eShpZHMpLmZsYXR0ZW4oKS51bmlxdWUoKS5lYWNoKGZ1bmN0aW9uKHgpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFpbkluZGV4W290aGVySW5kZXhdLmFzayh4LHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBMYXp5KG1haW5JbmRleCkuZWFjaChmdW5jdGlvbiAoaW5kZXgsIG1vZGVsTmFtZSkge1xuICAgICAgICAgICAgdmFyIGlkcyA9IGluZGV4Lm1pc3NpbmdzKCk7XG4gICAgICAgICAgICBpZiAoaWRzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHZhciBpZGIgPSBtb2RlbE5hbWUgaW4gSURCID8gSURCW21vZGVsTmFtZV0ua2V5cygpIDogTGF6eSgpO1xuICAgICAgICAgICAgICAgIC8vbG9nKCdsaW5raW5nLicgKyBtb2RlbE5hbWUgKyAnID0gJyArIFcyUFJFU09VUkNFLmxpbmtpbmcuc291cmNlW21vZGVsTmFtZV0pO1xuICAgICAgICAgICAgICAgIFcyUFJFU09VUkNFLmZldGNoKG1vZGVsTmFtZSwge2lkOiBpZHN9LG51bGwsdXRpbHMubm9vcCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBGb3JlaWduIGtleXNcbiAgICAgICAgTGF6eShmb3JlaWduS2V5cylcbiAgICAgICAgLm1hcChmdW5jdGlvbih2LGspe1xuICAgICAgICAgICAgcmV0dXJuIFtrLCB2Lm1pc3NpbmdzKCldXG4gICAgICAgIH0pLmZpbHRlcihmdW5jdGlvbih2KXtcbiAgICAgICAgICAgIHJldHVybiB2WzFdLmxlbmd0aFxuICAgICAgICB9KS5lYWNoKGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIHZhciBpZHMgPSB4WzFdO1xuICAgICAgICAgICAgdmFyIGluZGV4TmFtZSA9IHhbMF07XG4gICAgICAgICAgICB2YXIgaW5kZXggPSBpbmRleE5hbWUuc3BsaXQoJy4nKTtcbiAgICAgICAgICAgIHZhciBtYWluUmVzb3VyY2UgPSBpbmRleFswXTtcbiAgICAgICAgICAgIHZhciBmaWVsZE5hbWUgPSBpbmRleFsxXTtcbiAgICAgICAgICAgIHZhciBmaWx0ZXIgPSB7fTtcbiAgICAgICAgICAgIGZpbHRlcltmaWVsZE5hbWVdID0gaWRzO1xuICAgICAgICAgICAgVzJQUkVTT1VSQ0UuZmV0Y2gobWFpblJlc291cmNlLCBmaWx0ZXIpO1xuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIExhenkoTGF6eShwZXJtaXNzaW9ucykubWFwKGZ1bmN0aW9uKHYsayl7XG4gICAgICAgICAgICByZXR1cm4gW2ssIHYubWlzc2luZ3MoKV1cbiAgICAgICAgfSkuZmlsdGVyKGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgICByZXR1cm4gdlsxXS5sZW5ndGhcbiAgICAgICAgfSkudG9PYmplY3QoKSkuZWFjaChmdW5jdGlvbiAoaWRzLCByZXNvdXJjZU5hbWUpIHtcbiAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlO1xuICAgICAgICAgICAgaWYgKGlkcy5sZW5ndGgpe1xuICAgICAgICAgICAgICAgIGFjdGl2ZXNbcmVzb3VyY2VOYW1lXSA9IDE7XG4gICAgICAgICAgICAgICAgVzJQUkVTT1VSQ0UuJHBvc3QocmVzb3VyY2VOYW1lICsgJy9teV9wZXJtcycsIHtpZHM6IExhenkoaWRzKS51bmlxdWUoKS50b0FycmF5KCl9LCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBXMlBSRVNPVVJDRS5nb3RQZXJtaXNzaW9ucyhkYXRhLlBFUk1JU1NJT05TKTtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGFjdGl2ZXNbcmVzb3VyY2VOYW1lXVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgc2V0SW50ZXJ2YWwobGlua1VubGlua2VkLDUwKTtcbn07XG5cblxuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbmZ1bmN0aW9uIExpc3RDYWNoZXIoKXtcbiAgICB2YXIgZ290QWxsID0ge307XG4gICAgdmFyIGFza2VkID0ge307IC8vIG1hcCBvZiBhcnJheVxuICAgIHZhciBjb21wb3NpdGVBc2tlZCA9IHt9O1xuICAgIHZhciBjYXJ0ZXNpYW5Qcm9kdWN0MSA9IGZ1bmN0aW9uKHgseSxpc0FycmF5KXtcbiAgICAgICAgdmFyIHJldCA9IFtdO1xuICAgICAgICBpZiAoaXNBcnJheSkge1xuICAgICAgICAgICAgZm9yICh2YXIgYSBpbiB4KXtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBiIGluIHkpe1xuICAgICAgICAgICAgICAgICAgICByZXQucHVzaChMYXp5KFt4W2FdLHlbYl1dKS5mbGF0dGVuKCkudG9BcnJheSgpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmb3IgKHZhciBhIGluIHgpe1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGIgaW4geSl7XG4gICAgICAgICAgICAgICAgICAgIHJldC5wdXNoKFt4W2FdLHlbYl1dKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICB9O1xuICAgIHZhciBjYXJ0ZXNpYW5Qcm9kdWN0ID0gZnVuY3Rpb24oYXJyKXtcbiAgICAgICAgdmFyIGlzQXJyYXkgPSBmYWxzZTtcbiAgICAgICAgdmFyIHJldCA9IGFyclswXTsgXG4gICAgICAgIGZvciAodmFyIHggPSAxOyB4IDwgYXJyLmxlbmd0aDsgKyt4KXtcbiAgICAgICAgICAgIHJldCA9IGNhcnRlc2lhblByb2R1Y3QxKHJldCwgYXJyW3hdLCBpc0FycmF5KTtcbiAgICAgICAgICAgIGlzQXJyYXkgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXQ7XG4gICAgfVxuICAgIHZhciBleHBsb2RlRmlsdGVyID0gZnVuY3Rpb24oZmlsdGVyKSB7XG4gICAgICAgIHZhciBwcm9kdWN0ID0gY2FydGVzaWFuUHJvZHVjdChMYXp5KGZpbHRlcikudmFsdWVzKCkudG9BcnJheSgpKTtcbiAgICAgICAgdmFyIGtleXMgPSBMYXp5KGZpbHRlcikua2V5cygpLnRvQXJyYXkoKTtcbiAgICAgICAgcmV0dXJuIHByb2R1Y3QubWFwKGZ1bmN0aW9uKHgpe1xuICAgICAgICAgICAgdmFyIHIgPSB7fTtcbiAgICAgICAgICAgIGtleXMuZm9yRWFjaChmdW5jdGlvbihhLG4pe1xuICAgICAgICAgICAgICAgIHJbYV0gPSB4W25dO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIHJldHVybiByO1xuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgfTtcbiAgICB2YXIgZmlsdGVyU2luZ2xlID0gZnVuY3Rpb24obW9kZWwsIGZpbHRlciwgdGVzdE9ubHkpe1xuICAgICAgICAvLyBMYXp5IGF1dG8gY3JlYXRlIGluZGV4ZXNcbiAgICAgICAgdmFyIG1vZGVsTmFtZSA9IG1vZGVsLm1vZGVsTmFtZTtcbiAgICAgICAgdmFyIGdldEluZGV4Rm9yID0gdGhpcy5nZXRJbmRleEZvcjtcbiAgICAgICAgdmFyIGtleXMgPSBMYXp5KGZpbHRlcikubWFwKGZ1bmN0aW9uKHYsa2V5KXsgcmV0dXJuIFtrZXksIG1vZGVsTmFtZSArICcuJyArIGtleV07IH0pLnRvT2JqZWN0KCk7XG4gICAgICAgIHZhciBpbmRleGVzID0gTGF6eShmaWx0ZXIpLmtleXMoKS5tYXAoZnVuY3Rpb24oa2V5KXsgcmV0dXJuIFtrZXksIGdldEluZGV4Rm9yKG1vZGVsTmFtZSwga2V5KV19KS50b09iamVjdCgpOyBcbiAgICAgICAgLy8gZmFrZSBmb3IgKGl0IHdpbGwgY3ljbGUgb25jZSlcbiAgICAgICAgZm9yICh2YXIgeCBpbiBmaWx0ZXIpe1xuICAgICAgICAgICAgLy8gZ2V0IGFza2VkIGluZGV4IGFuZCBjaGVjayBwcmVzZW5jZVxuICAgICAgICAgICAgdmFyIGRpZmZlcmVuY2UgPSBMYXp5KGZpbHRlclt4XSkuZGlmZmVyZW5jZShpbmRleGVzW3hdKS50b0FycmF5KCk7XG4gICAgICAgICAgICBpZiAoZGlmZmVyZW5jZS5sZW5ndGgpe1xuICAgICAgICAgICAgICAgIC8vIGdlbmVyYXRlIG5ldyBmaWx0ZXJcbiAgICAgICAgICAgICAgICB2YXIgcmV0ID0gTGF6eShbW3gsIGRpZmZlcmVuY2VdXSkudG9PYmplY3QoKTtcbiAgICAgICAgICAgICAgICAvLyByZW1lbWJlciBhc2tlZFxuICAgICAgICAgICAgICAgIGlmICghdGVzdE9ubHkpXG4gICAgICAgICAgICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KGluZGV4ZXNbeF0sIGRpZmZlcmVuY2UpO1xuLy8gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3NpbmdsZSBmaWx0ZXIgOiAnICsgSlNPTi5zdHJpbmdpZnkoZmlsdGVyKSArICdcXG5PdXQgOicgKyBKU09OLnN0cmluZ2lmeShyZXQpKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgICAgICAgfSBlbHNlIHtcbi8vICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzaW5nbGUgZmlsdGVyIDogJyArIEpTT04uc3RyaW5naWZ5KGZpbHRlcikgKyAnXFxuT3V0IDogbnVsbCcpO1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcblxuICAgIHZhciBjbGVhbkNvbXBvc2l0ZXMgPSBmdW5jdGlvbihtb2RlbCxmaWx0ZXIpe1xuICAgICAgICAvKipcbiAgICAgICAgICogY2xlYW4gY29tcG9zaXRlQXNrZWRcbiAgICAgICAgICovXG4gICAgICAgIC8vIGxhenkgY3JlYXRlIGNvbmRpdGlvbmFsIGFza2VkIGluZGV4XG4gICAgICAgIGlmICghKG1vZGVsLm5hbWUgaW4gY29tcG9zaXRlQXNrZWQpKSB7IGNvbXBvc2l0ZUFza2VkW21vZGVsLm5hbWVdID0gW10gfTtcbiAgICAgICAgdmFyIGluZGV4ID0gY29tcG9zaXRlQXNrZWRbbW9kZWwubmFtZV07XG4gICAgICAgIC8vIHNlYXJjaCBmb3IgYWxsIGVsZW1lbnRzIHdobyBoYXZlIHNhbWUgcGFydGlhbFxuICAgICAgICB2YXIgZmlsdGVyTGVuID0gTGF6eShmaWx0ZXIpLnNpemUoKTtcbiAgICAgICAgdmFyIGl0ZW1zID0gaW5kZXguZmlsdGVyKHV0aWxzLm1ha2VGaWx0ZXIobW9kZWwsIGZpbHRlciwgJyAmJiAnLHRydWUpKS5maWx0ZXIoZnVuY3Rpb24oaXRlbSl7IExhenkoaXRlbSkuc2l6ZSgpID4gZmlsdGVyTGVuIH0pO1xuLy8gICAgICAgIGNvbnNvbGUubG9nKCdkZWxldGluZyA6JyArIEpTT04uc3RyaW5naWZ5KGl0ZW1zKSk7XG4gICAgfTtcblxuICAgIHRoaXMuZmlsdGVyID0gZnVuY3Rpb24obW9kZWwsIGZpbHRlcil7XG4vLyAgICAgICAgY29uc29sZS5sb2coJy0tLS0tLS0tLS0tLS0tLS0tLVxcbmZpbHRlciA6ICcgKyBKU09OLnN0cmluZ2lmeShmaWx0ZXIpKTtcbiAgICAgICAgdmFyIG1vZGVsTmFtZSA9IG1vZGVsLm1vZGVsTmFtZTtcblxuICAgICAgICAvLyBpZiB5b3UgZmV0Y2ggYWxsIG9iamVjdHMgZnJvbSBzZXJ2ZXIsIHRoaXMgbW9kZWwgaGFzIHRvIGJlIG1hcmtlZCBhcyBnb3QgYWxsO1xuICAgICAgICB2YXIgZmlsdGVyTGVuICA9IExhenkoZmlsdGVyKS5zaXplKCk7XG4gICAgICAgIHN3aXRjaCAoZmlsdGVyTGVuKSB7XG4gICAgICAgICAgICBjYXNlIDAgOiB7XG4gICAgICAgICAgICAgICAgLy8gcmV0dXJuIG51bGwgb3IgYWxsXG4gICAgICAgICAgICAgICAgdmFyIGdvdCA9IGdvdEFsbFttb2RlbE5hbWVdO1xuICAgICAgICAgICAgICAgIGdvdEFsbFttb2RlbE5hbWVdID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBpZiAobW9kZWxOYW1lIGluIGFza2VkKXtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGFza2VkW21vZGVsTmFtZV07XG4gICAgICAgICAgICAgICAgfVxuLy8gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ291dCA6IG51bGwgKGdvdCBhbGwpJyk7XG4gICAgICAgICAgICAgICAgLy8gY29uZGl0aW9uYWwgY2xlYW5cbiAgICAgICAgICAgICAgICBpZiAobW9kZWxOYW1lIGluIGNvbXBvc2l0ZUFza2VkKXsgXG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBjb21wb3NpdGVBc2tlZFttb2RlbE5hbWVdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZ290KVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICByZXR1cm4ge307XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIDEgOiB7XG4gICAgICAgICAgICAgICAgdmFyIHJldCA9IGZpbHRlclNpbmdsZS5jYWxsKHRoaXMsIG1vZGVsLCBmaWx0ZXIpO1xuICAgICAgICAgICAgICAgIGNsZWFuQ29tcG9zaXRlcy5jYWxsKHRoaXMsIG1vZGVsLCBmaWx0ZXIpO1xuICAgICAgICAgICAgICAgIHJldHVybiByZXQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHRocyA9IHRoaXM7XG4gICAgICAgIHZhciBzaW5nbGUgPSBMYXp5KGZpbHRlcikua2V5cygpLnNvbWUoZnVuY3Rpb24oa2V5KSB7XG4gICAgICAgICAgICB2YXIgZiA9IHt9O1xuICAgICAgICAgICAgZltrZXldID0gZmlsdGVyW2tleV07XG4gICAgICAgICAgICByZXR1cm4gZmlsdGVyU2luZ2xlLmNhbGwodGhzLCBtb2RlbCwgZiwgdHJ1ZSkgPT0gbnVsbDtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChzaW5nbGUpIHsgcmV0dXJuIG51bGwgfVxuICAgICAgICAvLyBsYXp5IGNyZWF0ZSBjb21wb3NpdGVBc2tlZFxuICAgICAgICBpZiAoIShtb2RlbE5hbWUgaW4gY29tcG9zaXRlQXNrZWQpKXsgY29tcG9zaXRlQXNrZWRbbW9kZWxOYW1lXSA9IFtdOyB9XG4gICAgICAgIC8vIGV4cGxvZGUgZmlsdGVyXG4gICAgICAgIHZhciBleHBsb2RlZCA9IGV4cGxvZGVGaWx0ZXIoZmlsdGVyKTtcbiAgICAgICAgLy8gY29sbGVjdCBwYXJ0aWFsc1xuICAgICAgICB2YXIgcGFydGlhbHMgPSBjb21wb3NpdGVBc2tlZFttb2RlbE5hbWVdLmZpbHRlcih1dGlscy5tYWtlRmlsdGVyKG1vZGVsLCBmaWx0ZXIsICcgfHwgJyx0cnVlKSk7XG4gICAgICAgIC8vIGNvbGxlY3QgbWlzc2luZ3MgKGV4cGxvZGVkIC0gcGFydGlhbHMpXG4gICAgICAgIGlmIChwYXJ0aWFscy5sZW5ndGgpe1xuICAgICAgICAgICAgdmFyIGJhZCAgPSBbXTtcbiAgICAgICAgICAgIC8vIHBhcnRpYWwgZGlmZmVyZW5jZVxuICAgICAgICAgICAgZm9yICh2YXIgeCBpbiBwYXJ0aWFscyl7XG4gICAgICAgICAgICAgICAgYmFkLnB1c2guYXBwbHkoYmFkLGV4cGxvZGVkLmZpbHRlcih1dGlscy5tYWtlRmlsdGVyKG1vZGVsLCBwYXJ0aWFsc1t4XSwnICYmICcsIHRydWUpKSk7XG4gICAgICAgICAgICB9XG4vLyAgICAgICAgICAgIGNvbnNvbGUubG9nKCdleHBsb2RlZCAtIHBhcnRpYWwgOiAnICsgSlNPTi5zdHJpbmdpZnkoYmFkKSk7XG4gICAgICAgICAgICB2YXIgbWlzc2luZ3MgPSBMYXp5KGV4cGxvZGVkKS5kaWZmZXJlbmNlKGJhZCkudG9BcnJheSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIG1pc3NpbmdzID0gZXhwbG9kZWQ7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBmaWx0ZXIgcGFydGlhbHNcbiAgICAgICAgaWYgKG1pc3NpbmdzLmxlbmd0aCl7XG4gICAgICAgICAgICBjb21wb3NpdGVBc2tlZFttb2RlbE5hbWVdLnB1c2guYXBwbHkoY29tcG9zaXRlQXNrZWRbbW9kZWxOYW1lXSxtaXNzaW5ncyk7XG4gICAgICAgICAgICAvLyBhZ2dyZWdhdGUgbWlzc2luZ3NcbiAgICAgICAgICAgIHZhciBtaXNzaW5ncyA9IExhenkoZmlsdGVyKS5rZXlzKCkubWFwKGZ1bmN0aW9uKGtleSl7XG4gICAgICAgICAgICAgICAgdmFyIHJldCA9IExhenkobWlzc2luZ3MpLnBsdWNrKGtleSkudW5pcXVlKCkudG9BcnJheSgpO1xuICAgICAgICAgICAgICAgIHJldHVybiBba2V5LCByZXQubGVuZ3RoP3JldDpmaWx0ZXJba2V5XV07XG4gICAgICAgICAgICB9KS50b09iamVjdCgpO1xuLy8gICAgICAgICAgICBjb25zb2xlLmxvZygnb3V0IDogJyArIEpTT04uc3RyaW5naWZ5KG1pc3NpbmdzKSk7XG4gICAgICAgICAgICAvLyBjbGVhbiBjb25kaXRpb25hbFxuICAgICAgICAgICAgY2xlYW5Db21wb3NpdGVzKG1vZGVsLCBtaXNzaW5ncyk7XG4gICAgICAgICAgICByZXR1cm4gbWlzc2luZ3M7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfTtcblxuICAgIHRoaXMuZ2V0SW5kZXhGb3IgPSBmdW5jdGlvbihtb2RlbE5hbWUsIGZpZWxkTmFtZSl7XG4gICAgICAgIHZhciBpbmRleE5hbWUgPSBtb2RlbE5hbWUgKyAnLicgKyBmaWVsZE5hbWU7XG4gICAgICAgIGlmICghKGluZGV4TmFtZSBpbiBhc2tlZCkpe1xuICAgICAgICAgICAgYXNrZWRbaW5kZXhOYW1lXSA9IFtdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhc2tlZFtpbmRleE5hbWVdO1xuICAgIH1cbn07IiwiJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiBNYW55VG9NYW55UmVsYXRpb24ocmVsYXRpb24sbTJtKXtcbiAgICB2YXIgaXRlbXMgPSBbXTtcbiAgICB0aGlzLmFkZCA9IGl0ZW1zLnB1c2guYmluZChpdGVtcyk7XG4gICAgdGhpcy5hZGQgPSBmdW5jdGlvbihpdGVtKXtcbiAgLy8gICAgICBjb25zb2xlLmxvZygnYWRkaW5nICcgKyBpdGVtKTtcbiAgICAgICAgaWYgKCEoTGF6eShpdGVtcykuZmluZChpdGVtKSkpe1xuICAgICAgICAgICAgaXRlbXMucHVzaChpdGVtKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuZ2V0MCA9IGZ1bmN0aW9uKGlkKXtcbiAgICAgICAgbTJtWzFdLmFzayhpZCk7XG4gICAgICAgIHJldHVybiBMYXp5KGl0ZW1zKS5maWx0ZXIoZnVuY3Rpb24oeCl7XG4gICAgICAgICAgICByZXR1cm4geFswXSA9PT0gaWQ7XG4gICAgICAgIH0pLnBsdWNrKFwiMVwiKS50b0FycmF5KCk7XG4gICAgfTtcblxuICAgIHRoaXMuZ2V0MSA9IGZ1bmN0aW9uKGlkKXtcbiAgICAgICAgbTJtWzBdLmFzayhpZCk7XG4gICAgICAgIHJldHVybiBMYXp5KGl0ZW1zKS5maWx0ZXIoZnVuY3Rpb24oeCl7XG4gICAgICAgICAgICByZXR1cm4geFsxXSA9PT0gaWQ7XG4gICAgICAgIH0pLnBsdWNrKFwiMFwiKS50b0FycmF5KCk7XG4gICAgfTtcbiAgICB0aGlzWydnZXQnICsgdXRpbHMuY2FwaXRhbGl6ZShyZWxhdGlvbi5pbmRleE5hbWUuc3BsaXQoJy8nKVsxXSldID0gdGhpcy5nZXQxO1xuICAgIHRoaXNbJ2dldCcgKyB1dGlscy5jYXBpdGFsaXplKHJlbGF0aW9uLmluZGV4TmFtZS5zcGxpdCgnLycpWzBdKV0gPSB0aGlzLmdldDA7XG5cbiAgICB0aGlzLmRlbCA9IGZ1bmN0aW9uKGl0ZW0pe1xuICAgICAgICB2YXIgbCA9IGl0ZW1zLmxlbmd0aDtcbiAgICAgICAgdmFyIGlkeCA9IG51bGw7XG4gICAgICAgIGZvciAodmFyIGEgPSAwOyBhIDwgbDsgYSsrKXsgXG4gICAgICAgICAgICBpZiAoKGl0ZW1zW2FdWzBdID09PSBpdGVtWzBdKSAmJiAoaXRlbXNbYV1bMV0gPT09IGl0ZW1bMV0pKXtcbiAgICAgICAgICAgICAgICBpZHggPSBhO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChpZHgpe1xuICAgICAgICAgICAgaXRlbXMuc3BsaWNlKGEsIDEpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnNvbGUubG9nKCdkZWxldGluZyAnLCBpdGVtKTtcbiAgICB9O1xufSIsIid1c2Ugc3RyaWN0JztcblxuZnVuY3Rpb24gY2FjaGVkUHJvcGVydHlCeUV2ZW50cyhwcm90bywgcHJvcGVydHlOYW1lLGdldHRlciwgc2V0dGVyKXtcbiAgICB2YXIgZXZlbnRzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDQpO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBcbiAgICBMYXp5KGV2ZW50cykuZWFjaChmdW5jdGlvbihldmVudCl7XG4gICAgICAgIHByb3RvLm9ybS5vbihldmVudCxmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmVzdWx0ID0ge307XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIHZhciBwcm9wZXJ0eURlZiA9IHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiBjYWNoZWQoKXtcbi8vICAgICAgICAgICAgcmV0dXJuIGdldHRlci5jYWxsKHRoaXMpO1xuICAgICAgICAgICAgaWYgKCEodGhpcy5pZCBpbiByZXN1bHQpKXtcbiAgICAgICAgICAgICAgICByZXN1bHRbdGhpcy5pZF0gPSBnZXR0ZXIuY2FsbCh0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXN1bHRbdGhpcy5pZF07XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGlmIChzZXR0ZXIpe1xuICAgICAgICBwcm9wZXJ0eURlZlsnc2V0J10gPSBmdW5jdGlvbih2YWx1ZSl7XG4gICAgICAgICAgICBpZiAoIWlzRmluaXRlKHZhbHVlKSkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkIGluIHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgcmVzdWx0W3RoaXMuaWRdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4vLyAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gcmVzdWx0W3RoaXMuaWRdKXtcbiAgICAgICAgICAgICAgICBzZXR0ZXIuY2FsbCh0aGlzLHZhbHVlKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZCBpbiByZXN1bHQpe1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgcmVzdWx0W3RoaXMuaWRdO1xuICAgICAgICAgICAgICAgIH1cbi8vICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm90bywgcHJvcGVydHlOYW1lLHByb3BlcnR5RGVmKTtcbn1cbiIsIid1c2Ugc3RyaWN0JztcblxuZnVuY3Rpb24gVmFsaWRhdGlvbkVycm9yKGRhdGEpe1xuICAgIHRoaXMucmVzb3VyY2UgPSBkYXRhLl9yZXNvdXJjZTtcbiAgICB0aGlzLmZvcm1JZHggPSBkYXRhLmZvcm1JZHg7XG4gICAgdGhpcy5maWVsZHMgPSBkYXRhLmVycm9ycztcbn1cbnZhciBiYXNlT1JNID0gZnVuY3Rpb24ob3B0aW9ucywgZXh0T1JNKXtcbiAgICBcbiAgICAvLyBjcmVhdGluZyByZXdoZWVsIGNvbm5lY3Rpb25cbiAgICBpZiAob3B0aW9ucy5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKXtcbiAgICAgICAgdmFyIGNvbm5lY3Rpb24gPSBuZXcgcmVXaGVlbENvbm5lY3Rpb24ob3B0aW9ucyk7XG4gICAgfSBlbHNlIGlmIChvcHRpb25zLmNvbnN0cnVjdG9yID09PSB1dGlscy5yZVdoZWVsQ29ubmVjdGlvbil7XG4gICAgICAgIHZhciBjb25uZWN0aW9uID0gb3B0aW9ucztcbiAgICB9XG4gICAgdGhpcy5jb25uZWN0aW9uID0gY29ubmVjdGlvbjtcbiAgICBjb25uZWN0aW9uLm9uKCdjb25uZWN0ZWQnLCBmdW5jdGlvbigpeyBcbiAgICAgICAgdGhpcy5jb25uZWN0ZWQgPSB0cnVlO1xuICAgIH0pO1xuICAgIHRoaXMub24gPSBjb25uZWN0aW9uLm9uO1xuICAgIHRoaXMuZW1pdCA9IGNvbm5lY3Rpb24uZW1pdDtcbiAgICB0aGlzLnVuYmluZCA9IGNvbm5lY3Rpb24udW5iaW5kO1xuICAgIHRoaXMub25jZSA9IGNvbm5lY3Rpb24ub25jZTtcbiAgICB0aGlzLiRwb3N0ID0gY29ubmVjdGlvbi4kcG9zdC5iaW5kKGNvbm5lY3Rpb24pO1xuXG4gICAgLy8gaGFuZGxpbmcgd2Vic29ja2V0IGV2ZW50c1xuICAgIHRoaXMub24oJ3dzLWNvbm5lY3RlZCcsZnVuY3Rpb24od3Mpe1xuICAgICAgICBjb25zb2xlLmluZm8oJ1dlYnNvY2tldCBjb25uZWN0ZWQnKTtcbiAgICAgICAgLy8gYWxsIGpzb24gZGF0YSBoYXMgdG8gYmUgcGFyc2VkIGJ5IGdvdERhdGFcbiAgICAgICAgd3Mub25NZXNzYWdlSnNvbihXMlBSRVNPVVJDRS5nb3REYXRhLmJpbmQoVzJQUkVTT1VSQ0UpKTtcbiAgICAgICAgLy9cbiAgICAgICAgd3Mub25NZXNzYWdlVGV4dChmdW5jdGlvbihtZXNzYWdlKXtcbiAgICAgICAgICAgIGNvbnNvbGUuaW5mbygnV1MgbWVzc2FnZSA6ICcgKyBtZXNzYWdlKVxuICAgICAgICB9KTtcbiAgICB9KTtcbiAgICB0aGlzLm9uKCd3cy1kaXNjb25uZWN0ZWQnLCBmdW5jdGlvbih3cyl7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1dlYnNvY2tldCBkaXNjb25uZWN0ZWQnKVxuICAgIH0pO1xuICAgIHRoaXMub24oJ2Vycm9yLWpzb24tNDA0JyxmdW5jdGlvbihlcnJvcix1cmwsIHNlbnREYXRhLCB4aHIpeyBcbiAgICAgICAgY29uc29sZS5lcnJvcignSlNPTiBlcnJvciAnLCBKU09OLnN0cmluZ2lmeShlcnJvcikpO1xuICAgICAgICBkZWxldGUgd2FpdGluZ0Nvbm5lY3Rpb25zW3VybC5zcGxpdCgnLycpWzBdXTtcbiAgICB9KTtcbiAgICB0aGlzLm9uKCdyZWFsdGltZS1tZXNzYWdlLWpzb24nLCBmdW5jdGlvbihtZXNzYWdlKXtcbiAgICAgICAgVzJQUkVTT1VSQ0UuZ290RGF0YShtZXNzYWdlKTtcbiAgICB9KTtcblxuICAgIC8vIGluaXRpYWxpemF0aW9uXG4gICAgdmFyIFcyUFJFU09VUkNFID0gdGhpcztcbiAgICB2YXIgSURCID0ge2F1dGhfZ3JvdXAgOiBMYXp5KHt9KX07IC8vIHRhYmxlTmFtZSAtPiBkYXRhIGFzIEFycmF5XG4gICAgdmFyIElEWCA9IHt9OyAvLyB0YWJsZU5hbWUgLT4gTGF6eShpbmRleEJ5KCdpZCcpKSAtPiBJREJbZGF0YV1cbiAgICB2YXIgUkVWSURYID0ge307IC8vIHRhYmxlTmFtZSAtPiBmaWVsZE5hbWUgLT4gTGF6eS5ncm91cEJ5KCkgLT4gSURCW0RBVEFdXG4gICAgdmFyIGJ1aWxkZXJIYW5kbGVycyA9IHt9O1xuICAgIHZhciBidWlsZGVySGFuZGxlclVzZWQgPSB7fTtcbiAgICB2YXIgcGVyc2lzdGVudEF0dHJpYnV0ZXMgPSB7fTtcbiAgICB2YXIgZXZlbnRIYW5kbGVycyA9IHt9O1xuICAgIHZhciBwZXJtaXNzaW9uV2FpdGluZyA9IHt9O1xuICAgIHZhciBtb2RlbENhY2hlID0ge307XG4gICAgdmFyIGZhaWxlZE1vZGVscyA9IHt9O1xuICAgIHZhciB3YWl0aW5nQ29ubmVjdGlvbnMgPSB7fSAvLyBhY3R1YWwgY29ubmVjdGlvbiB3aG8gaSdtIHdhaXRpbmcgZm9yXG4gICAgdmFyIGxpc3RDYWNoZSA9IG5ldyBMaXN0Q2FjaGVyKExhenkpO1xuICAgIHZhciBsaW5rZXIgPSBuZXcgQXV0b0xpbmtlcih3YWl0aW5nQ29ubmVjdGlvbnMsSURCLCB0aGlzLCBsaXN0Q2FjaGUpO1xuLyogICAgd2luZG93LmxsID0gbGlua2VyO1xuICAgIHdpbmRvdy5sYyA9IGxpc3RDYWNoZTtcbiovXG4gICAgd2luZG93LklEQiA9IElEQjtcbiAgICB0aGlzLnZhbGlkYXRpb25FdmVudCA9IHRoaXMub24oJ2Vycm9yLWpzb24tNTEzJywgZnVuY3Rpb24oZGF0YSwgdXJsLCBzZW50RGF0YSwgeGhyKXtcbiAgICAgICAgaWYgKGN1cnJlbnRDb250ZXh0LnNhdmluZ0Vycm9ySGFubGRlcil7XG4gICAgICAgICAgICBjdXJyZW50Q29udGV4dC5zYXZpbmdFcnJvckhhbmxkZXIobmV3IFZhbGlkYXRpb25FcnJvcihkYXRhKSk7XG4gICAgICAgIH1cbiAgICB9KVxuXG4gICAgdmFyIGdldEluZGV4ID0gZnVuY3Rpb24gKGluZGV4TmFtZSkge1xuICAgICAgICBpZiAoaW5kZXhOYW1lIGluIElEQilcbiAgICAgICAgICAgIHJldHVybiBJREJbaW5kZXhOYW1lXTtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBJREJbaW5kZXhOYW1lXSA9IExhenkoe30pO1xuICAgICAgICAgICAgcmV0dXJuIElEQltpbmRleE5hbWVdO1xuICAgICAgICB9XG4gICAgfTtcbiAgICB2YXIgZ2V0VW5saW5rZWQgPSBmdW5jdGlvbiAoaW5kZXhOYW1lKSB7XG4gICAgICAgIGlmIChpbmRleE5hbWUgaW4gVU5MSU5LRUQpXG4gICAgICAgICAgICByZXR1cm4gVU5MSU5LRURbaW5kZXhOYW1lXTtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBVTkxJTktFRFtpbmRleE5hbWVdID0ge307XG4gICAgICAgICAgICByZXR1cm4gVU5MSU5LRURbaW5kZXhOYW1lXTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBmdW5jdGlvbiBQZXJtaXNzaW9uVGFibGUoaWQsIGtsYXNzLCBwZXJtaXNzaW9ucykge1xuICAgICAgICAvLyBjcmVhdGUgUGVybWlzc2lvblRhYmxlIGNsYXNzXG4gICAgICAgIHRoaXMua2xhc3MgPSBrbGFzcztcbiAgICAgICAgdGhpcy5wZXJtaXNzaW9ucyA9IFtdO1xuICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgIGZvciAodmFyIGsgaW4gcGVybWlzc2lvbnMpIHtcbiAgICAgICAgICAgIHRoaXMucHVzaC5hcHBseSh0aGlzLCBbaywgcGVybWlzc2lvbnNba11dKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBQZXJtaXNzaW9uVGFibGUucHJvdG90eXBlLnNhdmUgPSBmdW5jdGlvbiAoY2IpIHtcbiAgICAgICAgLy8gc2F2ZSBPYmplY3QgdG8gc2VydmVyXG4gICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgcGVybWlzc2lvbnM6IExhenkodGhpcy5wZXJtaXNzaW9ucykubWFwKGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFt4WzBdLmlkLCB4WzFdXVxuICAgICAgICAgICAgfSkudG9PYmplY3QoKVxuICAgICAgICB9O1xuICAgICAgICBkYXRhLmlkID0gdGhpcy5pZDtcbiAgICAgICAgdmFyIG1vZGVsTmFtZSA9IHRoaXMua2xhc3MubW9kZWxOYW1lO1xuICAgICAgICBXMlBSRVNPVVJDRS4kcG9zdCh0aGlzLmtsYXNzLm1vZGVsTmFtZSArICcvc2V0X3Blcm1pc3Npb25zJywgZGF0YSwgZnVuY3Rpb24gKG15UGVybXMsIGEsIGIsIHJlcSkge1xuICAgICAgICAgICAgY2IobXlQZXJtcyk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgUGVybWlzc2lvblRhYmxlLnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24gKGdyb3VwX2lkLCBwZXJtaXNzaW9uTGlzdCkge1xuICAgICAgICB2YXIgcCA9IExhenkocGVybWlzc2lvbkxpc3QpO1xuICAgICAgICB2YXIgcGVybXMgPSBMYXp5KHRoaXMua2xhc3MuYWxsUGVybWlzc2lvbnMpLm1hcChmdW5jdGlvbiAoeCkge1xuICAgICAgICAgICAgcmV0dXJuIFt4LCBwLmNvbnRhaW5zKHgpXVxuICAgICAgICB9KS50b09iamVjdCgpO1xuICAgICAgICB2YXIgbCA9IExhenkodGhpcy5wZXJtaXNzaW9ucykubWFwKGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgICByZXR1cm4geFswXS5pZFxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGwuY29udGFpbnMoZ3JvdXBfaWQpKVxuICAgICAgICAgICAgdGhpcy5wZXJtaXNzaW9uc1tsLmluZGV4T2YoZ3JvdXBfaWQpXVsxXSA9IHBlcm1zO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aGlzLnBlcm1pc3Npb25zLnB1c2goW0lEQi5hdXRoX2dyb3VwLmdldChncm91cF9pZCksIHBlcm1zXSk7XG4gICAgfTtcblxuICAgIC8vIGNyZWF0ZXMgZHluYW1pY2FsIG1vZGVsc1xuICAgIHZhciBtYWtlTW9kZWxDbGFzcyA9IGZ1bmN0aW9uIChtb2RlbCkge1xuICAgICAgICB2YXIgX21vZGVsID0gbW9kZWw7XG4gICAgICAgIG1vZGVsLmZpZWxkcy5pZC5yZWFkYWJsZSA9IGZhbHNlO1xuICAgICAgICBtb2RlbC5maWVsZHMuaWQud3JpdGFibGUgPSBmYWxzZTtcbiAgICAgICAgdmFyIGZpZWxkcyA9IExhenkobW9kZWwuZmllbGRzKTtcbiAgICAgICAgaWYgKG1vZGVsLnByaXZhdGVBcmdzKSB7XG4gICAgICAgICAgICBmaWVsZHMgPSBmaWVsZHMubWVyZ2UobW9kZWwucHJpdmF0ZUFyZ3MpO1xuICAgICAgICB9XG4gICAgICAgIFcyUFJFU09VUkNFLmVtaXQoJ21vZGVsLWRlZmluaXRpb24nLCBtb2RlbCwgZ2V0SW5kZXgobW9kZWwubmFtZSkpO1xuICAgICAgICAvLyBnZXR0aW5nIGZpZWxkcyBvZiB0eXBlIGRhdGUgYW5kIGRhdGV0aW1lXG4vKlxuICAgICAgICB2YXIgREFURUZJRUxEUyA9IGZpZWxkcy5maWx0ZXIoZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgICAgIHJldHVybiAoeC50eXBlID09ICdkYXRlJykgfHwgKHgudHlwZSA9PSAnZGF0ZXRpbWUnKVxuICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKHgsIHYpIHtcbiAgICAgICAgICAgIHJldHVybiBbdiwgdHJ1ZV1cbiAgICAgICAgfSkudG9PYmplY3QoKTtcblxuICAgICAgICAvLyBnZXR0aW5nIGJvb2xlYW4gZmllbGRzXG4gICAgICAgIHZhciBCT09MRklFTERTID0gZmllbGRzLmZpbHRlcihmdW5jdGlvbiAoeCkge1xuICAgICAgICAgICAgcmV0dXJuICh4LnR5cGUgPT0gJ2Jvb2xlYW4nKVxuICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKHgsIHYpIHtcbiAgICAgICAgICAgIHJldHVybiBbdiwgdHJ1ZV1cbiAgICAgICAgfSkudG9PYmplY3QoKTtcblxuICAgICAgICAvLyBib29sZWFucyBhbmQgZGF0ZXRpbWVzIHN0b3JhZ2UgZXh0ZXJuYWwgXG4gICAgICAgIE1PREVMX0RBVEVGSUVMRFNbbW9kZWwubmFtZV0gPSBEQVRFRklFTERTO1xuICAgICAgICBNT0RFTF9CT09MRklFTERTW21vZGVsLm5hbWVdID0gQk9PTEZJRUxEUztcbiovXG4gICAgICAgIC8vIGluaXRpYWxpemF0aW9uXG4gICAgICAgIHZhciBmdW5jU3RyaW5nID0gXCJpZiAoIXJvdykgeyByb3cgPSB7fX07XFxuXCI7XG4gICAgICAgIGZ1bmNTdHJpbmcgKz0gbW9kZWwucmVmZXJlbmNlcy5tYXAoZnVuY3Rpb24oZmllbGQpe1xuICAgICAgICAgICAgcmV0dXJuICd0aGlzLl8nICsgZmllbGQuaWQgKyAnID0gcm93LicgKyBmaWVsZC5pZCArICc7JztcbiAgICAgICAgfSkuam9pbignO1xcbicpO1xuICAgICAgICBcbiAgICAgICAgLy8gZGF0ZWZpZWxkIGNvbnZlcnNpb25cbiAgICAgICAgZnVuY1N0cmluZyArPSBmaWVsZHMubWFwKGZ1bmN0aW9uICh4LGspIHtcbiAgICAgICAgICAgIGlmICgoeC50eXBlID09ICdkYXRlJykgfHwgKHgudHlwZSA9PSAnZGF0ZXRpbWUnKSl7XG4gICAgICAgICAgICAgICAgcmV0dXJuICd0aGlzLicgKyBrICsgJyA9IHJvdy4nICsgayArICc/bmV3IERhdGUocm93LicgKyBrICsgJyAqIDEwMDAgLSAnICsgdXRpbHMudHpPZmZzZXQgKyAnKTpudWxsO1xcbic7IFxuICAgICAgICAgICAgfSBlbHNlIGlmICh4LnR5cGUgPT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICd0aGlzLicgKyBrICsgJyA9IChyb3cuJyArIGsgKyAnID09PSBcIlRcIikgfHwgKHJvdy4nICsgayArICcgPT09IHRydWUpO1xcbic7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiAndGhpcy4nICsgayArICcgPSByb3cuJyArIGsgKyAnO1xcbic7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLnRvU3RyaW5nKCdcXG4nKTsgKyAnXFxuJztcblxuICAgICAgICBmdW5jU3RyaW5nICs9IFwiaWYgKHBlcm1pc3Npb25zKSB7dGhpcy5fcGVybWlzc2lvbnMgPSBwZXJtaXNzaW9ucyAmJiBMYXp5KHBlcm1pc3Npb25zKS5tYXAoZnVuY3Rpb24gKHgpIHsgcmV0dXJuIFt4LCB0cnVlXSB9KS50b09iamVjdCgpO31cIlxuXG4gICAgICAgIFxuICAgICAgICAvLyBtYXN0ZXIgY2xhc3MgZnVuY3Rpb25cbiAgICAgICAgdmFyIEtsYXNzID0gbmV3IEZ1bmN0aW9uKCdyb3cnLCAncGVybWlzc2lvbnMnLGZ1bmNTdHJpbmcpXG5cbiAgICAgICAgS2xhc3MucHJvdG90eXBlLm9ybSA9IGV4dE9STTtcbiAgICAgICAgS2xhc3MucmVmX3RyYW5zbGF0aW9ucyA9IHt9O1xuICAgICAgICBLbGFzcy5tb2RlbE5hbWUgPSBtb2RlbC5uYW1lO1xuICAgICAgICBLbGFzcy5yZWZlcmVuY2VzID0gTGF6eShtb2RlbC5yZWZlcmVuY2VzKS5wbHVjaygnaWQnKS50b0FycmF5KCk7XG5cbiAgICAgICAgS2xhc3MuaW52ZXJzZV9yZWZlcmVuY2VzID0gbW9kZWwucmVmZXJlbmNlZEJ5Lm1hcChmdW5jdGlvbiAoeCkge1xuICAgICAgICAgICAgLy8gbWFuYWdpbmcgcmVmZXJlbmNlcyB3aGVyZSBcbiAgICAgICAgICAgIHJldHVybiB4LmJ5ICsgJ18nICsgeC5pZCArICdfc2V0J1xuICAgICAgICB9KTtcbiAgICAgICAgS2xhc3MucmVmZXJlbnRzID0gbW9kZWwucmVmZXJlbmNlZEJ5Lm1hcChmdW5jdGlvbiAoeCkge1xuICAgICAgICAgICAgcmV0dXJuIFt4LmJ5LCB4LmlkXVxuICAgICAgICB9KTtcbiAgICAgICAgS2xhc3MuZmllbGRzT3JkZXIgPSBtb2RlbC5maWVsZE9yZGVyO1xuICAgICAgICBLbGFzcy5hbGxQZXJtaXNzaW9ucyA9IG1vZGVsLnBlcm1pc3Npb25zO1xuXG4gICAgICAgIC8vIHJlZGVmaW5pbmcgdG9TdHJpbmcgbWV0aG9kXG4gICAgICAgIGlmIChMYXp5KG1vZGVsLnJlcHJlc2VudGF0aW9uKS5zaXplKCkpe1xuICAgICAgICAgICAgS2xhc3MucHJvdG90eXBlLnRvU3RyaW5nID0gbmV3IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcy4nICsgTGF6eShtb2RlbC5yZXByZXNlbnRhdGlvbikudG9TdHJpbmcoJyArIFwiIFwiICsgdGhpcy4nKSk7XG4gICAgICAgIH1cbiAgICAgICAgS2xhc3MucHJvdG90eXBlLnRvVXBwZXJDYXNlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gcmVkZWZpbmUgdG8gVXBwZXJDYXNlXG4gICAgICAgICAgICByZXR1cm4gdGhpcy50b1N0cmluZygpLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgIH07XG4gICAgICBcbiAgICAgICAgS2xhc3MucHJvdG90eXBlLnRvTG93ZXJDYXNlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgS2xhc3MucHJvdG90eXBlLmRlbGV0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIGRlbGV0ZSBpbnN0YW5jZSBmcm9tIHNlcnZlclxuICAgICAgICAgICAgcmV0dXJuIGV4dE9STS5kZWxldGUodGhpcy5jb25zdHJ1Y3Rvci5tb2RlbE5hbWUsIFt0aGlzLmlkXSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcGVybWlzc2lvbiBnZXR0ZXIgcHJvcGVydHlcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEtsYXNzLnByb3RvdHlwZSwgJ3Blcm1pc3Npb25zJywge1xuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX3Blcm1pc3Npb25zKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcGVybWlzc2lvbnM7XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGxpbmtlci5wZXJtaXNzaW9uc1t0aGlzLmNvbnN0cnVjdG9yLm1vZGVsTmFtZV0uYXNrKHRoaXMuaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIC8vIGdldHRpbmcgZnVsbCBwZXJtaXNzaW9uIHRhYmxlIGZvciBhbiBvYmplY3RcbiAgICAgICAgS2xhc3MucHJvdG90eXBlLmFsbF9wZXJtcyA9IGZ1bmN0aW9uIChjYikge1xuICAgICAgICAgICAgdmFyIG9iamVjdF9pZCA9IHRoaXMuaWQ7XG4gICAgICAgICAgICBXMlBSRVNPVVJDRS4kcG9zdCh0aGlzLmNvbnN0cnVjdG9yLm1vZGVsTmFtZSArICcvYWxsX3Blcm1zJywge2lkOiB0aGlzLmlkfSwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2YXIgcGVybWlzc2lvbnMgPSBkYXRhO1xuICAgICAgICAgICAgICAgIHZhciBncm91cGVkID0ge307XG4gICAgICAgICAgICAgICAgdmFyIHVua25vd25fZ3JvdXBzID0gTGF6eShwZXJtaXNzaW9ucykucGx1Y2soJ2dyb3VwX2lkJykudW5pcXVlKCkubWFwKGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnJyArIHhcbiAgICAgICAgICAgICAgICB9KS5kaWZmZXJlbmNlKElEQi5hdXRoX2dyb3VwLmtleXMoKSkudG9BcnJheSgpO1xuICAgICAgICAgICAgICAgIExhenkocGVybWlzc2lvbnMpLmdyb3VwQnkoZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHguZ3JvdXBfaWRcbiAgICAgICAgICAgICAgICB9KS5lYWNoKGZ1bmN0aW9uICh2LCBrKSB7XG4gICAgICAgICAgICAgICAgICAgIGdyb3VwZWRba10gPSBMYXp5KHYpLnBsdWNrKCduYW1lJykudG9BcnJheSgpXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdmFyIGNhbGwgPSBmdW5jdGlvbiAoeCkge1xuICAgICAgICAgICAgICAgICAgICBjYihuZXcgUGVybWlzc2lvblRhYmxlKG9iamVjdF9pZCwgS2xhc3MsIGdyb3VwZWQpKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGlmICh1bmtub3duX2dyb3Vwcy5sZW5ndGgpXG4gICAgICAgICAgICAgICAgICAgIFcyUFJFU09VUkNFLmdldCgnYXV0aF9ncm91cCcsdW5rbm93bl9ncm91cHMsY2FsbCk7XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICBjYWxsKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICBLbGFzcy5wcm90b3R5cGUuc2F2ZSA9IGZ1bmN0aW9uIChhcmdzKSB7XG4gICAgICAgICAgICB2YXIgbyA9IHRoaXMuYXNSYXcoKTtcbiAgICAgICAgICAgIHZhciBmaWVsZHMgPSBLbGFzcy5maWVsZHM7XG4gICAgICAgICAgICB2YXIgSUQgPSB0aGlzLmlkO1xuICAgICAgICAgICAgdmFyIG1vZGVsTmFtZSA9IHRoaXMuY29uc3RydWN0b3IubW9kZWxOYW1lO1xuICAgICAgICAgICAgaWYgKGFyZ3MpIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBhcmcgaW4gYXJncykge1xuICAgICAgICAgICAgICAgICAgICBvW2FyZ10gPSBhcmdzW2FyZ107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gZWxpbWluYXRlIHVud3JpdGFibGVzXG4gICAgICAgICAgICBMYXp5KEtsYXNzLmZpZWxkc09yZGVyKS5maWx0ZXIoZnVuY3Rpb24oeCl7XG4gICAgICAgICAgICAgICAgcmV0dXJuICFmaWVsZHNbeF0ud3JpdGFibGU7XG4gICAgICAgICAgICB9KS5lYWNoKGZ1bmN0aW9uKGZpZWxkTmFtZSl7XG4gICAgICAgICAgICAgICAgaWYgKGZpZWxkTmFtZSBpbiBvKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBvW2ZpZWxkTmFtZV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoSUQpIHsgby5pZCA9IElEOyB9XG4gICAgICAgICAgICB2YXIgcHJvbWlzZSA9IFcyUFJFU09VUkNFLiRwb3N0KG1vZGVsTmFtZSArIChJRCA/ICcvcG9zdCcgOiAnL3B1dCcpLCBvKTtcbiAgICAgICAgICAgIGlmIChhcmdzICYmIChhcmdzLmNvbnN0cnVjdG9yID09PSBGdW5jdGlvbikpe1xuICAgICAgICAgICAgICAgIC8vIHBsYWNpbmcgY2FsbGJhY2sgaW4gYSBjb21tb24gcGxhY2VcbiAgICAgICAgICAgICAgICBwcm9taXNlLmNvbnRleHQuc2F2aW5nRXJyb3JIYW5sZGVyID0gYXJncztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBwcm9taXNlXG4gICAgICAgIH07XG4gICAgICAgIEtsYXNzLnByb3RvdHlwZS5jb3B5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIG9iaiA9IG5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMuYXNSYXcoKSk7XG4gICAgICAgICAgICBvYmouX3Blcm1pc3Npb25zID0gdGhpcy5fcGVybWlzc2lvbnM7XG4gICAgICAgICAgICByZXR1cm4gb2JqO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIGJ1aWxkaW5nIHNlcmlhbGl6YXRpb24gZnVuY3Rpb25cbiAgICAgICAgdmFyIGFzciA9ICdyZXR1cm4ge1xcbicgKyBMYXp5KG1vZGVsLnJlZmVyZW5jZXMpLm1hcChmdW5jdGlvbihmaWVsZCl7XG4gICAgICAgICAgICByZXR1cm4gZmllbGQuaWQgKyAnIDogdGhpcy5fJyArIGZpZWxkLmlkO1xuICAgICAgICB9KS5jb25jYXQoZmllbGRzLm1hcChmdW5jdGlvbiAoeCxrKSB7XG4gICAgICAgICAgICBpZiAoKHgudHlwZSA9PSAnZGF0ZScpIHx8ICh4LnR5cGUgPT0gJ2RhdGV0aW1lJykpe1xuICAgICAgICAgICAgICAgIHJldHVybiBrICsgJyA6ICh0aGlzLicgKyBrICsgJz8oTWF0aC5yb3VuZCh0aGlzLicgKyBrICsgJy5nZXRUaW1lKCkgLSB0aGlzLicgKyBrICsgJy5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApIC8gMTAwMCk6bnVsbCknOyBcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoeC50eXBlID09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIHJldHVybiBrICsgJyA6IHRoaXMuJyArIGsgKyAnP1wiVFwiOlwiRlwiJztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGsgKyAnIDogdGhpcy4nICsgaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpLnRvU3RyaW5nKCcsXFxuJykgKyAnfTsnO1xuICAgICAgICBLbGFzcy5wcm90b3R5cGUuYXNSYXcgPSBuZXcgRnVuY3Rpb24oYXNyKTtcblxuICAgICAgICBLbGFzcy5zYXZlTXVsdGkgPSBmdW5jdGlvbiAob2JqZWN0cywgY2IsIHNjb3BlKSB7XG4gICAgICAgICAgICB2YXIgcmF3ID0gW107XG4gICAgICAgICAgICB2YXIgZGVsZXRhYmxlID0gTGF6eShLbGFzcy5maWVsZHMpXG4gICAgICAgICAgICAgICAgLmZpbHRlcihmdW5jdGlvbiAoeCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gIXgud3JpdGFibGVcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5wbHVjaygnaWQnKVxuICAgICAgICAgICAgICAgIC50b0FycmF5KCk7XG4gICAgICAgICAgICBMYXp5KG9iamVjdHMpXG4gICAgICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAoeCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4geC5hc1JhdygpXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuZWFjaChmdW5jdGlvbiAoeCkge1xuICAgICAgICAgICAgICAgICAgICBMYXp5KGRlbGV0YWJsZSkuZWFjaChmdW5jdGlvbiAoeSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHhbeV07XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByYXcucHVzaCh4KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIFcyUFJFU09VUkNFLiRwb3N0KEtsYXNzLm1vZGVsTmFtZSwgJ3B1dCcsIHttdWx0aXBsZTogcmF3LCBmb3JtSWR4IDogVzJQUkVTT1VSQ0UuZm9ybUlkeCsrfSwgZnVuY3Rpb24gKGVsZW1zKSB7XG4gICAgICAgICAgICAgICAgVzJQUkVTT1VSQ0UuZ290RGF0YShlbGVtcyk7XG4gICAgICAgICAgICAgICAgdmFyIHRhYiA9IElEQltLbGFzcy5tb2RlbE5hbWVdO1xuICAgICAgICAgICAgICAgIHZhciBvYmpzID0gTGF6eShlbGVtc1tLbGFzcy5tb2RlbE5hbWVdLnJlc3VsdHMpLnBsdWNrKCdpZCcpLm1hcChmdW5jdGlvbiAoeCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGFiLmdldCh4KVxuICAgICAgICAgICAgICAgIH0pLnRvQXJyYXkoKTtcbiAgICAgICAgICAgICAgICBpZiAoY2IpIHtcbiAgICAgICAgICAgICAgICAgICAgY2Iob2Jqcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgc2NvcGUpO1xuICAgICAgICB9O1xuICAgICAgICBpZiAoJ2V4dHJhX3ZlcmJzJyBpbiBtb2RlbClcbiAgICAgICAgICAgIExhenkobW9kZWwuZXh0cmFfdmVyYnMpLmVhY2goZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgICAgICAgICB2YXIgZnVuY05hbWUgPSB4WzBdO1xuICAgICAgICAgICAgICAgIHZhciBhcmdzID0geFsxXTtcbiAgICAgICAgICAgICAgICB2YXIgZGRhdGEgPSAnZGF0YSA9IHtpZCA6IHRoaXMuaWQnO1xuICAgICAgICAgICAgICAgIGlmIChhcmdzLmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgZGRhdGEgKz0gJywgJyArIExhenkoYXJncykubWFwKGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHggKyAnIDogJyArIHg7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KS5qb2luKCcsJyk7XG4gICAgICAgICAgICAgICAgZGRhdGEgKz0gJ307JztcbiAgICAgICAgICAgICAgICBhcmdzLnB1c2goJ2NiJyk7XG4gICAgICAgICAgICAgICAgS2xhc3MucHJvdG90eXBlW2Z1bmNOYW1lXSA9IG5ldyBGdW5jdGlvbihhcmdzLCBkZGF0YSArICdXMlMuVzJQX1BPU1QodGhpcy5jb25zdHJ1Y3Rvci5tb2RlbE5hbWUsXCInICsgZnVuY05hbWUgKyAnXCIsIGRhdGEsZnVuY3Rpb24oZGF0YSxzdGF0dXMsaGVhZGVycyx4KXsnICtcbiAgICAgICAgICAgICAgICAgICAgJ3RyeXtcXG4nICtcbiAgICAgICAgICAgICAgICAgICAgJyAgIGlmICghaGVhZGVycyhcIm5vbW9kZWxcIikpIHt3aW5kb3cuVzJTLmdvdERhdGEoZGF0YSxjYik7fVxcbicgK1xuICAgICAgICAgICAgICAgICAgICAnICAgZWxzZSB7aWYgKGNiKSB7Y2IoZGF0YSl9fVxcbicgK1xuICAgICAgICAgICAgICAgICAgICAnfSBjYXRjaChlKXtcXG4nICtcbiAgICAgICAgICAgICAgICAgICAgJ2lmIChjYikge2NiKGRhdGEpO31cXG4nICtcbiAgICAgICAgICAgICAgICAgICAgJ31cXG4nICtcbiAgICAgICAgICAgICAgICAgICAgJ30pO1xcbidcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIGlmICgncHJpdmF0ZUFyZ3MnIGluIG1vZGVsKSB7XG4gICAgICAgICAgICBLbGFzcy5wcml2YXRlQXJncyA9IExhenkobW9kZWwucHJpdmF0ZUFyZ3MpLmtleXMoKS5tYXAoZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gW3gsIHRydWVdO1xuICAgICAgICAgICAgfSkudG9PYmplY3QoKTtcbiAgICAgICAgICAgIEtsYXNzLnByb3RvdHlwZS5zYXZlUEEgPSBmdW5jdGlvbiAobykge1xuICAgICAgICAgICAgICAgIHZhciBUID0gdGhpcztcbiAgICAgICAgICAgICAgICB2YXIgb28gPSB7aWQ6IHRoaXMuaWR9O1xuICAgICAgICAgICAgICAgIHZhciBQQSA9IHRoaXMuY29uc3RydWN0b3IucHJpdmF0ZUFyZ3M7XG4gICAgICAgICAgICAgICAgdmFyIEZzID0gdGhpcy5jb25zdHJ1Y3Rvci5maWVsZHM7XG4gICAgICAgICAgICAgICAgdmFyIHQgPSBuZXcgdGhpcy5jb25zdHJ1Y3RvcihvKS5hc1JhdygpO1xuICAgICAgICAgICAgICAgIHZhciBmaWVsZElkeCA9IExhenkoUEEpLmtleXMoKS5tYXAoZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFt4LCBGc1t4XV1cbiAgICAgICAgICAgICAgICB9KS50b09iamVjdCgpO1xuICAgICAgICAgICAgICAgIExhenkobykuZWFjaChmdW5jdGlvbiAodiwgaykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoKGsgaW4gUEEpICYmIGZpZWxkSWR4W2tdLndyaXRhYmxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvb1trXSA9IHY7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBXMlBSRVNPVVJDRS4kcG9zdCh0aGlzLmNvbnN0cnVjdG9yLm1vZGVsTmFtZSArICcvc2F2ZVBBJywgb28sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgTGF6eShvbykuZWFjaChmdW5jdGlvbiAodiwgaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgVFtrXSA9IHY7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIG1vZGVsQ2FjaGVbS2xhc3MubW9kZWxOYW1lXSA9IEtsYXNzO1xuICAgICAgICAvLyBhZGRpbmcgaWQgdG8gZmllbGRzXG4gICAgICAgIGZvciAodmFyIGYgaW4gbW9kZWwuZmllbGRzKSB7XG4gICAgICAgICAgICBtb2RlbC5maWVsZHNbZl0uaWQgPSBmO1xuICAgICAgICB9XG4gICAgICAgIEtsYXNzLmZpZWxkcyA9IExhenkobW9kZWwuZmllbGRzKS5jb25jYXQoTGF6eShtb2RlbC5wcml2YXRlQXJncykpLmNvbmNhdChMYXp5KG1vZGVsLnJlZmVyZW5jZXMpLnRhcChmdW5jdGlvbiAoeCkge1xuICAgICAgICAgICAgeC50eXBlID0geC50eXBlIHx8ICdyZWZlcmVuY2UnXG4gICAgICAgIH0pKS5pbmRleEJ5KCdpZCcpLnRvT2JqZWN0KCk7XG4gICAgICAgIC8vIHNldHRpbmcgd2lkZ2V0cyBmb3IgZmllbGRzXG4gICAgICAgIExhenkoS2xhc3MuZmllbGRzKS5lYWNoKGZ1bmN0aW9uKGZpZWxkKXtcbiAgICAgICAgICAgIGlmICghZmllbGQud2lkZ2V0KXtcbiAgICAgICAgICAgICAgICBpZiAoZmllbGQudHlwZSA9PT0gJ3JlZmVyZW5jZScpe1xuICAgICAgICAgICAgICAgICAgICBmaWVsZC53aWRnZXQgPSAnY2hvaWNlcydcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmaWVsZC53aWRnZXQgPSBmaWVsZC50eXBlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIC8vIGJ1aWxkaW5nIHJlZmVyZW5jZXMgdG8gKG1hbnkgdG8gb25lKSBmaWVsZHNcbiAgICAgICAgTGF6eShtb2RlbC5yZWZlcmVuY2VzKS5lYWNoKGZ1bmN0aW9uIChyZWYpIHtcbiAgICAgICAgICAgIHZhciBleHRfcmVmID0gcmVmLnRvO1xuICAgICAgICAgICAgdmFyIGxvY2FsX3JlZiA9ICdfJyArIHJlZi5pZDtcbiAgICAgICAgICAgIGNhY2hlZFByb3BlcnR5QnlFdmVudHMoS2xhc3MucHJvdG90eXBlLCByZWYuaWQsZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICghdGhpc1tsb2NhbF9yZWZdKSB7IHJldHVybiBudWxsIH07XG4gICAgICAgICAgICAgICAgaWYgKCEoZXh0X3JlZiBpbiBJREIpKXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRocyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgIFcyUFJFU09VUkNFLmRlc2NyaWJlKGV4dF9yZWYsZnVuY3Rpb24oeCl7XG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5rZXIubWFpbkluZGV4W2V4dF9yZWZdLmFzayh0aHNbbG9jYWxfcmVmXSx0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSAoZXh0X3JlZiBpbiBJREIpICYmIHRoaXNbbG9jYWxfcmVmXSAmJiBJREJbZXh0X3JlZl0uZ2V0KHRoaXNbbG9jYWxfcmVmXSk7XG4gICAgICAgICAgICAgICAgaWYgKCFyZXN1bHQgJiYgKGV4dF9yZWYgaW4gbGlua2VyLm1haW5JbmRleCkpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gYXNraW5nIHRvIGxpbmtlclxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHRoaXNbbG9jYWxfcmVmXSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmtlci5tYWluSW5kZXhbZXh0X3JlZl0uYXNrKHRoaXNbbG9jYWxfcmVmXSx0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignbnVsbCByZWZlcmVuY2UgZm9yICcgKyBsb2NhbF9yZWYgKyAnKCcgKyB0aGlzLmlkICsgJykgcmVzb3VyY2UgJyArIEtsYXNzLm1vZGVsTmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHV0aWxzLm1vY2s7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCh2YWx1ZS5jb25zdHJ1Y3RvciAhPT0gdXRpbHMubW9jaykgJiYgKHZhbHVlLmNvbnN0cnVjdG9yLm1vZGVsTmFtZSAhPT0gZXh0X3JlZikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1lvdSBjYW4gYXNzaWduIG9ubHkgJyArIGV4dF9yZWYgKyAnIHRvICcgKyByZWYuaWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXNbbG9jYWxfcmVmXSA9IHZhbHVlLmlkO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXNbbG9jYWxfcmVmXSA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgJ25ldy0nICsgZXh0X3JlZiwgJ2RlbGV0ZWQtJyArIGV4dF9yZWYsJ3VwZGF0ZWQtJyArIGV4dF9yZWYsICduZXctbW9kZWwtJyArIGV4dF9yZWYvKiwgJ3VwZGF0ZWQtJyArIEtsYXNzLm1vZGVsTmFtZSovKTtcblxuXG4gICAgICAgICAgICBLbGFzcy5wcm90b3R5cGVbJ2dldCcgKyB1dGlscy5jYXBpdGFsaXplKHJlZi5pZCldID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBleHRPUk0uZ2V0KGV4dF9yZWYsdGhpc1tsb2NhbF9yZWZdKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vYnVpbGRpbmcgcmVmZXJlbmNlcyB0byAob25lIHRvIG1hbnkpIGZpZWxkc1xuICAgICAgICBMYXp5KG1vZGVsLnJlZmVyZW5jZWRCeSkuZWFjaChmdW5jdGlvbiAocmVmKSB7XG4gICAgICAgICAgICB2YXIgaW5kZXhOYW1lID0gcmVmLmJ5ICsgJy4nICsgcmVmLmlkO1xuICAgICAgICAgICAgdmFyIHByb3BlcnR5TmFtZSA9IHJlZi5ieSArICdfJyArIHV0aWxzLnBsdXJhbGl6ZShyZWYuaWQpO1xuICAgICAgICAgICAgdmFyIHJldkluZGV4ID0gcmVmLmJ5O1xuICAgICAgICAgICAgaWYgKEtsYXNzLnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eShwcm9wZXJ0eU5hbWUpKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignVHJ5ZWQgdG8gcmVkZWZpbmUgcHJvcGVydHkgJyArIHByb3BlcnR5TmFtZSArICdzJyArICcgZm9yICcgKyBLbGFzcy5tb2RlbE5hbWUpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjYWNoZWRQcm9wZXJ0eUJ5RXZlbnRzKEtsYXNzLnByb3RvdHlwZSwgcHJvcGVydHlOYW1lLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXQgPSAocmV2SW5kZXggaW4gSURCKSA/IFJFVklEWFtpbmRleE5hbWVdLmdldCh0aGlzLmlkICsgJycpOm51bGw7XG4gICAgICAgICAgICAgICAgICAgIGxpbmtlci5mb3JlaWduS2V5c1tpbmRleE5hbWVdLmFzayh0aGlzLmlkLHRydWUpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgICAgICAgICAgIH0sIG51bGwsICduZXctJyArIHJldkluZGV4LCAndXBkYXRlZC0nICsgcmV2SW5kZXgsICdkZWxldGVkLScgKyByZXZJbmRleCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBLbGFzcy5wcm90b3R5cGVbJ2dldCcgKyB1dGlscy5jYXBpdGFsaXplKHV0aWxzLnBsdXJhbGl6ZShyZWYuYnkpKV0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIG9wdHMgPSB7fTtcbiAgICAgICAgICAgICAgICBvcHRzW3JlZi5pZF0gPSBbdGhpcy5pZF07XG4gICAgICAgICAgICAgICAgcmV0dXJuIGV4dE9STS5nZXQocmVmLmJ5LG9wdHMpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy9idWlsZGluZyByZWZlcmVuY2UgdG8gKG1hbnkgdG8gbWFueSkgZmllbGRzXG4gICAgICAgIGlmIChtb2RlbC5tYW55VG9NYW55KSB7XG4gICAgICAgICAgICBMYXp5KG1vZGVsLm1hbnlUb01hbnkpLmVhY2goZnVuY3Rpb24gKHJlZikge1xuICAgICAgICAgICAgICAgIHZhciBpbmRleE5hbWUgPSByZWYuaW5kZXhOYW1lO1xuICAgICAgICAgICAgICAgIHZhciBmaXJzdCA9IHJlZi5maXJzdD8gMCA6IDE7XG4gICAgICAgICAgICAgICAgdmFyIG9tb2RlbE5hbWUgPSByZWYubW9kZWw7XG4vLyAgICAgICAgICAgICAgICB2YXIgb21vZGVsID0gZ2V0SW5kZXgob21vZGVsTmFtZSk7XG4gICAgICAgICAgICAgICAgdmFyIGdldHRlciA9IGxpbmtlci5tMm1JbmRleFtpbmRleE5hbWVdWydnZXQnICsgKDEgLSBmaXJzdCldO1xuXG4gICAgICAgICAgICAgICAgY2FjaGVkUHJvcGVydHlCeUV2ZW50cyhLbGFzcy5wcm90b3R5cGUsIHJlZi5tb2RlbCArICdzJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRocyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmV0ID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWRzID0gZ2V0dGVyKHRocy5pZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZ2V0ID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpZHMubGVuZ3RoKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1cyUFJFU09VUkNFLmZldGNoKG9tb2RlbE5hbWUsIHtpZCA6IGlkc30pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldCA9IGdldEluZGV4KG9tb2RlbE5hbWUpLmdldC5iaW5kKElEQltvbW9kZWxOYW1lXSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpZHMgJiYgZ2V0KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldCA9IExhenkoaWRzKS5tYXAoZ2V0KS5maWx0ZXIodXRpbHMuYm9vbCkudG9BcnJheSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgICAgICAgICAgICAgICAgfSwgbnVsbCwgJ3JlY2VpdmVkLW0ybS0nICsgaW5kZXhOYW1lLCAncmVjZWl2ZWQtJyArIG9tb2RlbE5hbWUpO1xuXG4gICAgICAgICAgICAgICAgS2xhc3MucHJvdG90eXBlWydnZXQnICsgdXRpbHMuY2FwaXRhbGl6ZSh1dGlscy5wbHVyYWxpemUob21vZGVsTmFtZSkpXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRocyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihhY2NlcHQsIHJlamVjdCl7XG4gICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmtlci5nZXRNMk0oaW5kZXhOYW1lLCBbdGhzLmlkXSwgZmlyc3QsZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpZHMgPSBnZXR0ZXIodGhzLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlkcy5sZW5ndGgpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVzJQUkVTT1VSQ0UuZmV0Y2gob21vZGVsTmFtZSwge2lkIDogaWRzfSxudWxsLGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGdldCA9IElEQltvbW9kZWxOYW1lXS5nZXQuYmluZChJREJbb21vZGVsTmFtZV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY2VwdChMYXp5KGlkcykubWFwKGdldCkuZmlsdGVyKHV0aWxzLmJvb2wpLnRvQXJyYXkoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY2VwdChbXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9O1xuXG5cbiAgICAgICAgICAgICAgICBLbGFzcy5maWVsZHNbdXRpbHMuY2FwaXRhbGl6ZShvbW9kZWxOYW1lKV0gPSB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiB1dGlscy5jYXBpdGFsaXplKG9tb2RlbE5hbWUpLFxuICAgICAgICAgICAgICAgICAgICBuYW1lOiB1dGlscy5jYXBpdGFsaXplKG9tb2RlbE5hbWUpLFxuICAgICAgICAgICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgcmVhZGFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdNMk0nLFxuICAgICAgICAgICAgICAgICAgICB2YWxpZGF0b3JzOiBbXVxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBLbGFzcy5wcm90b3R5cGUudW5saW5rUmVmZXJlbmNlID0gZnVuY3Rpb24gKGluc3RhbmNlKSB7XG4gICAgICAgICAgICAgICAgdmFyIG11bHRpcGxlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdmFyIElEID0gdGhpcy5pZDtcbiAgICAgICAgICAgICAgICB2YXIgaW5zdGFuY2VzID0gW107XG4gICAgICAgICAgICAgICAgaWYgKGluc3RhbmNlLmNvbnN0cnVjdG9yLm5hbWUgPT0gJ0FycmF5Jykge1xuICAgICAgICAgICAgICAgICAgICBtdWx0aXBsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGluc3RhbmNlcyA9IGluc3RhbmNlO1xuICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZSA9IGluc3RhbmNlc1swXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIG9tb2RlbCA9IGluc3RhbmNlLmNvbnN0cnVjdG9yLm1vZGVsTmFtZTtcbiAgICAgICAgICAgICAgICBpZiAobXVsdGlwbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbGxlY3Rpb24gPSBMYXp5KGluc3RhbmNlcykucGx1Y2soJ2lkJykubWFwKGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gW0lELCB4XVxuICAgICAgICAgICAgICAgICAgICB9KS50b0FycmF5KCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbGxlY3Rpb24gPSBbW0lELCBpbnN0YW5jZS5pZF1dO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBXMlBSRVNPVVJDRS4kcG9zdChLbGFzcy5tb2RlbE5hbWUgKyAnLycgKyBvbW9kZWwgKyAncy9kZWxldGUnLCB7Y29sbGVjdGlvbjogY29sbGVjdGlvbn0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgS2xhc3MucHJvdG90eXBlLmxpbmtSZWZlcmVuY2UgPSBmdW5jdGlvbiAoaW5zdGFuY2UpIHtcbiAgICAgICAgICAgICAgICB2YXIgbXVsdGlwbGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB2YXIgSUQgPSB0aGlzLmlkO1xuICAgICAgICAgICAgICAgIHZhciBpbnN0YW5jZXMgPSBbXTtcbiAgICAgICAgICAgICAgICBpZiAoaW5zdGFuY2UuY29uc3RydWN0b3IubmFtZSA9PSAnQXJyYXknKSB7XG4gICAgICAgICAgICAgICAgICAgIG11bHRpcGxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2VzID0gaW5zdGFuY2U7XG4gICAgICAgICAgICAgICAgICAgIGluc3RhbmNlID0gaW5zdGFuY2VzWzBdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgb21vZGVsID0gaW5zdGFuY2UuY29uc3RydWN0b3IubW9kZWxOYW1lO1xuICAgICAgICAgICAgICAgIHZhciBpbmRleE5hbWUgPSBLbGFzcy5tb2RlbE5hbWUgKyAnLycgKyBvbW9kZWw7XG4gICAgICAgICAgICAgICAgaWYgKG11bHRpcGxlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZWZzID0gW107XG4gICAgICAgICAgICAgICAgICAgIGlmIChpbmRleE5hbWUgaW4gSU5ERVhfTTJNKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWZzID0gTGF6eShpbnN0YW5jZXMpLnBsdWNrKCdpZCcpLmRpZmZlcmVuY2UoTGF6eShJTkRFWF9NMk1baW5kZXhOYW1lXVswXS5nZXQodGhpcy5pZCkpKS50b0FycmF5KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaW5kZXhOYW1lID0gb21vZGVsICsgJy8nICsgS2xhc3MubW9kZWxOYW1lO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXhOYW1lIGluIElOREVYX00yTSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVmcyA9IExhenkoaW5zdGFuY2VzKS5wbHVjaygnaWQnKS5kaWZmZXJlbmNlKExhenkoSU5ERVhfTTJNW2luZGV4TmFtZV1bMF0uZ2V0KHRoaXMuaWQpKSkudG9BcnJheSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZWZzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbGxlY3Rpb24gPSBMYXp5KHJlZnMpLm1hcChmdW5jdGlvbiAoeCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbSUQsIHhdXG4gICAgICAgICAgICAgICAgICAgICAgICB9KS50b0FycmF5KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBXMlBfUE9TVChLbGFzcy5tb2RlbE5hbWUsIG9tb2RlbCArICdzL3B1dCcsIHtjb2xsZWN0aW9uOiBjb2xsZWN0aW9ufSwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKChpbmRleE5hbWUgaW4gbGlua2VyLm0ybUluZGV4KSAmJiBMYXp5KGxpbmtlci5tMm1JbmRleFtpbmRleE5hbWVdWydnZXQnICsgdXRpbHMuY2FwaXRhbGl6ZShvbW9kZWwpXShpbnN0YW5jZS5pZCkpLmZpbmQodGhpcykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBXMlBSRVNPVVJDRS4kcG9zdChLbGFzcy5tb2RlbE5hbWUgKyAnLycgKyBvbW9kZWwgKyAncy9wdXQnLCB7Y29sbGVjdGlvbjogW1t0aGlzLmlkLCBpbnN0YW5jZS5pZF1dfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBXMlBSRVNPVVJDRS5lbWl0KCduZXctbW9kZWwnLCBLbGFzcyk7XG4gICAgICAgIFcyUFJFU09VUkNFLmVtaXQoJ25ldy1tb2RlbC0nICsgS2xhc3MubW9kZWxOYW1lKTtcbiAgICAgICAgcmV0dXJuIEtsYXNzO1xuICAgIH07XG5cbiAgICB0aGlzLmdvdERhdGEgPSBmdW5jdGlvbiAoZGF0YSwgY2FsbEJhY2spIHtcbiAgICAgICAgLy8gcmVjZWl2ZSBhbGwgZGF0YSBmcm9tIGV2ZXJ5IGVuZCBwb2ludFxuICAgICAgICBjb25zb2xlLmluZm8oJ2dvdERhdGEnKTtcbiAgICAgICAgaWYgKHR5cGVvZihkYXRhKSA9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2RhdGEgJyArIGRhdGEgKyAnIHJlZnVzZWQgZnJvbSBnb3REYXRhKCknKTtcbiAgICAgICAgICAgIGlmIChjYWxsQmFjaykge1xuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsQmFjayhkYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBjbGVhbiBkYXRhIGZyb20gcmVsYXRpb25zIGFuZCBwZXJtaXNzaW9ucyBmb3IgdXNpbmcgaXQgYWZ0ZXIgbW9kZWwgcGFyc2luZ1xuICAgICAgICBpZiAoJ19leHRyYScgaW4gZGF0YSl7IGRlbGV0ZSBkYXRhLl9leHRyYSB9XG4gICAgICAgIHZhciBUT09ORSA9IGRhdGEuVE9PTkU7XG4gICAgICAgIHZhciBUT01BTlkgPSBkYXRhLlRPTUFOWTtcbiAgICAgICAgdmFyIE1BTllUT01BTlkgPSBkYXRhLk1BTllUT01BTlk7XG4gICAgICAgIHZhciBQRVJNSVNTSU9OUyA9IGRhdGEuUEVSTUlTU0lPTlM7XG4gICAgICAgIHZhciBQQSA9IGRhdGEuUEE7XG4gICAgICAgIGRlbGV0ZSBkYXRhLlRPT05FO1xuICAgICAgICBkZWxldGUgZGF0YS5UT01BTlk7XG4gICAgICAgIGRlbGV0ZSBkYXRhLk1BTllUT01BTlk7XG4gICAgICAgIGRlbGV0ZSBkYXRhLlBFUk1JU1NJT05TO1xuICAgICAgICBkZWxldGUgZGF0YS5QQTtcbiAgICAgICAgaWYgKCFQQSkgeyBQQSA9IHt9OyB9XG5cbiAgICAgICAgLy8gY2xlYW5pbmcgZnJvbSB1c2VsZXNzIGRlbGV0ZWQgZGF0YVxuICAgICAgICBkYXRhID0gTGF6eShkYXRhKS5maWx0ZXIoZnVuY3Rpb24gKHYsIGspIHtcbiAgICAgICAgICAgIHJldHVybiAoISgnZGVsZXRlZCcgaW4gdikgfHwgKChrIGluIG1vZGVsQ2FjaGUpKSk7XG4gICAgICAgIH0pLnRvT2JqZWN0KCk7XG4gICAgICAgIFxuICAgICAgICBpZiAoJ20ybScgaW4gZGF0YSkge1xuICAgICAgICAgICAgdmFyIG0ybSA9IGRhdGEubTJtO1xuICAgICAgICAgICAgZGVsZXRlIGRhdGFbJ20ybSddO1xuICAgICAgICB9XG4gICAgICAgIExhenkoZGF0YSkuZWFjaChmdW5jdGlvbiAoZGF0YSwgbW9kZWxOYW1lKSB7XG4gICAgICAgICAgICBXMlBSRVNPVVJDRS5kZXNjcmliZShtb2RlbE5hbWUsIGZ1bmN0aW9uIChtb2RlbCkge1xuICAgICAgICAgICAgICAgIHZhciBtb2RlbENsYXNzID0gbW9kZWw7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEucmVzdWx0cyAmJiAoZGF0YS5yZXN1bHRzLmxlbmd0aCA+IDApICYmIChkYXRhLnJlc3VsdHNbMF0uY29uc3RydWN0b3IgPT0gQXJyYXkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEucmVzdWx0cyA9IExhenkoZGF0YS5yZXN1bHRzKS5tYXAoZnVuY3Rpb24oeCl7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gTGF6eShtb2RlbENsYXNzLmZpZWxkc09yZGVyKS56aXAoeCkudG9PYmplY3QoKVxuICAgICAgICAgICAgICAgICAgICB9KS50b0FycmF5KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciByZXN1bHRzID0gTGF6eShkYXRhLnJlc3VsdHMpO1xuICAgICAgICAgICAgICAgIHZhciBkZWxldGVkID0gZGF0YS5kZWxldGVkO1xuICAgICAgICAgICAgICAgIGlmIChtb2RlbE5hbWUgaW4gUEEpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIE1QQSA9IFBBW21vZGVsTmFtZV07XG4gICAgICAgICAgICAgICAgICAgIExhenkocmVzdWx0cykuZWFjaChmdW5jdGlvbiAocmVjb3JkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVjb3JkLmlkIGluIE1QQSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIExhenkoTVBBW3JlY29yZC5pZF0pLmVhY2goZnVuY3Rpb24gKHYsIGspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjb3JkW2tdID0gdjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBpbmRleGluZyByZWZlcmVuY2VzIGJ5IGl0cyBJRFxuICAgICAgICAgICAgICAgIHZhciBpdGFiID0gZ2V0SW5kZXgobW9kZWxOYW1lKTtcbiAgICAgICAgICAgICAgICB2YXIgdGFibGUgPSBpdGFiLnNvdXJjZTtcblxuICAgICAgICAgICAgICAgIC8vIG9iamVjdCBkZWxldGlvblxuICAgICAgICAgICAgICAgIGlmIChkZWxldGVkKXtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlZC5mb3JFYWNoKGZ1bmN0aW9uKHgpe1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRhYmxlW3hdO1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH1cbi8qXG4gICAgICAgICAgICAgICAgTGF6eShkZWxldGVkKS5lYWNoKGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0YWJsZVt4XTtcbiAgICAgICAgICAgICAgICB9KTtcbiovXG4gICAgICAgICAgICAgICAgdmFyIGlkeCA9IHJlc3VsdHMuaW5kZXhCeSgnaWQnKTtcbiAgICAgICAgICAgICAgICB2YXIgaWsgPSBpZHgua2V5cygpO1xuICAgICAgICAgICAgICAgIHZhciBubmV3ID0gaWsuZGlmZmVyZW5jZShpdGFiLmtleXMoKS5tYXAoZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlSW50KHgpXG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgIHZhciB1cGRhdGVkID0gaWsuZGlmZmVyZW5jZShubmV3KTtcbiAgICAgICAgICAgICAgICAvLyByZW1vdmluZyBvbGQgaWRlbnRpY2FsIHZhbHVlc1xuICAgICAgICAgICAgICAgIHVwZGF0ZWQgPSB1cGRhdGVkLmZpbHRlcihmdW5jdGlvbiAoeCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gIXV0aWxzLnNhbWVBcyhpZHguZ2V0KHgpLCBpdGFiLmdldCh4KS5hc1JhdygpKTtcbiAgICAgICAgICAgICAgICB9KS50b0FycmF5KCk7XG4gICAgICAgICAgICAgICAgLy8gY2xhc3NpZnkgcmVjb3Jkc1xuICAgICAgICAgICAgICAgIHZhciBwZXJtcyA9IGRhdGEucGVybWlzc2lvbnMgPyBMYXp5KGRhdGEucGVybWlzc2lvbnMpIDogTGF6eSh7fSk7XG4gICAgICAgICAgICAgICAgdmFyIG5ld09iamVjdHMgPSBubmV3Lm1hcChmdW5jdGlvbiAoeCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IG1vZGVsQ2xhc3MoaWR4LmdldCh4KSwgcGVybXMuZ2V0KHgpKVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8vLyBjbGFzc2lmeWluZyB1cGRhdGVkXG4gICAgICAgICAgICAgICAgLy92YXIgdXBkYXRlZE9iamVjdHMgPSB1cGRhdGVkLm1hcChmdW5jdGlvbih4KXtyZXR1cm4gbmV3IG1vZGVsQ2xhc3MoaWR4LmdldCh4KSxwZXJtcy5nZXQoeCkpfSk7XG4gICAgICAgICAgICAgICAgLy92YXIgdW8gPSB1cGRhdGVkT2JqZWN0cy50b0FycmF5KCk7XG4gICAgICAgICAgICAgICAgLy91cGRhdGVkT2JqZWN0cyA9IExhenkodW8pLm1hcChmdW5jdGlvbih4KXtyZXR1cm4gW3gsdGFibGVbeC5pZF1dfSkudG9BcnJheSgpO1xuICAgICAgICAgICAgICAgIC8vIFVwZGF0aW5nIHNpbmdsZSBvYmplY3RzXG4gICAgICAgICAgICAgICAgdmFyIGNoYW5nZWQgPSBbXTtcbi8vICAgICAgICAgICAgICAgIHZhciBEQVRFRklFTERTID0gTU9ERUxfREFURUZJRUxEU1ttb2RlbE5hbWVdO1xuLy8gICAgICAgICAgICAgICAgdmFyIEJPT0xGSUVMRFMgPSBNT0RFTF9CT09MRklFTERTW21vZGVsTmFtZV07XG4gICAgICAgICAgICAgICAgdmFyIG1vZGVsUmVmZXJlbmNlcyA9IExhenkobW9kZWwucmVmZXJlbmNlcykubWFwKGZ1bmN0aW9uKGspIHsgcmV0dXJuIFtrLDFdfSkudG9PYmplY3QoKTtcbiAgICAgICAgICAgICAgICB1cGRhdGVkLmZvckVhY2goZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9sZEl0ZW0gPSB0YWJsZVt4XTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9sZENvcHkgPSBvbGRJdGVtLmNvcHkoKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5ld0l0ZW0gPSBpZHguZ2V0KHgpO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgLy8gdXBkYXRpbmcgZWFjaCBhdHRyaWJ1dGUgc2luZ3VsYXJseVxuXG4gICAgICAgICAgICAgICAgICAgIExhenkobW9kZWwuZmllbGRzKS5lYWNoKGZ1bmN0aW9uKGZpZWxkLCBmaWVsZE5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaChmaWVsZC50eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAncmVmZXJlbmNlJyA6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2xkSXRlbVsnXycgKyBmaWVsZE5hbWVdID0gbmV3SXRlbVtmaWVsZE5hbWVdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBOYU4gaXMgY29udm50aW9uYWxseSBhIGNhY2hlIGRlbGV0ZXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2xkSXRlbVtmaWVsZE5hbWVdID0gTmFOO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnZGF0ZSc6IHtvbGRJdGVtW2ZpZWxkTmFtZV0gPSBuZXcgRGF0ZShuZXdJdGVtW2ZpZWxkTmFtZV0gKiAxMDAwKTsgYnJlYWt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2RhdGV0aW1lJzoge29sZEl0ZW1bZmllbGROYW1lXSA9IG5ldyBEYXRlKG5ld0l0ZW1bZmllbGROYW1lXSAqIDEwMDApOyBicmVha307XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbicgOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAobmV3SXRlbVtmaWVsZE5hbWVdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIG51bGwgOiB7IG9sZEl0ZW1bZmllbGROYW1lXSA9IG51bGw7IGJyZWFrOyB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnVCcgOiB7IG9sZEl0ZW1bZmllbGROYW1lXSA9IHRydWU7IGJyZWFrOyB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnRicgOiB7IG9sZEl0ZW1bZmllbGROYW1lXSA9IGZhbHNlOyBicmVhazsgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgdHJ1ZSA6IHsgb2xkSXRlbVtmaWVsZE5hbWVdID0gdHJ1ZTsgYnJlYWs7IH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIGZhbHNlIDogeyBvbGRJdGVtW2ZpZWxkTmFtZV0gPSBmYWxzZTsgYnJlYWs7IH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiB7b2xkSXRlbVtmaWVsZE5hbWVdID0gbmV3SXRlbVtmaWVsZE5hbWVdfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuLy8gICAgICAgICAgICAgICAgICAgICAgICBvbGRJdGVtW2ZpZWxkTmFtZV0gPSBuZXdJdGVtW2ZpZWxkTmFtZV07XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBjaGFuZ2VkLnB1c2goW25ld0l0ZW0sIG9sZENvcHldKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vLy8gc2VuZGluZyBzaWduYWwgZm9yIHVwZGF0ZWQgdmFsdWVzXG4gICAgICAgICAgICAgICAgaWYgKGNoYW5nZWQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIFcyUFJFU09VUkNFLmVtaXQoJ3VwZGF0ZWQtJyArIG1vZGVsTmFtZSwgY2hhbmdlZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vKioqKioqKiogVXBkYXRlIHVuaXZlcnNlICoqKioqKioqXG4gICAgICAgICAgICAgICAgdmFyIG5vID0gbmV3T2JqZWN0cy50b0FycmF5KCk7XG4gICAgICAgICAgICAgICAgTGF6eShubykuZWFjaChmdW5jdGlvbiAoeCkge1xuICAgICAgICAgICAgICAgICAgICB0YWJsZVt4LmlkXSA9IHhcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAvLyByZWJ1bGRpbmcgcmV2ZXJzZSBpbmRleGVzXG4gICAgICAgICAgICAgICAgTGF6eShtb2RlbENhY2hlW21vZGVsTmFtZV0ucmVmZXJlbmNlcykuZWFjaChmdW5jdGlvbiAocmVmKSB7XG4gICAgICAgICAgICAgICAgICAgIFJFVklEWFttb2RlbE5hbWUgKyAnLicgKyByZWZdID0gSURCW21vZGVsTmFtZV0uZ3JvdXBCeSgnXycgKyByZWYpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIC8vIHNlbmRpbmcgZXZlbnRzIGZvciBuZXcgdmFsdWVzXG4gICAgICAgICAgICAgICAgaWYgKG5vLmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgVzJQUkVTT1VSQ0UuZW1pdCgnbmV3LScgKyBtb2RlbE5hbWUsIExhenkobm8pLCBkYXRhLnRvdGFsUmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgaWYgKGRlbGV0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgVzJQUkVTT1VSQ0UuZW1pdCgnZGVsZXRlZC0nICsgbW9kZWxOYW1lLCBkZWxldGVkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gc2VuZGluZyBldmVudHMgZm9yIGRhdGEgYXJyaXZlZFxuICAgICAgICAgICAgICAgIFcyUFJFU09VUkNFLmVtaXQoJ3JlY2VpdmVkLScgKyBtb2RlbE5hbWUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4vKiAgICAgICAgXG4gICAgICAgIGlmIChUT09ORSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignVE9PTkUnKTtcbiAgICAgICAgICAgIExhenkoVE9PTkUpLmVhY2goZnVuY3Rpb24gKHZhbHMsIG1vZGVsTmFtZSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKG1vZGVsTmFtZSk7XG4gICAgICAgICAgICAgICAgdmFyIHVkeCA9IGdldFVubGlua2VkKG1vZGVsTmFtZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoVE9NQU5ZKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdUT01BTlknKTtcbiAgICAgICAgICAgIExhenkoVE9NQU5ZKS5lYWNoKGZ1bmN0aW9uICh2YWxzLCBpbmRleE5hbWUpIHtcbiAgICAgICAgICAgICAgICBpZiAoIShpbmRleE5hbWUgaW4gQVNLRURfVU5MSU5LRUQpKSB7XG4gICAgICAgICAgICAgICAgICAgIEFTS0VEX1VOTElOS0VEW2luZGV4TmFtZV0gPSBMYXp5KFtdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgTGF6eSh2YWxzKS5lYWNoKGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgICAgICAgICBBU0tFRF9VTkxJTktFRFtpbmRleE5hbWVdLnNvdXJjZS5wdXNoKGlkKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChNQU5ZVE9NQU5ZKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdNQU5ZVE9NQU5ZJyk7XG4gICAgICAgICAgICBMYXp5KE1BTllUT01BTlkpLmVhY2goZnVuY3Rpb24gKHZhbHMsIGluZGV4TmFtZSkge1xuICAgICAgICAgICAgICAgIHZhciBmaXJzdCA9IHBhcnNlSW50KGluZGV4TmFtZS5zcGxpdCgnfCcpWzFdKTtcbiAgICAgICAgICAgICAgICBpbmRleE5hbWUgPSBpbmRleE5hbWUuc3BsaXQoJ3wnKVswXTtcbiAgICAgICAgICAgICAgICBpZiAoIShpbmRleE5hbWUgaW4gQVNLRURfTTJNKSkge1xuICAgICAgICAgICAgICAgICAgICBBU0tFRF9NMk1baW5kZXhOYW1lXSA9IFt7fSwge31dO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgTUlEWCA9IEFTS0VEX00yTVtpbmRleE5hbWVdW2ZpcnN0XTtcbiAgICAgICAgICAgICAgICBMYXp5KHZhbHMpLmVhY2goZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgICAgICAgICAgICAgTUlEWFt4ICsgJyddID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgTUlEWFt4XSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgXG4qL1xuICAgICAgICBpZiAobTJtKSB7XG4gICAgICAgICAgICBXMlBSRVNPVVJDRS5nb3RNMk0obTJtKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoUEVSTUlTU0lPTlMpIHtcbiAgICAgICAgICAgIFcyUFJFU09VUkNFLmdvdFBlcm1pc3Npb25zKFBFUk1JU1NJT05TKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjYWxsQmFjaykge1xuICAgICAgICAgICAgY2FsbEJhY2soZGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgVzJQUkVTT1VSQ0UuZW1pdCgnZ290LWRhdGEnKTtcbiAgICB9O1xuICAgIHRoaXMuZ290UGVybWlzc2lvbnMgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICBMYXp5KGRhdGEpLmVhY2goZnVuY3Rpb24gKHYsIHJlc291cmNlTmFtZSkge1xuICAgICAgICAgICAgTGF6eSh2WzBdKS5lYWNoKGZ1bmN0aW9uIChyb3csIGlkKSB7XG4gICAgICAgICAgICAgICAgaWYgKChyZXNvdXJjZU5hbWUgaW4gSURCKSAmJiAoaWQgaW4gSURCW3Jlc291cmNlTmFtZV0uc291cmNlKSl7XG4gICAgICAgICAgICAgICAgICAgIElEQltyZXNvdXJjZU5hbWVdLmdldChpZCkuX3Blcm1pc3Npb25zID0gTGF6eShyb3cpLm1hcChmdW5jdGlvbiAoeCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFt4LCB0cnVlXVxuICAgICAgICAgICAgICAgICAgICB9KS50b09iamVjdCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKExhenkodlswXSkuc2l6ZSgpKXtcbiAgICAgICAgICAgICAgICBXMlBSRVNPVVJDRS5lbWl0KCd1cGRhdGUtcGVybWlzc2lvbnMtJyArIHJlc291cmNlTmFtZSwgTGF6eSh2WzBdKS5rZXlzKCkudG9BcnJheSgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuZW1pdCgndXBkYXRlLXBlcm1pc3Npb25zJyk7XG4gICAgfTtcblxuXG4gICAgdGhpcy5nb3RNMk0gPSBmdW5jdGlvbihtMm0pe1xuICAgICAgICBMYXp5KG0ybSkuZWFjaChmdW5jdGlvbihkYXRhLCBpbmRleE5hbWUpe1xuICAgICAgICAgICAgdmFyIG0ybUluZGV4ID0gbGlua2VyLm0ybUluZGV4W2luZGV4TmFtZV07XG4gICAgICAgICAgICBMYXp5KGRhdGEpLmVhY2goZnVuY3Rpb24obSl7XG4gICAgICAgICAgICAgICAgTGF6eShtKS5lYWNoKGZ1bmN0aW9uKGRhdGEsdmVyYil7XG4gICAgICAgICAgICAgICAgICAgIG0ybUluZGV4W3ZlcmJdKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBXMlBSRVNPVVJDRS5lbWl0KCdyZWNlaXZlZC1tMm0nKTtcbiAgICAgICAgICAgIFcyUFJFU09VUkNFLmVtaXQoJ3JlY2VpdmVkLW0ybS0nICsgaW5kZXhOYW1lKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgdGhpcy5mZXRjaCA9IGZ1bmN0aW9uIChtb2RlbE5hbWUsIGZpbHRlciwgdG9nZXRoZXIsIGNhbGxCYWNrKSB7ICAvL1xuICAgICAgICAvLyBpZiBhIGNvbm5lY3Rpb24gaXMgY3VycmVudGx5IHJ1bm5pbmcsIHdhaXQgZm9yIGNvbm5lY3Rpb24uXG4gICAgICAgIGlmIChtb2RlbE5hbWUgaW4gd2FpdGluZ0Nvbm5lY3Rpb25zKXtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBXMlBSRVNPVVJDRS5mZXRjaChtb2RlbE5hbWUsIGZpbHRlciwgdG9nZXRoZXIsIGNhbGxCYWNrKTtcbiAgICAgICAgICAgIH0sNTAwKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIGZldGNoaW5nIGFzeW5jaHJvbW91cyBtb2RlbCBmcm9tIHNlcnZlclxuICAgICAgICAgICAgVzJQUkVTT1VSQ0UuZGVzY3JpYmUobW9kZWxOYW1lLCAoZnVuY3Rpb24obW9kZWwpe1xuICAgICAgICAgICAgICAgIC8vIGlmIGRhdGEgY2FtZXMgZnJvbSByZWFsdGltZSBjb25uZWN0aW9uXG4gICAgICAgICAgICAgICAgaWYgKFcyUFJFU09VUkNFLmNvbm5lY3Rpb24uY2FjaGVkU3RhdHVzLnJlYWx0aW1lRW5kUG9pbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgLy8gZ2V0dGluZyBmaWx0ZXIgZmlsdGVyZWQgYnkgY2FjaGluZyBzeXN0ZW1cbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyID0gbGlzdENhY2hlLmZpbHRlcihtb2RlbCxmaWx0ZXIpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIHNvbXRoaW5nIGlzIG1pc3Npbmcgb24gbXkgbG9jYWwgREIgXG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWx0ZXIpe1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYXNrIGZvciBtaXNzaW5ncyBhbmQgcGFyc2Ugc2VydmVyIHJlc3BvbnNlIGluIG9yZGVyIHRvIGVucmljaCBteSBsb2NhbCBEQi5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHBsYWNpbmcgbG9jayBmb3IgdGhpcyBtb2RlbFxuICAgICAgICAgICAgICAgICAgICAgICAgd2FpdGluZ0Nvbm5lY3Rpb25zW21vZGVsTmFtZV0gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgVzJQUkVTT1VSQ0UuJHBvc3QobW9kZWxOYW1lICsgJy9saXN0Jywge2ZpbHRlciA6IGZpbHRlcn0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFcyUFJFU09VUkNFLmdvdERhdGEoZGF0YSxjYWxsQmFjayk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmVsZWFzZSBsb2NrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB3YWl0aW5nQ29ubmVjdGlvbnNbbW9kZWxOYW1lXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihyZXQpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyByZWxlYXNlIGxvY2tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHdhaXRpbmdDb25uZWN0aW9uc1ttb2RlbE5hbWVdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbEJhY2sgJiYgY2FsbEJhY2soKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmlsdGVyO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJHBvc3QobW9kZWxOYW1lICsgJy9saXN0Jywgc2VuZERhdGEsZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWZpbHRlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHT1RfQUxMLnNvdXJjZS5wdXNoKG1vZGVsTmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFcyUFJFU09VUkNFLmdvdERhdGEoZGF0YSwgY2FsbEJhY2spO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuYmluZCh0aGlzKSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgdGhpcy5nZXQgPSBmdW5jdGlvbihtb2RlbE5hbWUsIGlkcywgY2FsbEJhY2spe1xuICAgICAgICAvLyBzZWFyY2ggb2JqZWN0cyBmcm9tIElEQi4gSWYgc29tZSBpZCBpcyBtaXNzaW5nLCBpdCByZXNvbHZlIGl0IGJ5IHRoZSBzZXJ2ZXJcbiAgICAgICAgLy8gaWYgYSByZXF1ZXN0IHRvIHRoZSBzYW1lIG1vZGVsIGlzIHBlbmRpbmcsIHdhaXQgZm9yIGl0cyBjb21wbGV0aW9uXG4gICAgICAgIFxuICAgICAgICBpZiAoaWRzLmNvbnN0cnVjdG9yICE9PSBBcnJheSl7XG4gICAgICAgICAgICBpZHMgPSBbaWRzXTtcbiAgICAgICAgfVxuICAgICAgICAvLyBpZiBzb21lIGVudGl0eSBpcyBtaXNzaW5nIFxuICAgICAgICBXMlBSRVNPVVJDRS5mZXRjaChtb2RlbE5hbWUgLCB7aWQ6IGlkc30sIG51bGwsZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciByZXQgPSBbXTtcbiAgICAgICAgICAgIHZhciBpdGFiID0gSURCW21vZGVsTmFtZV1cbiAgICAgICAgICAgIGZvciAodmFyIGlkIGluIGlkcyl7XG4gICAgICAgICAgICAgICAgcmV0LnB1c2goaXRhYi5zb3VyY2VbaWRzW2lkXV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FsbEJhY2socmV0KTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHRoaXMuZ290TW9kZWwgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICBmb3IgKHZhciBtb2RlbE5hbWUgaW4gZGF0YSkge1xuICAgICAgICAgICAgdmFyIG1vZGVsID0gZGF0YVttb2RlbE5hbWVdO1xuICAgICAgICAgICAgbG9jYWxTdG9yYWdlWydkZXNjcmlwdGlvbjonICsgbW9kZWxOYW1lXSA9IEpTT04uc3RyaW5naWZ5KGRhdGEpO1xuICAgICAgICAgICAgbW9kZWxDYWNoZVttb2RlbE5hbWVdID0gbWFrZU1vZGVsQ2xhc3MobW9kZWwpO1xuICAgICAgICAgICAgaWYgKCEobW9kZWxOYW1lIGluIElEQikpIHtcbiAgICAgICAgICAgICAgICBJREJbbW9kZWxOYW1lXSA9IExhenkoe30pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcblxuICAgIHRoaXMuZGVzY3JpYmUgPSBmdW5jdGlvbihtb2RlbE5hbWUsIGNhbGxCYWNrKXtcbiAgICAgICAgdmFyIHJldCA9IG1vZGVsQ2FjaGVbbW9kZWxOYW1lXTtcbiAgICAgICAgaWYgKHJldCkge1xuICAgICAgICAgICAgY2FsbEJhY2sgJiYgY2FsbEJhY2socmV0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICghKG1vZGVsTmFtZSBpbiB3YWl0aW5nQ29ubmVjdGlvbnMpKXtcbiAgICAgICAgICAgICAgICBpZiAobW9kZWxOYW1lIGluIGZhaWxlZE1vZGVscyl7XG4gICAgICAgICAgICAgICAgICAgIHJldHVyblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgY2FjaGVLZXkgPSAnZGVzY3JpcHRpb246JyArIG1vZGVsTmFtZTtcbiAgICAgICAgICAgICAgICBpZiAoY2FjaGVLZXkgaW4gbG9jYWxTdG9yYWdlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ290TW9kZWwoSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2VbY2FjaGVLZXldKSk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxCYWNrICYmIGNhbGxCYWNrKG1vZGVsQ2FjaGVbbW9kZWxOYW1lXSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgd2FpdGluZ0Nvbm5lY3Rpb25zW21vZGVsTmFtZV0gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiRwb3N0KG1vZGVsTmFtZSArICcvZGVzY3JpYmUnLG51bGwsIGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgICAgICAgICAgICAgVzJQUkVTT1VSQ0UuZ290TW9kZWwoZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsQmFjayAmJiBjYWxsQmFjayhtb2RlbENhY2hlW21vZGVsTmFtZV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHdhaXRpbmdDb25uZWN0aW9uc1ttb2RlbE5hbWVdO1xuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWxOb3RGb3VuZC5oYW5kbGUobW9kZWxOYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZhaWxlZE1vZGVsc1ttb2RlbE5hbWVdID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyB3YWl0IGZvciBjb25uZWN0aW9uXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICBXMlBSRVNPVVJDRS5kZXNjcmliZShtb2RlbE5hbWUsIGNhbGxCYWNrKTtcbiAgICAgICAgICAgICAgICB9LCA1MDApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9ICAgICAgICBcbiAgICB9O1xuICAgIHRoaXMuYWRkTW9kZWxIYW5kbGVyID0gZnVuY3Rpb24gKG1vZGVsTmFtZSwgZGVjb3JhdG9yKSB7XG4gICAgICAgIHZhciBrZXkgPSB1dGlscy5oYXNoKGRlY29yYXRvcik7XG4gICAgICAgIGlmICghKG1vZGVsTmFtZSBpbiBidWlsZGVySGFuZGxlcnMpKSBidWlsZGVySGFuZGxlcnNbbW9kZWxOYW1lXSA9IG5ldyBIYW5kbGVyKCk7XG4gICAgICAgIGlmICghKG1vZGVsTmFtZSBpbiBidWlsZGVySGFuZGxlclVzZWQpKSBidWlsZGVySGFuZGxlclVzZWRbbW9kZWxOYW1lXSA9IHt9O1xuICAgICAgICBpZiAoa2V5IGluIGJ1aWxkZXJIYW5kbGVyVXNlZFttb2RlbE5hbWVdKXtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGJ1aWxkZXJIYW5kbGVyVXNlZFttb2RlbE5hbWVdW2tleV0gPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChtb2RlbE5hbWUgaW4gbW9kZWxDYWNoZSkge1xuICAgICAgICAgICAgZGVjb3JhdG9yKG1vZGVsQ2FjaGVbbW9kZWxOYW1lXSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBidWlsZGVySGFuZGxlcnNbbW9kZWxOYW1lXS5hZGRIYW5kbGVyKGRlY29yYXRvcik7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHRoaXMuYWRkUGVyc2lzdGVudEF0dHJpYnV0ZXMgPSBmdW5jdGlvbihtb2RlbE5hbWUsIGF0dHJpYnV0ZXMpe1xuICAgICAgICB2YXIgYWRkUHJvcGVydHkgPSBmdW5jdGlvbihtb2RlbCwgYXR0cmlidXRlcykge1xuICAgICAgICAgIGF0dHJpYnV0ZXMuZm9yRWFjaChmdW5jdGlvbih2YWwpe1xuICAgICAgICAgICAgdmFyIGtleSA9ICdwQTonICsgbW9kZWwubW9kZWxOYW1lICsgJzonICsgdmFsO1xuICAgICAgICAgICAgdmFyIGthdHRyID0gJ19fJyArIHZhbDtcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShtb2RlbC5wcm90b3R5cGUsIHZhbCwge1xuICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgaWYgKCEoa2F0dHIgaW4gdGhpcykpe1xuICAgICAgICAgICAgICAgICAgdmFyIHYgPSBsb2NhbFN0b3JhZ2Vba2V5ICsgdGhpcy5pZF07XG4gICAgICAgICAgICAgICAgICB0aGlzW2thdHRyXSA9IHY/SlNPTi5wYXJzZSh2KTpudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpc1trYXR0cl07XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHNldDogZnVuY3Rpb24odmFsdWUpe1xuICAgICAgICAgICAgICAgIHRoaXNba2F0dHJdID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlW2tleSArIHRoaXMuaWRdID0gSlNPTi5zdHJpbmdpZnkodmFsdWUpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKCEobW9kZWxOYW1lIGluIHBlcnNpc3RlbnRBdHRyaWJ1dGVzKSkgeyBwZXJzaXN0ZW50QXR0cmlidXRlc1ttb2RlbE5hbWVdID0gW107IH1cbiAgICAgICAgdmFyIGF0dHJzID0gcGVyc2lzdGVudEF0dHJpYnV0ZXNbbW9kZWxOYW1lXTtcbiAgICAgICAgaWYgKGF0dHJpYnV0ZXMpIHtcbiAgICAgICAgICAgIHZhciBuZXdBdHRycyA9IExhenkoYXR0cmlidXRlcykuZGlmZmVyZW5jZShhdHRycykudG9BcnJheSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIG5ld0F0dHJzID0gYXR0cnM7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5ld0F0dHJzLmxlbmd0aCl7XG4gICAgICAgICAgICBpZiAobW9kZWxOYW1lIGluIG1vZGVsQ2FjaGUpe1xuICAgICAgICAgICAgICAgIGFkZFByb3BlcnR5KG1vZGVsQ2FjaGVbbW9kZWxOYW1lXSwgbmV3QXR0cnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZXMpe1xuICAgICAgICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KGF0dHJzLG5ld0F0dHJzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgdGhpcy5vbignbmV3LW1vZGVsJywgZnVuY3Rpb24obW9kZWwpe1xuICAgICAgICBpZiAobW9kZWwubW9kZWxOYW1lIGluIGJ1aWxkZXJIYW5kbGVycyl7XG4gICAgICAgICAgICBidWlsZGVySGFuZGxlcnNbbW9kZWwubW9kZWxOYW1lXS5oYW5kbGUobW9kZWxDYWNoZVttb2RlbC5tb2RlbE5hbWVdKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobW9kZWwubW9kZWxOYW1lIGluIHBlcnNpc3RlbnRBdHRyaWJ1dGVzKXtcbiAgICAgICAgICAgIFcyUFJFU09VUkNFLmFkZFBlcnNpc3RlbnRBdHRyaWJ1dGVzKG1vZGVsLm1vZGVsTmFtZSk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMucXVlcnkgPSBmdW5jdGlvbihtb2RlbE5hbWUsIGZpbHRlciwgdG9nZXRoZXIsIGNhbGxCYWNrKXtcbiAgICAgICAgdmFyIHRocyA9IHRoaXM7XG4gICAgICAgIHRoaXMuZGVzY3JpYmUobW9kZWxOYW1lLGZ1bmN0aW9uKG1vZGVsKXtcbiAgICAgICAgICAgIC8vIGFycmF5Zml5IGFsbCBmaWx0ZXIgdmFsdWVzXG4gICAgICAgICAgICBmaWx0ZXIgPSBMYXp5KGZpbHRlcikubWFwKGZ1bmN0aW9uKHYsayl7IHJldHVybiBbayxBcnJheS5pc0FycmF5KHYpP3Y6W3ZdXX0pLnRvT2JqZWN0KCk7XG4gICAgICAgICAgICB2YXIgZmlsdGVyRnVuY3Rpb24gPSB1dGlscy5tYWtlRmlsdGVyKG1vZGVsLCBmaWx0ZXIpO1xuICAgICAgICAgICAgdmFyIGlkeCA9IGdldEluZGV4KG1vZGVsTmFtZSk7XG4gICAgICAgICAgICB0aHMuZmV0Y2gobW9kZWxOYW1lLGZpbHRlcix0b2dldGhlciwgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgY2FsbEJhY2soaWR4LmZpbHRlcihmaWx0ZXJGdW5jdGlvbikudmFsdWVzKCkudG9BcnJheSgpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KVxuICAgIH07XG4gICAgdGhpcy5kZWxldGUgPSBmdW5jdGlvbihtb2RlbE5hbWUsIGlkcywgY2FsbEJhY2spe1xuICAgICAgICByZXR1cm4gdGhpcy4kcG9zdChtb2RlbE5hbWUgKyAnL2RlbGV0ZScsIHsgaWQgOiBpZHN9LCBjYWxsQmFjayk7XG4gICAgfTtcblxuICAgIHRoaXMuY29ubmVjdCA9IGZ1bmN0aW9uIChjYWxsQmFjaykge1xuICAgICAgICBpZiAodGhpcy5jb25uZWN0aW9uLmlzTG9nZ2VkSW4pIHtcbiAgICAgICAgICAgIGNhbGxCYWNrKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb24uY29ubmVjdChjYWxsQmFjayk7XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG5mdW5jdGlvbiByZVdoZWVsT1JNKGVuZFBvaW50LCBsb2dpbkZ1bmMpe1xuICAgIHRoaXMuJG9ybSA9IG5ldyBiYXNlT1JNKG5ldyB1dGlscy5yZVdoZWVsQ29ubmVjdGlvbihlbmRQb2ludCwgbG9naW5GdW5jKSx0aGlzKTtcbiAgICB0aGlzLm9uID0gdGhpcy4kb3JtLm9uLmJpbmQodGhpcy4kb3JtKTtcbiAgICB0aGlzLmVtaXQgPSB0aGlzLiRvcm0uZW1pdC5iaW5kKHRoaXMuJG9ybSk7XG4gICAgdGhpcy51bmJpbmQgPSB0aGlzLiRvcm0udW5iaW5kLmJpbmQodGhpcy4kb3JtKTtcbiAgICB0aGlzLm9uY2UgPSB0aGlzLiRvcm0ub25jZTtcbiAgICB0aGlzLmFkZE1vZGVsSGFuZGxlciA9IHRoaXMuJG9ybS5hZGRNb2RlbEhhbmRsZXIuYmluZCh0aGlzLiRvcm0pO1xuICAgIHRoaXMuYWRkUGVyc2lzdGVudEF0dHJpYnV0ZXMgPSB0aGlzLiRvcm0uYWRkUGVyc2lzdGVudEF0dHJpYnV0ZXMuYmluZCh0aGlzLiRvcm0pO1xuICAgIHRoaXMudXRpbHMgPSB1dGlscztcbiAgICB0aGlzLmxvZ291dCA9IHRoaXMuJG9ybS5jb25uZWN0aW9uLmxvZ291dC5iaW5kKHRoaXMuJG9ybS5jb25uZWN0aW9uKTtcbn1cblxucmVXaGVlbE9STS5wcm90b3R5cGUuY29ubmVjdCA9IGZ1bmN0aW9uKCl7XG4gICAgdmFyIGNvbm5lY3Rpb24gPSB0aGlzLiRvcm0uY29ubmVjdGlvbjtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKGZ1bmN0aW9uKGNhbGxCYWNrLHJlamVjdCl7XG4gICAgICAgIGNvbm5lY3Rpb24uY29ubmVjdChjYWxsQmFjayk7XG4gICAgfSkpO1xufVxuXG5yZVdoZWVsT1JNLnByb3RvdHlwZS5sb2dpbiA9IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgoZnVuY3Rpb24oYWNjZXB0LHJlamVjdCl7XG4gICAgICAgIHRoaXMuJG9ybS5jb25uZWN0aW9uLmxvZ2luKHVzZXJuYW1lLCBwYXNzd29yZCwgYWNjZXB0KTsgICAgXG4gICAgfSkuYmluZCh0aGlzKSk7XG4gICAgXG59O1xuXG5yZVdoZWVsT1JNLnByb3RvdHlwZS5sb2dvdXQgPSBmdW5jdGlvbih1cmwpe1xuICAgIHJldHVybiB0aGlzLiRvcm0uY29ubmVjdGlvbi5sb2dvdXQoKTtcbn1cblxucmVXaGVlbE9STS5wcm90b3R5cGUuZ2V0TW9kZWwgPSBmdW5jdGlvbihtb2RlbE5hbWUpe1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24oYWNjZXB0LCByZWplY3Qpe1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgc2VsZi4kb3JtLmNvbm5lY3QoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBzZWxmLiRvcm0uZGVzY3JpYmUobW9kZWxOYW1lLGFjY2VwdCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9IGNhdGNoKGUpIHtcbiAgICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgfVxuICAgIH0pXG59XG5cbnJlV2hlZWxPUk0ucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uKG1vZGVsTmFtZSwgaWRzKXtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIHNpbmdsZSA9IGZhbHNlO1xuICAgIHZhciBtb2ROYW1lID0gbW9kZWxOYW1lO1xuICAgIHZhciBmaWx0ZXI7XG4gICAgaWYgKHR5cGVvZiBpZHMgPT09ICdudW1iZXInKSB7XG4gICAgICAgIHNpbmdsZSA9IHRydWU7XG4gICAgICAgIGZpbHRlciA9IHsgaWQgOiBbaWRzXX07XG4gICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGlkcykpe1xuICAgICAgICBmaWx0ZXIgPSB7IGlkIDogaWRzIH07XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgaWRzID09PSAnb2JqZWN0Jykge1xuICAgICAgICBmaWx0ZXIgPSBpZHM7XG4gICAgfSBlbHNlIGlmIChpZHMgPT09IG51bGwpIHtcbiAgICAgICAgZmlsdGVyID0ge307XG4gICAgfVxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihhY2NlcHQsIHJlamVjdCl7XG4gICAgICAgIHRyeXtcbiAgICAgICAgICAgIHNlbGYuJG9ybS5jb25uZWN0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgc2VsZi4kb3JtLnF1ZXJ5KG1vZGVsTmFtZSwgZmlsdGVyLCBudWxsLCBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzaW5nbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjY2VwdChkYXRhLmxlbmd0aCA/IGRhdGFbMF0gOiBudWxsKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjY2VwdChkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpe1xuICAgICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICB9XG4gICAgfSk7XG59O1xuXG4vKlxucmVXaGVlbE9STS5wcm90b3R5cGUucXVlcnkgPSBmdW5jdGlvbiAobW9kZWxOYW1lLCBmaWx0ZXIsIHJlbGF0ZWQpe1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24oYWNjZXB0LCByZWplY3Qpe1xuICAgICAgICB2YXIgdG9nZXRoZXIgPSBudWxsO1xuICAgICAgICBpZiAocmVsYXRlZCAmJiAocmVsYXRlZC5jb25zdHJ1Y3RvciA9PT0gQXJyYXkpICYmIChyZWxhdGVkLmxlbmd0aCkpe1xuICAgICAgICAgICAgdG9nZXRoZXIgPSByZWxhdGVkO1xuICAgICAgICB9IGVsc2UgaWYgKHJlbGF0ZWQgJiYgKHJlbGF0ZWQuY29uc3RydWN0b3IgPT09IFN0cmluZykgJiYgKHJlbGF0ZWQubGVuZ3RoKSl7XG4gICAgICAgICAgICB0b2dldGhlciA9IHJlbGF0ZWQuc3BsaXQoJywnKTtcbiAgICAgICAgfVxuICAgICAgICB0cnl7XG4gICAgICAgICAgICBzZWxmLiRvcm0uY29ubmVjdChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHNlbGYuJG9ybS5xdWVyeShtb2RlbE5hbWUsIGZpbHRlciwgdG9nZXRoZXIsIGFjY2VwdCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBjYXRjaCAoZSl7XG4gICAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgIH1cbiAgICB9KVxufTtcbiovXG5cbnJlV2hlZWxPUk0ucHJvdG90eXBlLmRlbGV0ZSA9IGZ1bmN0aW9uIChtb2RlbE5hbWUsIGlkcyl7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihhY2NlcHQsIHJlamVjdCl7XG4gICAgICAgIHRyeXtcbiAgICAgICAgICAgIHNlbGYuJG9ybS5jb25uZWN0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgc2VsZi4kb3JtLmRlbGV0ZShtb2RlbE5hbWUsIGlkcywgYWNjZXB0KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGNhdGNoIChlKXtcbiAgICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgfVxuICAgIH0pXG59O1xuXG5yZVdoZWVsT1JNLnByb3RvdHlwZS5nZXRMb2dnZWRVc2VyID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIGlmICh0aGlzLiRvcm0uY29ubmVjdGlvbi5jYWNoZWRTdGF0dXMudXNlcl9pZClcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KCdhdXRoX3VzZXInLHRoaXMuJG9ybS5jb25uZWN0aW9uLmNhY2hlZFN0YXR1cy51c2VyX2lkKTtcbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKGFjY2VwdCwgcmVqZWN0KSB7XG4gICAgICAgICAgICBzZWxmLm9uY2UoJ2xvZ2dlZC1pbicsZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgICAgIHNlbGYuZ2V0KCdhdXRoX3VzZXInLCB1c2VyKS50aGVuKGFjY2VwdCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuXG5yZVdoZWVsT1JNLnByb3RvdHlwZS4kc2VuZFRvRW5kcG9pbnQgPSBmdW5jdGlvbiAodXJsLCBkYXRhKXtcbiAgICByZXR1cm4gdGhpcy4kb3JtLiRwb3N0KHVybCwgZGF0YSk7XG59XG5cbnJlV2hlZWxPUk0ucHJvdG90eXBlLmxvZ2luID0gZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkKXtcbiAgICByZXR1cm4gdGhpcy4kb3JtLmNvbm5lY3Rpb24ubG9naW4odXNlcm5hbWUscGFzc3dvcmQpO1xufVxuIl19
